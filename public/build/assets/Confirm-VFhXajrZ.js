import{r as P,R as te,j as e,H as se,a as ae}from"./app-BT0PBD5v.js";import{d as V}from"./dayjs.min-iFuAdwsj.js";import{A as ne}from"./AppLayout-BhYd1jex.js";import{I as oe,ak as ie,T as le,C as $,R as L,B as Y}from"./Logo-CBsbfG2i.js";import{F as m}from"./index-DKZ5kWbZ.js";import{P as me}from"./progress-qQN-lhyQ.js";import{R as U,C as v}from"./row-BmBoW_gX.js";import{R as A}from"./CheckCircleOutlined-CPKirhKK.js";import{D as j}from"./index-CPNQNLGX.js";import{R as ce}from"./CalendarOutlined-4pR6q61x.js";import{R as de}from"./ClockCircleOutlined-x1u_407Q.js";import{R as pe}from"./DollarOutlined-Dz3VfSfB.js";import{S as k}from"./index-DBEzLASz.js";import{I as l}from"./index-DSRvDQzQ.js";import{R as W}from"./PhoneOutlined-Ca8mh_sI.js";import{R as G}from"./MailOutlined-BntH5jt5.js";import{A as J}from"./index-D8bF4dkV.js";import{R as ue}from"./ArrowLeftOutlined-DgB4V5X2.js";import{D as R}from"./index-BbnGm7O4.js";import{T as he}from"./index-Du1npkmC.js";import{s as I}from"./index-CCEwWO5O.js";import{D as K}from"./index-DLiTCBO6.js";import{T as ye}from"./index-F804iTbY.js";import{C as X}from"./index-Bzdxy8Q6.js";import{R as Q}from"./index-D06CY-Zo.js";import{T as xe}from"./index-BHGmy-0o.js";/* empty css            */import"./useForm-BuUIJ0Zj.js";import"./CheckCircleFilled-t1GImBJH.js";import"./ExclamationCircleFilled-uB9MuAY_.js";import"./useBreakpoint-_zB_dkAU.js";import"./pickAttrs-CVI85bE7.js";import"./PurePanel-D4KtRPLf.js";import"./index-6ufNqcJI.js";import"./move-8rmViMFg.js";import"./Input-CvWDqBh-.js";import"./EyeOutlined-DLP9J_fo.js";import"./InfoCircleFilled-C2zuEgtx.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};function D(){return D=Object.assign?Object.assign.bind():function(o){for(var i=1;i<arguments.length;i++){var p=arguments[i];for(var u in p)Object.prototype.hasOwnProperty.call(p,u)&&(o[u]=p[u])}return o},D.apply(this,arguments)}const ge=(o,i)=>P.createElement(oe,D({},o,{ref:i,icon:je})),h=P.forwardRef(ge),{Title:w,Text:a,Paragraph:or}=le,{Option:d}=k;function ir({service:o,selectedExtras:i,date:p,time:u,consentSettings:C,form:fe,formFields:b,paymentSettings:z,totalPrice:B,verifiedPhone:g}){const[T]=m.useForm(),[Z,F]=P.useState(!1),[be,_e]=P.useState(0);te.useEffect(()=>{g&&T.setFieldsValue({customer_phone:g})},[g,T]);const ee=()=>{const r=i.map(s=>s.id),t=C.map(s=>s.id);ae.visit(route("booking.consent"),{data:{service_id:o.id,extras:r,date:p,time:u,consents:t}})},re=async r=>{F(!0);try{const t=i.map(c=>c.id),s=C.map(c=>c.id),y={service_id:o.id,extras:t,date:p,time:u,consents:s,customer_name:r.customer_name,customer_email:r.customer_email,customer_phone:r.customer_phone,payment_method:r.payment_method,special_requests:r.special_requests||""},x=await fetch(route("booking.process"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(y)});let n;try{n=await x.json()}catch(c){console.error("Failed to parse response:",c),I.error("Server returned an invalid response. Please try again.");return}if(n.success){const c={key:n.order_data.key_id,amount:n.order_data.amount,currency:n.order_data.currency,name:"HospiPal",description:`${o.name} - Booking`,order_id:n.order_data.order_id,handler:function(S){window.location.href=route("booking.payment-success")+`?razorpay_payment_id=${S.razorpay_payment_id}&razorpay_order_id=${S.razorpay_order_id}&razorpay_signature=${S.razorpay_signature}`},prefill:{name:r.customer_name,email:r.customer_email,contact:r.customer_phone},theme:{color:"#1890ff"}};new window.Razorpay(c).open()}else n.errors?Object.keys(n.errors).forEach(c=>{n.errors[c].forEach(N=>{I.error(N)})}):I.error(n.error||"Failed to create booking")}catch(t){console.error("Booking error:",t),I.error("An error occurred. Please try again.")}finally{F(!1)}},f=r=>`â‚¹${parseFloat(r).toFixed(2)}`,_=r=>{if(r<60)return`${r} min`;{const t=Math.floor(r/60),s=r%60;return s>0?`${t}h ${s}m`:`${t}h`}},q=r=>V(r,"HH:mm").format("h:mm A"),O=r=>V(r).format("dddd, MMMM D, YYYY"),H=o.duration+i.reduce((r,t)=>r+(t.duration||0),0),M=r=>{const t=[];switch(r.is_required?t.push({required:!0,message:`Please enter your ${r.label.toLowerCase()}`}):t.push({required:!1}),r.type){case"email":t.push({type:"email",message:"Please enter a valid email address"});break;case"phone":t.push({pattern:/^[0-9+\-\s()]+$/,message:"Please enter a valid phone number"});break;case"number":t.push({type:"number",message:"Please enter a valid number"});break;case"url":t.push({type:"url",message:"Please enter a valid URL"});break}return t},E=r=>{const t={placeholder:r.placeholder,size:"large"};switch(r.type){case"text":return e.jsx(l,{...t});case"email":return e.jsx(l,{...t,prefix:e.jsx(G,{})});case"phone":return e.jsx(l,{...t,prefix:e.jsx(W,{})});case"number":return e.jsx(xe,{...t,style:{width:"100%"}});case"textarea":return e.jsx(l.TextArea,{...t,rows:3});case"select":return e.jsx(k,{...t,children:r.options?.map((s,y)=>{const x=typeof s=="object"?s.value:s,n=typeof s=="object"?s.label:s;return e.jsx(d,{value:x,children:n},y)})});case"radio":return e.jsx(Q.Group,{children:r.options?.map((s,y)=>{const x=typeof s=="object"?s.value:s,n=typeof s=="object"?s.label:s;return e.jsx(Q,{value:x,children:n},y)})});case"checkbox":return e.jsx(X.Group,{children:r.options?.map((s,y)=>{const x=typeof s=="object"?s.value:s,n=typeof s=="object"?s.label:s;return e.jsx(X,{value:x,children:n},y)})});case"date":return e.jsx(K,{...t,style:{width:"100%"}});case"time":return e.jsx(ye,{...t,style:{width:"100%"}});case"datetime":return e.jsx(K,{...t,showTime:!0,style:{width:"100%"}});case"url":return e.jsx(l,{...t});case"password":return e.jsx(l.Password,{...t});default:return e.jsx(l,{...t})}};return e.jsxs(ne,{children:[e.jsx(se,{title:"Confirm & Pay - Book Appointment"}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(ie,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(w,{level:2,style:{marginTop:24,marginBottom:8},children:"Confirm & Pay"}),e.jsx(a,{type:"secondary",style:{fontSize:16},children:"Review your booking and complete payment"})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(me,{percent:100,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(a,{type:"secondary",children:"Step 5 of 5"})})]}),e.jsxs(U,{gutter:[32,32],children:[e.jsxs(v,{xs:24,lg:16,children:[e.jsxs($,{style:{marginBottom:24},children:[e.jsxs(w,{level:4,style:{marginBottom:16},children:[e.jsx(A,{style:{marginRight:8,color:"#52c41a"}}),"Booking Summary"]}),e.jsxs(j,{bordered:!0,column:1,size:"small",children:[e.jsx(j.Item,{label:"Service",children:e.jsxs("div",{children:[e.jsx(a,{strong:!0,children:o.name}),e.jsx("br",{}),e.jsx(a,{type:"secondary",children:_(o.duration)})]})}),i.length>0&&e.jsx(j.Item,{label:"Extras",children:i.map(r=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(a,{children:["+ ",r.name]}),e.jsx("br",{}),e.jsx(a,{type:"secondary",children:f(r.price)})]},r.id))}),e.jsxs(j.Item,{label:"Appointment Date",children:[e.jsx(ce,{style:{marginRight:8}}),O(p)]}),e.jsxs(j.Item,{label:"Appointment Time",children:[e.jsx(de,{style:{marginRight:8}}),q(u)]}),e.jsx(j.Item,{label:"Total Duration",children:_(H)}),e.jsx(j.Item,{label:"Total Price",children:e.jsxs(a,{strong:!0,style:{fontSize:18,color:"#52c41a"},children:[e.jsx(pe,{style:{marginRight:8}}),f(B)]})})]})]}),e.jsxs($,{children:[e.jsxs(w,{level:4,style:{marginBottom:16},children:[e.jsx(L,{style:{marginRight:8}}),"Customer Information"]}),e.jsxs(m,{form:T,layout:"vertical",onFinish:re,initialValues:{payment_method:"card"},children:[b&&b.length>0?e.jsxs(e.Fragment,{children:[b.filter(r=>r.is_primary).map(r=>e.jsx(m.Item,{name:r.name,label:r.label,rules:M(r),help:r.help_text,children:E(r)},r.id)),b.filter(r=>!r.is_primary).map(r=>e.jsx(m.Item,{name:r.name,label:r.label,rules:M(r),help:r.help_text,children:E(r)},r.id)),e.jsx(m.Item,{name:"payment_method",label:"Payment Method",rules:[{required:!0,message:"Please select a payment method"}],children:e.jsxs(k,{size:"large",placeholder:"Select payment method",children:[e.jsxs(d,{value:"card",children:[e.jsx(h,{style:{marginRight:8}}),"Credit/Debit Card"]}),e.jsxs(d,{value:"upi",children:[e.jsx(h,{style:{marginRight:8}}),"UPI Payment"]}),e.jsxs(d,{value:"netbanking",children:[e.jsx(h,{style:{marginRight:8}}),"Net Banking"]}),e.jsxs(d,{value:"wallet",children:[e.jsx(h,{style:{marginRight:8}}),"Digital Wallet"]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{gutter:16,children:[e.jsx(v,{xs:24,sm:12,children:e.jsx(m.Item,{name:"customer_name",label:"Full Name",rules:[{required:!0,message:"Please enter your full name"}],children:e.jsx(l,{prefix:e.jsx(L,{}),placeholder:"Enter your full name",size:"large"})})}),e.jsx(v,{xs:24,sm:12,children:e.jsx(m.Item,{name:"customer_phone",label:"Phone Number",rules:[{required:!0,message:"Please enter your phone number"},{pattern:/^[0-9+\-\s()]+$/,message:"Please enter a valid phone number"}],children:e.jsx(l,{prefix:e.jsx(W,{}),placeholder:g?"Phone number verified":"Enter your phone number",size:"large",disabled:!!g,addonAfter:g?e.jsx(A,{style:{color:"green"}}):null})})})]}),e.jsx(m.Item,{name:"customer_email",label:"Email Address",rules:[{required:!0,message:"Please enter your email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(l,{prefix:e.jsx(G,{}),placeholder:"Enter your email address",size:"large"})}),e.jsx(m.Item,{name:"payment_method",label:"Payment Method",rules:[{required:!0,message:"Please select a payment method"}],children:e.jsxs(k,{size:"large",placeholder:"Select payment method",children:[e.jsxs(d,{value:"card",children:[e.jsx(h,{style:{marginRight:8}}),"Credit/Debit Card"]}),e.jsxs(d,{value:"upi",children:[e.jsx(h,{style:{marginRight:8}}),"UPI Payment"]}),e.jsxs(d,{value:"netbanking",children:[e.jsx(h,{style:{marginRight:8}}),"Net Banking"]}),e.jsxs(d,{value:"wallet",children:[e.jsx(h,{style:{marginRight:8}}),"Digital Wallet"]})]})}),e.jsx(m.Item,{name:"special_requests",label:"Special Requests (Optional)",children:e.jsx(l.TextArea,{rows:3,placeholder:"Any special requests or notes for your appointment..."})})]}),e.jsx(J,{message:"Booking Confirmation",description:"By clicking 'Confirm & Pay', you agree to our terms and conditions and confirm your appointment booking.",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx(Y,{size:"large",icon:e.jsx(ue,{}),onClick:ee,style:{flex:1},children:"Back to Terms"}),e.jsxs(Y,{type:"primary",size:"large",htmlType:"submit",loading:Z,icon:e.jsx(A,{}),style:{flex:2},children:["Confirm & Pay ",f(B)]})]})]})]})]}),e.jsx(v,{xs:24,lg:8,children:e.jsxs($,{style:{position:"sticky",top:24},children:[e.jsx(w,{level:4,style:{marginBottom:16},children:"Final Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(a,{strong:!0,children:o.name}),e.jsx(a,{children:f(o.price)})]}),e.jsx(a,{type:"secondary",style:{fontSize:12},children:_(o.duration)})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(a,{type:"secondary",style:{fontSize:12},children:"Employee will be automatically assigned based on availability"})}),i.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(R,{style:{margin:"12px 0"}}),i.map(r=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(a,{children:["+ ",r.name]}),e.jsx(a,{children:f(r.price)})]})},r.id))]}),e.jsx(R,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(a,{type:"secondary",children:"Appointment Date"}),e.jsx("div",{children:e.jsx(a,{strong:!0,children:O(p)})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(a,{type:"secondary",children:"Appointment Time"}),e.jsx("div",{children:e.jsx(a,{strong:!0,children:q(u)})})]}),e.jsx(R,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(a,{strong:!0,children:"Total Price"}),e.jsx(a,{strong:!0,style:{fontSize:18,color:"#52c41a"},children:f(B)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(a,{type:"secondary",children:"Total Duration"}),e.jsx(a,{type:"secondary",children:_(H)})]}),e.jsx(R,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(a,{type:"secondary",children:"Accepted Agreements"}),e.jsx("div",{children:C.map(r=>e.jsx(he,{color:"green",style:{marginTop:4},children:r.title},r.id))})]}),e.jsx(J,{message:"Secure Payment",description:`Your payment information is encrypted and secure. ${z?.razorpay_key?"Powered by Razorpay.":""}`,type:"success",showIcon:!0,style:{marginTop:16}}),z?.currency&&e.jsxs(a,{type:"secondary",style:{fontSize:12,display:"block",marginTop:8},children:["Currency: ",z.currency]})]})})]})]})]})}export{ir as default};
