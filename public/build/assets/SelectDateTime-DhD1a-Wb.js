import{r as S,j as e,H as Z,a as $}from"./app-BT0PBD5v.js";import{d as y}from"./dayjs.min-iFuAdwsj.js";import{A as ee}from"./AppLayout-BhYd1jex.js";import{ak as te,T as se,C as M,B as D}from"./Logo-CBsbfG2i.js";import{P as ae}from"./progress-qQN-lhyQ.js";import{R as H,C as B}from"./row-BmBoW_gX.js";import{R as oe}from"./CalendarOutlined-4pR6q61x.js";import{R as ne}from"./ClockCircleOutlined-x1u_407Q.js";import{S as re}from"./index-ByS1Z0ke.js";import{E as P}from"./index-6ufNqcJI.js";import{R as ie}from"./CheckOutlined-BGQabxFA.js";import{D as A}from"./index-BbnGm7O4.js";import{R as le}from"./ArrowLeftOutlined-DgB4V5X2.js";import{R as de}from"./ArrowRightOutlined-BkxyDA1y.js";/* empty css            */import"./CheckCircleFilled-t1GImBJH.js";import"./useBreakpoint-_zB_dkAU.js";const{Title:w,Text:o}=se;function Be({service:l,selectedExtras:h,scheduleSettings:f}){const[d,F]=S.useState(null),[x,R]=S.useState(null),[Y,T]=S.useState([]),[E,_]=S.useState(!1),[b,I]=S.useState(y()),N=l.duration+h.reduce((t,s)=>t+(s.duration||0),0),L=()=>{const t=h.map(s=>s.id);$.visit(route("booking.select-extras"),{data:{service_id:l.id,extras:t}})},O=()=>{if(d&&x){const t=h.map(s=>s.id);$.visit(route("booking.consent"),{data:{service_id:l.id,extras:t,date:d.format("YYYY-MM-DD"),time:x.format("HH:mm")}})}},G=async t=>{_(!0);try{console.log("Fetching slots for date:",t.format("YYYY-MM-DD")),console.log("Service ID:",l.id),console.log("Service duration:",l.duration);const a=await(await fetch(`${route("booking.available-slots")}?date=${t.format("YYYY-MM-DD")}&service_id=${l.id}`)).json();console.log("Available slots response:",a),a.slots&&a.slots.length>0?T(a.slots):(console.log("No slots returned from backend, using fallback"),T([{start:"09:00",end:"09:30",available:!0},{start:"09:30",end:"10:00",available:!0},{start:"10:00",end:"10:30",available:!0},{start:"10:30",end:"11:00",available:!0},{start:"11:00",end:"11:30",available:!0},{start:"11:30",end:"12:00",available:!0},{start:"14:00",end:"14:30",available:!0},{start:"14:30",end:"15:00",available:!0},{start:"15:00",end:"15:30",available:!0},{start:"15:30",end:"16:00",available:!0},{start:"16:00",end:"16:30",available:!0},{start:"16:30",end:"17:00",available:!0}]))}catch(s){console.error("Error fetching slots:",s),T([{start:"09:00",end:"09:30",available:!0},{start:"09:30",end:"10:00",available:!0},{start:"10:00",end:"10:30",available:!0},{start:"10:30",end:"11:00",available:!0},{start:"11:00",end:"11:30",available:!0},{start:"11:30",end:"12:00",available:!0},{start:"14:00",end:"14:30",available:!0},{start:"14:30",end:"15:00",available:!0},{start:"15:00",end:"15:30",available:!0},{start:"15:30",end:"16:00",available:!0},{start:"16:00",end:"16:30",available:!0},{start:"16:30",end:"17:00",available:!0}])}finally{_(!1)}},q=t=>{F(t),R(null),G(t)},J=t=>{R(t)},C=t=>`â‚¹${parseFloat(t).toFixed(2)}`,W=t=>{if(t<60)return`${t} min`;{const s=Math.floor(t/60),a=t%60;return a>0?`${s}h ${a}m`:`${s}h`}},z=t=>y(t,"HH:mm").format("h:mm A"),K=t=>{const s=t.year(),a=t.month(),r=y(new Date(s,a,1)),c=y(new Date(s,a+1,0)),n=r.startOf("week"),u=c.endOf("week"),i=[];let m=n;for(;m.isBefore(u)||m.isSame(u,"day");)i.push(m),m=m.add(1,"day");return i},Q=()=>{I(b.subtract(1,"month"))},U=()=>{I(b.add(1,"month"))},V=t=>{const s=y(),a=f?.[0];if(!a)return t.isAfter(s.subtract(1,"day"))&&t.isBefore(s.add(31,"day"));const r=a.min_advance_hours||2,c=a.max_advance_days||30,n=a.working_days||[1,2,3,4,5],u=s.add(r,"hour"),i=s.add(c,"day"),m=t.isAfter(u)&&t.isBefore(i),g=t.day(),p=g===0?7:g,v=n.includes(p);return m&&v};return e.jsxs(ee,{children:[e.jsx(Z,{title:"Select Date & Time - Book Appointment"}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(te,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(w,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),e.jsx(o,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),f&&f.length>0&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(o,{type:"secondary",style:{fontSize:"12px"},children:["ðŸ“… Booking window:"," ",f[0].booking_window_days," days ahead â€¢ â° Min advance:"," ",f[0].min_advance_hours," hours â€¢ ðŸ• Working hours:"," ",f[0].start_time," -"," ",f[0].end_time," â€¢ ðŸ“† Working days: ",f[0].working_days_text]})})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(ae,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(o,{type:"secondary",children:"Step 3 of 5"})})]}),e.jsxs(H,{gutter:[32,32],children:[e.jsxs(B,{xs:24,lg:16,children:[e.jsxs(M,{style:{marginBottom:24},children:[e.jsxs(w,{level:4,style:{marginBottom:16},children:[e.jsx(oe,{style:{marginRight:8}}),"Select Date"]}),e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{size:"small",onClick:Q,style:{border:"none",boxShadow:"none"},children:"â€¹"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:b.format("MMMM YYYY")}),e.jsx(D,{size:"small",onClick:U,style:{border:"none",boxShadow:"none"},children:"â€º"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(t=>e.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:t},t))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:K(b).map((t,s)=>{const a=y(),r=t.isBefore(a,"day"),c=t.isSame(a,"day"),n=d&&d.isSame(t,"day"),u=t.month()===b.month(),i=V(t),m={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:i&&!r?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:u?1:.3};let g="transparent",p="#333",v="1px solid transparent";r?p="#999":n?(g="#e6f7ff",p="#1890ff",v="2px solid #1890ff"):c&&!d?(g="#1890ff",p="white",v="none"):i?p="#333":p="#999";let k="";if(r)k="Past date - cannot be selected";else if(i)k=`Available for booking on ${t.format("dddd, MMMM D")}`;else{const j=t.day(),X=j===0?7:j;(f?.[0]?.working_days||[1,2,3,4,5]).includes(X)?k="Date not available for booking":k=`${t.format("dddd")} - Not a working day`}return e.jsxs("div",{style:{...m,backgroundColor:g,color:p,border:v},title:k,onMouseEnter:j=>{i&&!r&&!n&&(j.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:j=>{i&&!r&&!n&&(j.currentTarget.style.backgroundColor="transparent")},onClick:()=>{i&&!r&&q(t)},children:[t.date(),c&&e.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},s)})})]})]})]}),d&&e.jsxs(M,{children:[e.jsxs(w,{level:4,style:{marginBottom:16},children:[e.jsx(ne,{style:{marginRight:8}}),"Available Time Slots"]}),E?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(re,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(o,{type:"secondary",children:"Loading available slots..."})})]}):Y.length===0?e.jsx(P,{description:"No available slots for this date",image:P.PRESENTED_IMAGE_SIMPLE}):e.jsx(H,{gutter:[12,12],children:Y.map((t,s)=>{const a=typeof t=="object"?t.start:t,r=y(a,"HH:mm"),c=x&&x.format("HH:mm")===a,n=typeof t=="object"?t.available!==!1:!0;return e.jsx(B,{xs:12,sm:8,md:6,children:e.jsx(D,{size:"large",disabled:!n,style:{width:"100%",height:48,border:c?"2px solid #1890ff":n?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:c?"#e6f7ff":n?"white":"#fff2f0",opacity:n?1:.6},onClick:()=>n&&J(r),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[c&&e.jsx(ie,{style:{marginRight:8,color:"#1890ff"}}),z(a)]}),!n&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},s)})})]})]}),e.jsx(B,{xs:24,lg:8,children:e.jsxs(M,{style:{position:"sticky",top:24},children:[e.jsx(w,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(o,{strong:!0,children:l.name}),e.jsx(o,{children:C(l.price)})]}),e.jsx(o,{type:"secondary",style:{fontSize:12},children:W(l.duration)})]}),h.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{margin:"12px 0"}}),h.map(t=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(o,{children:["+ ",t.name]}),e.jsx(o,{children:C(t.price)})]})},t.id))]}),e.jsx(A,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(o,{strong:!0,children:"Total Price"}),e.jsx(o,{strong:!0,style:{fontSize:16},children:C(parseFloat(l.price)+h.reduce((t,s)=>t+parseFloat(s.price),0))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(o,{type:"secondary",children:"Total Duration"}),e.jsx(o,{type:"secondary",children:W(N)})]}),(d||x)&&e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(o,{type:"secondary",children:"Selected Date"}),e.jsx("div",{children:e.jsx(o,{strong:!0,children:d?d.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),e.jsxs("div",{children:[e.jsx(o,{type:"secondary",children:"Selected Time"}),e.jsx("div",{children:e.jsx(o,{strong:!0,children:x?z(x):"Not selected"})})]})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(D,{block:!0,style:{marginBottom:12},icon:e.jsx(le,{}),onClick:L,children:"Back to Extras"}),e.jsx(D,{type:"primary",block:!0,size:"large",icon:e.jsx(de,{}),onClick:O,disabled:!d||!x,children:"Continue to Consent"})]})]})})]})]})]})}export{Be as default};
