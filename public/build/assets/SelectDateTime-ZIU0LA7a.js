import{r as D,j as e,H as te,a as H}from"./app-B0cWkBWz.js";import{d as b}from"./dayjs.min-DYLjuGX6.js";import{B as oe}from"./BookingHeader-Cdwhey2Z.js";import{aa as ne,T as se,C as w,B as k}from"./Logo-BdBrmI7S.js";import{P as re}from"./progress-Dg_tEXUU.js";import{R as P,C}from"./row-CarD1OOM.js";import{R as ie}from"./CalendarOutlined-DRNv4K1_.js";import{R as ae}from"./ClockCircleOutlined-DAAxrAWg.js";import{S as le}from"./index-DeLtARYN.js";import{E as F}from"./index-DRY20BuI.js";import{R as de}from"./CheckOutlined-Czr40q_G.js";import{D as I}from"./index-Bvkzo-Jn.js";import{R as ce}from"./ArrowLeftOutlined-Bw10PqbN.js";import{R as me}from"./ArrowRightOutlined-Ucg3po1z.js";/* empty css            */import"./CustomerLoginModal-1083HXRl.js";import"./index-CHmL9A8j.js";import"./CheckCircleFilled-Bzti_DAd.js";import"./InfoCircleFilled-BG1v0Kdu.js";import"./pickAttrs-BYNbLnRC.js";import"./useClosable-C3NTBGzV.js";import"./PurePanel-P76UYIOx.js";import"./PhoneOutlined-B9lDR37l.js";import"./LockOutlined-BAJ-PRGV.js";import"./index-BDbgyLmG.js";import"./Input-CnuedqSf.js";import"./EyeOutlined-BEq4RqmN.js";import"./EyeOutlined-Bmd706kk.js";import"./index-DBBHLkC6.js";import"./index-DzU9cNkj.js";import"./index-Cy8ytTRt.js";import"./LogoutOutlined-D3grUEh9.js";import"./BookOutlined-Cj3M7L4e.js";const{Title:M,Text:l}=se;function Ge({service:f,selectedExtras:p,scheduleSettings:c,auth:L}){const[x,O]=D.useState(null),[y,B]=D.useState(null),[R,T]=D.useState([]),[E,_]=D.useState(!1),[S,A]=D.useState(b());console.log("SelectDateTime component - Schedule settings:",{scheduleSettings:c,scheduleSettingsLength:c?.length,firstSchedule:c?.[0]});const $=f.duration+p.reduce((t,o)=>t+(o.duration||0),0),q=()=>{const t=p.map(o=>o.id);H.visit(route("booking.select-extras"),{data:{service_id:f.id,extras:t}})},G=()=>{if(x&&y){const t=p.map(o=>o.id);H.visit(route("booking.consent"),{data:{service_id:f.id,extras:t,date:x.format("YYYY-MM-DD"),time:y.format("HH:mm")}})}},U=async t=>{_(!0);try{console.log("Fetching slots for date:",t.format("YYYY-MM-DD")),console.log("Service ID:",f.id),console.log("Service duration:",f.duration),console.log("Selected extras:",p),console.log("Total duration:",$);const o=new URLSearchParams({date:t.format("YYYY-MM-DD"),service_id:f.id});p.length>0&&p.forEach(r=>{o.append("extras[]",r.id)}),console.log("Normal booking - Request params:",o.toString()),console.log("Normal booking - Selected extras:",p);const n=await(await fetch(`${route("booking.available-slots")}?${o.toString()}`)).json();console.log("Available slots response:",n),n.slots&&n.slots.length>0?T(n.slots):(console.log("No slots returned from backend"),T([]))}catch(o){console.error("Error fetching slots:",o),T([])}finally{_(!1)}},V=t=>{O(t),B(null),U(t)},J=t=>{B(t)},Y=t=>`₹${parseFloat(t).toFixed(2)}`,W=t=>{if(t<60)return`${t} min`;{const o=Math.floor(t/60),s=t%60;return s>0?`${o}h ${s}m`:`${o}h`}},z=t=>{try{if(!t)return console.error("Time is null or undefined"),"Invalid Time";let o=t;if(t&&typeof t=="object"&&t.format?o=t.format("HH:mm"):typeof t=="object"&&t.start&&(o=t.start),!o||typeof o!="string")return console.error("Invalid time format:",t),"Invalid Time";const s=o.match(/^(\d{1,2}):(\d{2})$/);if(!s)return console.error("Invalid time string format:",o),"Invalid Time";const n=parseInt(s[1],10),r=parseInt(s[2],10);if(n<0||n>23||r<0||r>59)return console.error("Invalid time values:",n,r),"Invalid Time";const d=n>=12?"PM":"AM",m=n===0?12:n>12?n-12:n,i=r.toString().padStart(2,"0");return`${m}:${i} ${d}`}catch(o){return console.error("Error formatting time:",o,t),"Invalid Time"}},K=t=>{const o=t.year(),s=t.month(),n=b(new Date(o,s,1)),r=b(new Date(o,s+1,0)),d=n.startOf("week"),m=r.endOf("week"),i=[];let a=d;for(;a.isBefore(m)||a.isSame(m,"day");)i.push(a),a=a.add(1,"day");return i},Q=()=>{A(S.subtract(1,"month"))},X=()=>{A(S.add(1,"month"))},Z=t=>{const o=b(),s=c?.[0];if(!s)return!1;const n=s.min_advance_hours,r=s.max_advance_days,d=s.working_days,m=o.add(n,"hour"),i=o.add(r,"day"),a=t.isSame(o,"day"),j=a||t.isAfter(m)&&(t.isBefore(i)||t.isSame(i,"day")),h=t.day(),v=h===0?7:h,u=d.includes(v),g=j&&u;return(t.isSame(o,"day")||t.format("YYYY-MM-DD")==="2025-08-18")&&console.log("Date selectability check:",{date:t.format("YYYY-MM-DD"),isToday:a,isWithinRange:j,isWorkingDay:u,isSelectable:g,minAdvanceHours:n,maxAdvanceDays:r,workingDays:d,adjustedDayOfWeek:v,minDate:m.format("YYYY-MM-DD"),maxDate:i.format("YYYY-MM-DD"),scheduleSettings:c,defaultSchedule:s}),g};return e.jsxs("div",{children:[e.jsx(te,{title:"Select Date & Time - Book Appointment"}),e.jsx(oe,{auth:L}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(ne,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(M,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),e.jsx(l,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),c&&c.length>0&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(l,{type:"secondary",style:{fontSize:"12px"},children:["📅 Booking window:"," ",c[0].booking_window_days," days ahead • ⏰ Min advance:"," ",c[0].min_advance_hours," hours • 🕐 Working hours:"," ",c[0].start_time," -"," ",c[0].end_time," • 📆 Working days: ",c[0].working_days_text]})})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(re,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(l,{type:"secondary",children:"Step 3 of 5"})})]}),e.jsxs(P,{gutter:[32,32],children:[e.jsxs(C,{xs:24,lg:16,children:[e.jsxs(w,{style:{marginBottom:24},children:[e.jsxs(M,{level:4,style:{marginBottom:16},children:[e.jsx(ie,{style:{marginRight:8}}),"Select Date"]}),e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(k,{size:"small",onClick:Q,style:{border:"none",boxShadow:"none"},children:"‹"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:S.format("MMMM YYYY")}),e.jsx(k,{size:"small",onClick:X,style:{border:"none",boxShadow:"none"},children:"›"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(t=>e.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:t},t))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:K(S).map((t,o)=>{const s=b(),n=t.isBefore(s,"day"),r=t.isSame(s,"day"),d=x&&x.isSame(t,"day"),m=t.month()===S.month(),i=Z(t),a={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:i&&!n?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:m?1:.3};let j="transparent",h="#333",v="1px solid transparent";n?h="#999":d?(j="#e6f7ff",h="#1890ff",v="2px solid #1890ff"):r&&!x?(j="#1890ff",h="white",v="none"):i?h="#333":h="#999";let u="";if(n)u="Past date - cannot be selected";else if(i)u=`Available for booking on ${t.format("dddd, MMMM D")}`;else{const g=t.day(),ee=g===0?7:g,N=c?.[0]?.working_days;N&&!N.includes(ee)?u=`${t.format("dddd")} - Not a working day`:u="Date not available for booking"}return e.jsxs("div",{style:{...a,backgroundColor:j,color:h,border:v},title:u,onMouseEnter:g=>{i&&!n&&!d&&(g.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:g=>{i&&!n&&!d&&(g.currentTarget.style.backgroundColor="transparent")},onClick:()=>{i&&!n&&V(t)},children:[t.date(),r&&e.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},o)})})]})]})]}),x&&e.jsxs(w,{children:[e.jsxs(M,{level:4,style:{marginBottom:16},children:[e.jsx(ae,{style:{marginRight:8}}),"Available Time Slots"]}),E?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(le,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(l,{type:"secondary",children:"Loading available slots..."})})]}):R.length===0?e.jsx(F,{description:"No available slots for this date",image:F.PRESENTED_IMAGE_SIMPLE}):e.jsx(P,{gutter:[12,12],children:R.map((t,o)=>{const s=typeof t=="object"?t.start:t;if(!s||typeof s!="string")return console.error("Invalid slot start time:",s,"for slot:",t),null;const n=s.split(":");if(n.length!==2)return console.error("Invalid time format:",s),null;const r=parseInt(n[0],10),d=parseInt(n[1],10);if(isNaN(r)||isNaN(d)||r<0||r>23||d<0||d>59)return console.error("Invalid time values:",r,d,"for slot:",s),null;const m=b().hour(r).minute(d).second(0).millisecond(0),i=y&&y.format("HH:mm")===s,a=typeof t=="object"?t.available!==!1:!0;return e.jsx(C,{xs:12,sm:8,md:6,children:e.jsx(k,{size:"large",disabled:!a,style:{width:"100%",height:48,border:i?"2px solid #1890ff":a?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:i?"#e6f7ff":a?"white":"#fff2f0",opacity:a?1:.6},onClick:()=>a&&J(m),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[i&&e.jsx(de,{style:{marginRight:8,color:"#1890ff"}}),z(s)]}),!a&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},o)}).filter(Boolean)})]})]}),e.jsx(C,{xs:24,lg:8,children:e.jsxs(w,{style:{position:"sticky",top:24},children:[e.jsx(M,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(l,{strong:!0,children:f.name}),e.jsx(l,{children:Y(f.price)})]}),e.jsx(l,{type:"secondary",style:{fontSize:12},children:W(f.duration)})]}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(I,{style:{margin:"12px 0"}}),p.map(t=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(l,{children:["+ ",t.name]}),e.jsx(l,{children:Y(t.price)})]})},t.id))]}),e.jsx(I,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(l,{strong:!0,children:"Total Price"}),e.jsx(l,{strong:!0,style:{fontSize:16},children:Y(parseFloat(f.price)+p.reduce((t,o)=>t+parseFloat(o.price),0))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{type:"secondary",children:"Total Duration"}),e.jsx(l,{type:"secondary",children:W($)})]}),(x||y)&&e.jsxs(e.Fragment,{children:[e.jsx(I,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(l,{type:"secondary",children:"Selected Date"}),e.jsx("div",{children:e.jsx(l,{strong:!0,children:x?x.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),e.jsxs("div",{children:[e.jsx(l,{type:"secondary",children:"Selected Time"}),e.jsx("div",{children:e.jsx(l,{strong:!0,children:y&&y.isValid()?z(y):"Not selected"})})]})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(k,{block:!0,style:{marginBottom:12},icon:e.jsx(ce,{}),onClick:q,children:"Back to Extras"}),e.jsx(k,{type:"primary",block:!0,size:"large",icon:e.jsx(me,{}),onClick:G,disabled:!x||!y,children:"Continue to Consent"})]})]})})]})]})]})}export{Ge as default};
