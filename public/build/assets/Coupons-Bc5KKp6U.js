import{r as m,j as e,H,a as w}from"./app-CTnpJe6s.js";import{A as L,R as O}from"./AdminLayout-CQY0PddB.js";import{d as _}from"./dayjs.min-BPJK2rob.js";import{F as i}from"./index-D_7Mj0Ta.js";import{C as W,T as J,B as u}from"./Logo-Biljuc-Y.js";import{R as K}from"./GiftOutlined-BtTa7HJg.js";import{R as a,C as r}from"./row-DcqefiXp.js";import{I as f}from"./index-DMq3Xvyi.js";import{R as Q}from"./SearchOutlined-B5cwJgdy.js";import{S as h}from"./index-ChBeB8qW.js";import{F as G}from"./Table-BXyrPl2e.js";import{M as X}from"./index-D4ViXHP2.js";import{T as p}from"./index-OGHt-QKK.js";import{D as F}from"./index-DD-343Vd.js";import{S as Z}from"./index-Cypur1WL.js";import{S as o}from"./CalendarOutlined-BM3-G7F1.js";import{s as x}from"./index-CtW8XKZp.js";import{T as I}from"./index-AXm3g50X.js";import{B as ee}from"./index-BCQ3nbjw.js";import{R as se}from"./EditOutlined-Bx_mX-hc.js";import{P as te}from"./index-Dw4nXLys.js";import{R as ie}from"./DeleteOutlined-gv3QWYhn.js";/* empty css            */import"./index-Ca_16It4.js";import"./PurePanel-DoOMq_kn.js";import"./move-M8L2ISRZ.js";import"./LogoutOutlined-DMJJUOr0.js";import"./UserOutlined-D2rDMwbZ.js";import"./ClockCircleOutlined-CGmtAK_w.js";import"./FileTextOutlined-B0sPJ-VI.js";import"./SettingOutlined-099kgk59.js";import"./useForm-66eOu3XW.js";import"./CheckCircleFilled-D9BfS9XO.js";import"./InfoCircleFilled-Da70DYLE.js";import"./Input-DfhxBwA6.js";import"./pickAttrs-BUARLshW.js";import"./EyeOutlined-BLbdxot3.js";import"./index-B4prJx6-.js";import"./addEventListener-Bw6NzHsG.js";import"./index-DfOgfXYp.js";import"./index-4iFzE4R6.js";import"./index-NkXij_5v.js";import"./useClosable-C0XzdfFj.js";const{Title:re,Text:n}=J,{Option:l}=h,{Search:le}=f,{TextArea:ne}=f;function Qe({auth:A,coupons:D,services:T}){const[R,g]=m.useState(!1),[c,v]=m.useState(null),[d]=i.useForm(),[j,z]=m.useState(""),[C,Y]=m.useState("all"),[E,b]=m.useState("percentage"),P=()=>{v(null),b("percentage"),d.resetFields(),g(!0)},k=s=>{v(s),b(s.discount_type);const t={...s,discount_value:parseFloat(s.discount_value)||null,minimum_amount:parseFloat(s.minimum_amount)||null,maximum_discount:s.maximum_discount?parseFloat(s.maximum_discount):null,valid_from:s.valid_from?_(s.valid_from):null,valid_until:s.valid_until?_(s.valid_until):null};d.setFieldsValue(t),g(!0)},S=()=>{g(!1),v(null),d.resetFields()},U=async s=>{try{console.log("Form values:",s);const t={code:s.code,name:s.name,description:s.description||"",discount_type:s.discount_type,discount_value:s.discount_value,minimum_amount:s.minimum_amount,maximum_discount:s.maximum_discount||null,max_uses:s.max_uses||null,max_uses_per_user:s.max_uses_per_user,valid_from:s.valid_from?s.valid_from.format("YYYY-MM-DD HH:mm:ss"):null,valid_until:s.valid_until?s.valid_until.format("YYYY-MM-DD HH:mm:ss"):null,is_active:s.is_active??!0,applicable_services:s.applicable_services||[],excluded_services:s.excluded_services||[]};console.log("Form data to submit:",t),c?await w.put(`/admin/coupons/${c.id}`,t):await w.post("/admin/coupons",t),x.success(`Coupon ${c?"updated":"created"} successfully!`),S()}catch(t){if(console.error("Coupon submission error:",t),console.error("Error details:",t.response?.data),t.response?.data?.errors){const y=t.response.data.errors;Object.keys(y).forEach(M=>{d.setFields([{name:M,errors:y[M]}])}),x.error("Please fix the validation errors above.")}else x.error("An error occurred. Please try again.")}},V=async s=>{try{await w.post(`/admin/coupons/${s}/delete`),x.success("Coupon deleted successfully!")}catch{x.error("An error occurred. Please try again.")}},$=s=>{switch(s){case"Active":return"success";case"Inactive":return"error";case"Expired":return"warning";case"Not Started":return"processing";case"Fully Used":return"default";default:return"default"}},B=s=>s==="percentage"?"blue":"green",N=D.filter(s=>{const t=j===""||s.code.toLowerCase().includes(j.toLowerCase())||s.name.toLowerCase().includes(j.toLowerCase()),y=C==="all"||s.validity_status===C;return t&&y}),q=[{title:"Code",key:"code",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsx(n,{strong:!0,style:{fontSize:"16px",fontFamily:"monospace"},children:t.code}),e.jsx(n,{type:"secondary",style:{fontSize:"12px"},children:t.name})]})},{title:"Discount",key:"discount",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsx(I,{color:B(t.discount_type),children:t.discount_text}),t.minimum_amount>0&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["Min: Rs. ",t.minimum_amount]}),t.maximum_discount&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["Max: Rs. ",t.maximum_discount]})]})},{title:"Usage",key:"usage",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsxs(n,{children:[t.used_count," / ",t.max_uses||"âˆž"]}),e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:[t.max_uses_per_user," per user"]})]})},{title:"Validity",key:"validity",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsx(ee,{status:$(t.validity_status),text:t.validity_status}),t.valid_from&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["From:"," ",_(t.valid_from).format("MMM DD, YYYY")]}),t.valid_until&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["Until:"," ",_(t.valid_until).format("MMM DD, YYYY")]})]})},{title:"Restrictions",key:"restrictions",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[t.applicable_services&&t.applicable_services.length>0&&e.jsx(I,{color:"blue",children:"Service specific"}),t.excluded_services&&t.excluded_services.length>0&&e.jsx(I,{color:"red",children:"Excluded services"})]})},{title:"Actions",key:"actions",render:(s,t)=>e.jsxs(o,{children:[e.jsx(u,{type:"primary",icon:e.jsx(se,{}),size:"small",onClick:()=>k(t),children:"Edit"}),e.jsx(te,{title:"Are you sure you want to delete this coupon?",onConfirm:()=>V(t.id),okText:"Yes",cancelText:"No",children:e.jsx(u,{type:"default",danger:!0,icon:e.jsx(ie,{}),size:"small",disabled:t.used_count>0,children:"Delete"})})]})}];return e.jsxs(L,{auth:A,children:[e.jsx(H,{title:"Coupons"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(W,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[e.jsxs(re,{level:2,style:{margin:0},children:[e.jsx(K,{style:{marginRight:8}}),"Coupons"]}),e.jsx(u,{type:"primary",icon:e.jsx(O,{}),onClick:P,children:"Create Coupon"})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(le,{placeholder:"Search by code or name",allowClear:!0,value:j,onChange:s=>z(s.target.value),prefix:e.jsx(Q,{})})}),e.jsx(r,{span:4,children:e.jsxs(h,{placeholder:"Status",value:C,onChange:Y,style:{width:"100%"},children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"Active",children:"Active"}),e.jsx(l,{value:"Inactive",children:"Inactive"}),e.jsx(l,{value:"Expired",children:"Expired"}),e.jsx(l,{value:"Not Started",children:"Not Started"}),e.jsx(l,{value:"Fully Used",children:"Fully Used"})]})})]})}),e.jsx(G,{columns:q,dataSource:N,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,t)=>`${t[0]}-${t[1]} of ${s} coupons`}})]}),e.jsx(X,{title:c?"Edit Coupon":"Create Coupon",open:R,onCancel:S,footer:null,width:800,children:e.jsxs(i,{form:d,layout:"vertical",onFinish:U,validateOnMount:!1,initialValues:{discount_type:"percentage",max_uses_per_user:1,is_active:!0},children:[e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"code",label:"Coupon Code",rules:[{required:!0,message:"Please enter coupon code"},{min:3,message:"Code must be at least 3 characters"}],children:e.jsx(f,{placeholder:"e.g., WELCOME20"})})}),e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"name",label:"Coupon Name",rules:[{required:!0,message:"Please enter coupon name"}],children:e.jsx(f,{placeholder:"e.g., Welcome Discount"})})})]}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(ne,{rows:3,placeholder:"Optional description"})}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"discount_type",label:"Discount Type",rules:[{required:!0,message:"Please select discount type"}],children:e.jsxs(h,{onChange:s=>b(s),children:[e.jsx(l,{value:"percentage",children:"Percentage"}),e.jsx(l,{value:"fixed",children:"Fixed Amount"})]})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"discount_value",label:"Discount Value",rules:[{required:!0,message:"Please enter discount value"},{type:"number",min:0,message:"Value must be positive"}],validateTrigger:["onChange","onBlur"],children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 20",min:0,precision:2,addonAfter:E==="percentage"?"%":"Rs."})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"minimum_amount",label:"Minimum Amount",rules:[{required:!0,message:"Please enter minimum amount"},{type:"number",min:0,message:"Amount must be positive"}],validateTrigger:["onChange","onBlur"],children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 500",min:0,precision:2,addonAfter:"Rs."})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"maximum_discount",label:"Maximum Discount",children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 1000",min:0,precision:2,addonAfter:"Rs."})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"max_uses",label:"Max Total Uses",children:e.jsx(p,{style:{width:"100%"},placeholder:"Unlimited",min:1})})}),e.jsxs(r,{span:8,children:[e.jsx(i.Item,{name:"max_uses_per_user",label:"Max Uses Per User",rules:[{required:!0,message:"Please enter max uses per user"},{type:"number",min:1,message:"Must be at least 1"}],children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 1",min:1})}),e.jsx(n,{type:"secondary",style:{fontSize:"12px"},children:"Set to 1 for first-time user only coupons"})]})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"valid_from",label:"Valid From",children:e.jsx(F,{style:{width:"100%"},showTime:!0,placeholder:"Start date & time"})})}),e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"valid_until",label:"Valid Until",children:e.jsx(F,{style:{width:"100%"},showTime:!0,placeholder:"End date & time"})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"applicable_services",label:"Applicable Services",children:e.jsx(h,{mode:"multiple",placeholder:"All services (if none selected)",allowClear:!0,children:T.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})})}),e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"excluded_services",label:"Excluded Services",children:e.jsx(h,{mode:"multiple",placeholder:"No exclusions",allowClear:!0,children:T.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})})})]}),e.jsx(a,{gutter:16,children:e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"is_active",label:"Active",valuePropName:"checked",children:e.jsx(Z,{})})})}),e.jsx(i.Item,{style:{marginTop:24,textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(u,{onClick:S,children:"Cancel"}),e.jsxs(u,{type:"primary",htmlType:"submit",children:[c?"Update":"Create"," Coupon"]})]})})]})})]})]})}export{Qe as default};
