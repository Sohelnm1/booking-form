import{r as k,j as e,H as ee,a as z}from"./app-C-_7uao2.js";import{d as b}from"./dayjs.min-J00tXd4b.js";import{B as te}from"./BookingHeader-BCf0B0cj.js";import{ad as ae,T as oe,C as w,B as D}from"./Logo-B1o7Ze6Y.js";import{P as se}from"./progress-CsQPCzSU.js";import{R as P,C}from"./row-rnKDuNpk.js";import{R as le}from"./CalendarOutlined-DsF39C_E.js";import{R as ne}from"./ClockCircleOutlined-jcAVxpt2.js";import{S as ie}from"./index-D4oThtvI.js";import{E as F}from"./index-PTmwT_P4.js";import{R as re}from"./CheckOutlined-CQG1YUXj.js";import{D as B}from"./index-DVbAbT5o.js";import{R as de}from"./ArrowLeftOutlined-J1EZFMt9.js";import{R as ce}from"./ArrowRightOutlined-B9JvKEJE.js";/* empty css            */import"./LogoutOutlined-CcOqAjwU.js";import"./index-D87hQRyl.js";import"./CheckCircleFilled-b2Lbp7ff.js";import"./InfoCircleFilled-BXOvrJG9.js";import"./pickAttrs-CYwhknCO.js";import"./BookOutlined-83y4ltn8.js";const{Title:T,Text:i}=oe;function Ae({service:d,selectedExtras:p,scheduleSettings:y,auth:N}){const[c,E]=k.useState(null),[f,I]=k.useState(null),[Y,_]=k.useState([]),[L,R]=k.useState(!1),[j,A]=k.useState(b()),$=d.duration+p.reduce((t,a)=>t+(a.duration||0),0),O=()=>{const t=p.map(a=>a.id);z.visit(route("booking.select-extras"),{data:{service_id:d.id,extras:t}})},V=()=>{if(c&&f){const t=p.map(a=>a.id);z.visit(route("booking.consent"),{data:{service_id:d.id,extras:t,date:c.format("YYYY-MM-DD"),time:f.format("HH:mm")}})}},G=async t=>{R(!0);try{console.log("Fetching slots for date:",t.format("YYYY-MM-DD")),console.log("Service ID:",d.id),console.log("Service duration:",d.duration),console.log("Selected extras:",p),console.log("Total duration:",$);const a=new URLSearchParams({date:t.format("YYYY-MM-DD"),service_id:d.id});p.length>0&&p.forEach(l=>{a.append("extras[]",l.id)});const o=await(await fetch(`${route("booking.available-slots")}?${a.toString()}`)).json();console.log("Available slots response:",o),o.slots&&o.slots.length>0?_(o.slots):(console.log("No slots returned from backend, using fallback"),_([{start:"09:00",end:"09:30",available:!1,available_employees:0},{start:"09:30",end:"10:00",available:!1,available_employees:0},{start:"10:00",end:"10:30",available:!1,available_employees:0},{start:"10:30",end:"11:00",available:!1,available_employees:0},{start:"11:00",end:"11:30",available:!1,available_employees:0},{start:"11:30",end:"12:00",available:!1,available_employees:0},{start:"14:00",end:"14:30",available:!1,available_employees:0},{start:"14:30",end:"15:00",available:!1,available_employees:0},{start:"15:00",end:"15:30",available:!1,available_employees:0},{start:"15:30",end:"16:00",available:!1,available_employees:0},{start:"16:00",end:"16:30",available:!1,available_employees:0},{start:"16:30",end:"17:00",available:!1,available_employees:0}]))}catch(a){console.error("Error fetching slots:",a),_([{start:"09:00",end:"09:30",available:!1,available_employees:0},{start:"09:30",end:"10:00",available:!1,available_employees:0},{start:"10:00",end:"10:30",available:!1,available_employees:0},{start:"10:30",end:"11:00",available:!1,available_employees:0},{start:"11:00",end:"11:30",available:!1,available_employees:0},{start:"11:30",end:"12:00",available:!1,available_employees:0},{start:"14:00",end:"14:30",available:!1,available_employees:0},{start:"14:30",end:"15:00",available:!1,available_employees:0},{start:"15:00",end:"15:30",available:!1,available_employees:0},{start:"15:30",end:"16:00",available:!1,available_employees:0},{start:"16:00",end:"16:30",available:!1,available_employees:0},{start:"16:30",end:"17:00",available:!1,available_employees:0}])}finally{R(!1)}},U=t=>{console.log("Date selected:",t.format("YYYY-MM-DD")),E(t),I(null),G(t)},q=t=>{console.log("Time selected:",t.format("HH:mm")),I(t)},M=t=>`â‚¹${parseFloat(t).toFixed(2)}`,H=t=>{if(t<60)return`${t} min`;{const a=Math.floor(t/60),s=t%60;return s>0?`${a}h ${s}m`:`${a}h`}},W=t=>{console.log("formatTime called with:",t,typeof t);try{if(!t)return console.error("Time is null or undefined"),"Invalid Time";let a=t;if(t&&typeof t=="object"&&t.format?a=t.format("HH:mm"):typeof t=="object"&&t.start&&(a=t.start),!a||typeof a!="string")return console.error("Invalid time format:",t),"Invalid Time";const s=a.match(/^(\d{1,2}):(\d{2})$/);if(!s)return console.error("Invalid time string format:",a),"Invalid Time";const o=parseInt(s[1],10),l=parseInt(s[2],10);if(o<0||o>23||l<0||l>59)return console.error("Invalid time values:",o,l),"Invalid Time";const n=o>=12?"PM":"AM",g=o===0?12:o>12?o-12:o,r=l.toString().padStart(2,"0");return`${g}:${r} ${n}`}catch(a){return console.error("Error formatting time:",a,t),"Invalid Time"}},J=t=>{const a=t.year(),s=t.month(),o=b(new Date(a,s,1)),l=b(new Date(a,s+1,0)),n=o.startOf("week"),g=l.endOf("week"),r=[];let m=n;for(;m.isBefore(g)||m.isSame(g,"day");)r.push(m),m=m.add(1,"day");return r},K=()=>{A(j.subtract(1,"month"))},Q=()=>{A(j.add(1,"month"))},X=t=>{const a=b(),s=y?.[0];if(!s)return t.isAfter(a.subtract(1,"day"))&&t.isBefore(a.add(31,"day"));const o=s.min_advance_hours||2,l=s.max_advance_days||30,n=s.working_days||[1,2,3,4,5],g=a.add(o,"hour"),r=a.add(l,"day"),m=t.isSame(a,"day"),v=m||t.isAfter(g)&&t.isBefore(r),x=t.day(),S=x===0?7:x,u=n.includes(S),h=v&&u;return t.isSame(a,"day")&&console.log("Today date check:",{date:t.format("YYYY-MM-DD"),isToday:m,isWithinRange:v,isWorkingDay:u,isSelectable:h,minAdvanceHours:o,workingDays:n}),h};return e.jsxs("div",{children:[e.jsx(ee,{title:"Select Date & Time - Book Appointment"}),e.jsx(te,{auth:N}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(ae,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(T,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),e.jsx(i,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),y&&y.length>0&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(i,{type:"secondary",style:{fontSize:"12px"},children:["ðŸ“… Booking window:"," ",y[0].booking_window_days," days ahead â€¢ â° Min advance:"," ",y[0].min_advance_hours," hours â€¢ ðŸ• Working hours:"," ",y[0].start_time," -"," ",y[0].end_time," â€¢ ðŸ“† Working days: ",y[0].working_days_text]})})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(se,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(i,{type:"secondary",children:"Step 3 of 5"})})]}),e.jsxs(P,{gutter:[32,32],children:[e.jsxs(C,{xs:24,lg:16,children:[e.jsxs(w,{style:{marginBottom:24},children:[e.jsxs(T,{level:4,style:{marginBottom:16},children:[e.jsx(le,{style:{marginRight:8}}),"Select Date"]}),e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{size:"small",onClick:K,style:{border:"none",boxShadow:"none"},children:"â€¹"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:j.format("MMMM YYYY")}),e.jsx(D,{size:"small",onClick:Q,style:{border:"none",boxShadow:"none"},children:"â€º"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(t=>e.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:t},t))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:J(j).map((t,a)=>{const s=b(),o=t.isBefore(s,"day"),l=t.isSame(s,"day"),n=c&&c.isSame(t,"day"),g=t.month()===j.month(),r=X(t),m={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:r&&!o?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:g?1:.3};let v="transparent",x="#333",S="1px solid transparent";o?x="#999":n?(v="#e6f7ff",x="#1890ff",S="2px solid #1890ff"):l&&!c?(v="#1890ff",x="white",S="none"):r?x="#333":x="#999";let u="";if(o)u="Past date - cannot be selected";else if(r)u=`Available for booking on ${t.format("dddd, MMMM D")}`;else{const h=t.day(),Z=h===0?7:h;(y?.[0]?.working_days||[1,2,3,4,5]).includes(Z)?u="Date not available for booking":u=`${t.format("dddd")} - Not a working day`}return e.jsxs("div",{style:{...m,backgroundColor:v,color:x,border:S},title:u,onMouseEnter:h=>{r&&!o&&!n&&(h.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:h=>{r&&!o&&!n&&(h.currentTarget.style.backgroundColor="transparent")},onClick:()=>{r&&!o&&U(t)},children:[t.date(),l&&e.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},a)})})]})]})]}),c&&e.jsxs(w,{children:[e.jsxs(T,{level:4,style:{marginBottom:16},children:[e.jsx(ne,{style:{marginRight:8}}),"Available Time Slots"]}),L?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(ie,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(i,{type:"secondary",children:"Loading available slots..."})})]}):Y.length===0?e.jsx(F,{description:"No available slots for this date",image:F.PRESENTED_IMAGE_SIMPLE}):e.jsx(P,{gutter:[12,12],children:Y.map((t,a)=>{const s=typeof t=="object"?t.start:t;if(!s||typeof s!="string")return console.error("Invalid slot start time:",s,"for slot:",t),null;console.log("Rendering slot:",{slot:t,slotStart:s,index:a});const o=b(s,"HH:mm");if(!o.isValid())return console.error("Invalid dayjs parsing for slot:",s,"result:",o),null;const l=f&&f.format("HH:mm")===s,n=typeof t=="object"?t.available!==!1:!0;return e.jsx(C,{xs:12,sm:8,md:6,children:e.jsx(D,{size:"large",disabled:!n,style:{width:"100%",height:48,border:l?"2px solid #1890ff":n?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:l?"#e6f7ff":n?"white":"#fff2f0",opacity:n?1:.6},onClick:()=>n&&q(o),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[l&&e.jsx(re,{style:{marginRight:8,color:"#1890ff"}}),W(s)]}),!n&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},a)}).filter(Boolean)})]})]}),e.jsx(C,{xs:24,lg:8,children:e.jsxs(w,{style:{position:"sticky",top:24},children:[e.jsx(T,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(i,{strong:!0,children:d.name}),e.jsx(i,{children:M(d.price)})]}),e.jsx(i,{type:"secondary",style:{fontSize:12},children:H(d.duration)})]}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{margin:"12px 0"}}),p.map(t=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(i,{children:["+ ",t.name]}),e.jsx(i,{children:M(t.price)})]})},t.id))]}),e.jsx(B,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(i,{strong:!0,children:"Total Price"}),e.jsx(i,{strong:!0,style:{fontSize:16},children:M(parseFloat(d.price)+p.reduce((t,a)=>t+parseFloat(a.price),0))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(i,{type:"secondary",children:"Total Duration"}),e.jsx(i,{type:"secondary",children:H($)})]}),(c||f)&&e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(i,{type:"secondary",children:"Selected Date"}),e.jsx("div",{children:e.jsx(i,{strong:!0,children:c?c.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),e.jsxs("div",{children:[e.jsx(i,{type:"secondary",children:"Selected Time"}),e.jsx("div",{children:e.jsx(i,{strong:!0,children:f&&f.isValid()?(console.log("Calling formatTime with selectedTime:",f),W(f)):"Not selected"})})]})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(D,{block:!0,style:{marginBottom:12},icon:e.jsx(de,{}),onClick:O,children:"Back to Extras"}),e.jsx(D,{type:"primary",block:!0,size:"large",icon:e.jsx(ce,{}),onClick:V,disabled:!c||!f,children:"Continue to Consent"})]})]})})]})]})]})}export{Ae as default};
