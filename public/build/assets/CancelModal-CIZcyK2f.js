import{r as c,b as v,j as e}from"./app-DM8mHM6T.js";import{F as d}from"./index-h_QUQNGj.js";import{M as E}from"./index-BZvJRm4C.js";import{A as p}from"./index-odL7-f9g.js";import{T as $,B as C}from"./Logo-BtQWxE8e.js";import{S as h}from"./index-BLuLJRHE.js";import{D as _}from"./index-C0Sossdu.js";import{I as D}from"./index-D5GqZUJv.js";import{R as B}from"./ExclamationCircleOutlined-3oBrKpLc.js";import{S as L}from"./index-C2u7ABHH.js";const{Text:n,Title:T}=$,{TextArea:R}=D,J=({visible:m,onCancel:b,onSuccess:F,booking:t,isAdmin:l=!1})=>{const[u]=d.useForm(),[x,y]=c.useState(!1),[S,j]=c.useState(!1),[s,k]=c.useState(null),[g,r]=c.useState(null);c.useEffect(()=>{m&&t&&I()},[m,t]);const I=async()=>{if(t){j(!0),r(null);try{const o=l?`/admin/appointments/${t.id}/policy`:`/customer/bookings/${t.id}/policy`,i=await v.get(o);i.data.success?k(i.data.data.policy):r("Failed to load booking policy")}catch(o){console.error("Error fetching booking policy:",o),r("Failed to load booking policy")}finally{j(!1)}}},P=async o=>{y(!0),r(null);try{const i=l?`/admin/appointments/${t.id}/cancel`:`/customer/bookings/${t.id}/cancel`,a=await v.post(i,{reason:o.reason||null});a.data.success?F(a.data):r(a.data.message||"Failed to cancel booking")}catch(i){console.error("Error cancelling booking:",i);const a=i.response?.data?.message||"Failed to cancel booking";r(a)}finally{y(!1)}},f=()=>{u.resetFields(),r(null),b()},A=()=>{if(S)return e.jsx(L,{size:"small"});if(!s)return e.jsx(n,{type:"secondary",children:"No policy information available"});const{cancellation:o}=s;return e.jsx("div",{children:e.jsxs(h,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Policy: "}),e.jsx(n,{children:s.name})]}),e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Cancellation Window: "}),e.jsxs(n,{children:[o.window_hours," hours before appointment"]})]}),e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Refund Policy: "}),e.jsx(n,{children:o.policy})]}),o.late_fee>0&&e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Late Cancellation Fee: "}),e.jsxs(n,{type:"danger",children:["₹",o.late_fee]}),e.jsxs(n,{type:"secondary",children:[" ","(if cancelled within"," ",o.late_fee_window," hours)"]})]}),e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Time Until Appointment: "}),e.jsx(n,{type:o.hours_until_appointment<0?"danger":"secondary",children:o.hours_until_appointment<0?"Appointment has passed":`${o.hours_until_appointment} hours`})]})]})})},w=s&&s.cancellation?.allowed;return e.jsxs(E,{title:e.jsxs(h,{children:[e.jsx(B,{style:{color:"#ff4d4f"}}),e.jsx("span",{children:l?"Admin Cancel Booking":"Cancel Booking"})]}),open:m,onCancel:f,footer:null,width:600,destroyOnClose:!0,children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(p,{message:l?"Admin Cancellation Warning":"Cancellation Warning",description:l?"Are you sure you want to cancel this booking as an admin? This action cannot be undone and will override any customer cancellation policies.":"Are you sure you want to cancel this booking? This action cannot be undone.",type:"warning",showIcon:!0,style:{marginBottom:16}})}),g&&e.jsx(p,{message:"Error",description:g,type:"error",showIcon:!0,style:{marginBottom:16}}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(T,{level:5,children:"Booking Details"}),e.jsxs(h,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Service: "}),e.jsx(n,{children:t?.service?.name})]}),e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Date & Time: "}),e.jsx(n,{children:t?.appointment_time?new Date(t.appointment_time).toLocaleString():"N/A"})]}),e.jsxs("div",{children:[e.jsx(n,{strong:!0,children:"Amount: "}),e.jsxs(n,{children:["₹",t?.total_amount]})]})]})]}),e.jsx(_,{}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(T,{level:5,children:"Cancellation Policy"}),A()]}),!w&&s&&e.jsx(p,{message:"Cancellation Not Allowed",description:`This booking cannot be cancelled. The cancellation window is ${s.cancellation?.window_hours} hours before the appointment.`,type:"error",showIcon:!0,style:{marginBottom:16}}),w&&e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsxs(d,{form:u,layout:"vertical",onFinish:P,children:[s?.cancellation?.require_reason&&e.jsx(d.Item,{label:"Cancellation Reason",name:"reason",rules:[{required:!0,message:"Please provide a reason for cancellation"}],children:e.jsx(R,{rows:4,placeholder:"Please explain why you need to cancel this booking..."})}),e.jsx(d.Item,{style:{marginBottom:0},children:e.jsxs(h,{style:{width:"100%",justifyContent:"flex-end"},children:[e.jsx(C,{onClick:f,disabled:x,children:"Keep Booking"}),e.jsx(C,{type:"primary",danger:!0,htmlType:"submit",loading:x,icon:e.jsx(B,{}),children:"Cancel Booking"})]})})]})]})]})};export{J as C};
