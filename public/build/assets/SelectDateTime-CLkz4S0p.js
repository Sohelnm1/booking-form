import{r as S,j as e,H as ae,a as Q}from"./app-C8g8NPlW.js";import{d as M}from"./dayjs.min-C8D6uy6L.js";import{B as le}from"./BookingHeader-K0WWg-n8.js";import{a9 as de,T as ce,C as Y,B as b}from"./Logo-CDqhpTsI.js";import{P as pe}from"./progress-Dez_ubCl.js";import{R as H,C}from"./row-BBkur2F_.js";import{R as me}from"./CalendarOutlined-B3TgQEw7.js";import{A as fe}from"./index-kv2ZU-Ew.js";import{R as xe}from"./ClockCircleOutlined-DqtaExyq.js";import{S as ye}from"./index-Bgp-nV7Q.js";import{E}from"./index-BomWxtKH.js";import{R as he}from"./CheckOutlined-ClLlzt6r.js";import{T as ue}from"./index-DAuFP0fy.js";import{D as z}from"./index-Bi5b3Spo.js";import{R as ge}from"./ArrowLeftOutlined-B6zu6WF4.js";import{R as je}from"./ArrowRightOutlined-BOynHfFe.js";/* empty css            */import"./CustomerLoginModal-phdVw1M7.js";import"./index-f4TWz8zb.js";import"./CheckCircleFilled-MrEsiJ-J.js";import"./InfoCircleFilled-CRmqDlzt.js";import"./pickAttrs-CL77P40i.js";import"./useClosable-BmhHyeLv.js";import"./extendsObject-78o_rR5W.js";import"./PurePanel-DRVFJyWS.js";import"./PhoneOutlined-BB-yXM8E.js";import"./LockOutlined-Dj6L2BDk.js";import"./index-Dj2znBUR.js";import"./Input-BEvITN8p.js";import"./EyeOutlined-DKEMeNFp.js";import"./EyeOutlined-Bmd706kk.js";import"./index-DKkFCNyw.js";import"./index-BF9Z3oFg.js";import"./index-DKjJxjzr.js";import"./LogoutOutlined-Cjf3cbtA.js";import"./BookOutlined-BSP247HQ.js";const{Title:I,Text:i}=ce;function st({service:p,selectedExtras:y,scheduleSettings:x,selectedPricingTier:s,selectedDuration:ve,selectedPrice:_e,bookingSettings:m,auth:G}){const[h,P]=S.useState(null),[g,R]=S.useState(null),[N,T]=S.useState([]),[U,$]=S.useState(!1),[B,F]=S.useState(M()),[f,A]=S.useState("no_preference"),[V,W]=S.useState(!1);console.log("SelectDateTime component - Schedule settings:",{scheduleSettings:x,scheduleSettingsLength:x?.length,firstSchedule:x?.[0]});const K=(s?s.duration_minutes:p.duration)+y.reduce((t,n)=>{const r=n.quantity||1;if(n.durationRelation){const o=n.durationRelation.hours*60+n.durationRelation.minutes;return t+o*r}return t+(n.total_duration||0)*r},0),X=()=>{const t=y.map(o=>o.id),n=y.map(o=>({id:o.id,quantity:o.quantity||1})),r=encodeURIComponent(JSON.stringify(n));Q.visit(route("booking.select-extras"),{data:{service_id:p.id,pricing_tier_id:s?.id,selected_duration:s?.duration_minutes||p.duration,selected_price:s?.price||p.price,extras:t,extra_quantities_json:r}})},Z=()=>{if(h&&g){const t=y.map(o=>o.id),n=y.map(o=>({id:o.id,quantity:o.quantity||1})),r=encodeURIComponent(JSON.stringify(n));Q.visit(route("booking.consent"),{data:{service_id:p.id,pricing_tier_id:s?.id,selected_duration:s?.duration_minutes||p.duration,selected_price:s?.price||p.price,extras:t,extra_quantities_json:r,date:h.format("YYYY-MM-DD"),time:g.format("HH:mm"),gender_preference:f}})}},q=async t=>{$(!0);try{console.log("Fetching slots for date:",t.format("YYYY-MM-DD")),console.log("Service ID:",p.id),console.log("Service duration:",p.duration),console.log("Selected extras:",y),console.log("Total duration:",K),console.log("Gender preference:",f);const n=new URLSearchParams({date:t.format("YYYY-MM-DD"),service_id:p.id});s&&(n.append("pricing_tier_id",s.id),n.append("selected_duration",s.duration_minutes),n.append("selected_price",s.price)),y.length>0&&y.forEach(a=>{n.append("extras[]",a.id)}),m?.enable_gender_preference&&n.append("gender_preference",f),console.log("Normal booking - Request params:",n.toString()),console.log("Normal booking - Selected extras:",y);const o=await(await fetch(`${route("booking.available-slots")}?${n.toString()}`)).json();console.log("Available slots response:",o),o.slots&&o.slots.length>0?T(o.slots):(console.log("No slots returned from backend"),T([]))}catch(n){console.error("Error fetching slots:",n),T([])}finally{$(!1)}},ee=t=>{P(t),R(null),q(t)};S.useEffect(()=>{h&&m?.enable_gender_preference&&(g&&(R(null),W(!0),setTimeout(()=>W(!1),5e3)),q(h))},[f]);const te=t=>{R(t)},k=t=>`₹${parseFloat(t).toFixed(2)}`,O=t=>{if(t<60)return`${t} min`;{const n=Math.floor(t/60),r=t%60;return r>0?`${n}h ${r}m`:`${n}h`}},L=t=>{try{if(!t)return console.error("Time is null or undefined"),"Invalid Time";let n=t;if(t&&typeof t=="object"&&t.format?n=t.format("HH:mm"):typeof t=="object"&&t.start&&(n=t.start),!n||typeof n!="string")return console.error("Invalid time format:",t),"Invalid Time";const r=n.match(/^(\d{1,2}):(\d{2})$/);if(!r)return console.error("Invalid time string format:",n),"Invalid Time";const o=parseInt(r[1],10),a=parseInt(r[2],10);if(o<0||o>23||a<0||a>59)return console.error("Invalid time values:",o,a),"Invalid Time";const c=o>=12?"PM":"AM",u=o===0?12:o>12?o-12:o,l=a.toString().padStart(2,"0");return`${u}:${l} ${c}`}catch(n){return console.error("Error formatting time:",n,t),"Invalid Time"}},ne=t=>{const n=t.year(),r=t.month(),o=M(new Date(n,r,1)),a=M(new Date(n,r+1,0)),c=o.startOf("week"),u=a.endOf("week"),l=[];let d=c;for(;d.isBefore(u)||d.isSame(u,"day");)l.push(d),d=d.add(1,"day");return l},oe=()=>{F(B.subtract(1,"month"))},re=()=>{F(B.add(1,"month"))},ie=t=>{const n=M(),r=x?.[0];if(!r)return!1;const o=r.min_advance_hours,a=r.max_advance_days,c=r.working_days,u=n.add(o,"hour"),l=n.add(a,"day"),d=t.isSame(n,"day"),D=d||t.isAfter(u)&&(t.isBefore(l)||t.isSame(l,"day")),j=t.day(),w=j===0?7:j,_=c.includes(w),v=D&&_;return(t.isSame(n,"day")||t.format("YYYY-MM-DD")==="2025-08-18")&&console.log("Date selectability check:",{date:t.format("YYYY-MM-DD"),isToday:d,isWithinRange:D,isWorkingDay:_,isSelectable:v,minAdvanceHours:o,maxAdvanceDays:a,workingDays:c,adjustedDayOfWeek:w,minDate:u.format("YYYY-MM-DD"),maxDate:l.format("YYYY-MM-DD"),scheduleSettings:x,defaultSchedule:r}),v};return e.jsxs("div",{children:[e.jsx(ae,{title:"Select Date & Time - Book Appointment"}),e.jsx(le,{auth:G}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(de,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(I,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),e.jsx(i,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),x&&x.length>0&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(i,{type:"secondary",style:{fontSize:"12px"},children:["📅 Booking window:"," ",x[0].booking_window_days," days ahead • ⏰ Min advance:"," ",x[0].min_advance_hours," hours • 🕐 Working hours:"," ",x[0].start_time," -"," ",x[0].end_time," • 📆 Working days: ",x[0].working_days_text]})})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(pe,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(i,{type:"secondary",children:"Step 3 of 5"})})]}),e.jsxs(H,{gutter:[24,24],children:[e.jsxs(C,{xs:24,xl:16,lg:14,children:[e.jsxs(Y,{style:{marginBottom:24},children:[e.jsxs(I,{level:4,style:{marginBottom:16},children:[e.jsx(me,{style:{marginRight:8}}),"Select Date"]}),e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(b,{size:"small",onClick:oe,style:{border:"none",boxShadow:"none"},children:"‹"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:B.format("MMMM YYYY")}),e.jsx(b,{size:"small",onClick:re,style:{border:"none",boxShadow:"none"},children:"›"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(t=>e.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:t},t))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:ne(B).map((t,n)=>{const r=M(),o=t.isBefore(r,"day"),a=t.isSame(r,"day"),c=h&&h.isSame(t,"day"),u=t.month()===B.month(),l=ie(t),d={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:l&&!o?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:u?1:.3};let D="transparent",j="#333",w="1px solid transparent";o?j="#999":c?(D="#e6f7ff",j="#1890ff",w="2px solid #1890ff"):a&&!h?(D="#1890ff",j="white",w="none"):l?j="#333":j="#999";let _="";if(o)_="Past date - cannot be selected";else if(l)_=`Available for booking on ${t.format("dddd, MMMM D")}`;else{const v=t.day(),se=v===0?7:v,J=x?.[0]?.working_days;J&&!J.includes(se)?_=`${t.format("dddd")} - Not a working day`:_="Date not available for booking"}return e.jsxs("div",{style:{...d,backgroundColor:D,color:j,border:w},title:_,onMouseEnter:v=>{l&&!o&&!c&&(v.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:v=>{l&&!o&&!c&&(v.currentTarget.style.backgroundColor="transparent")},onClick:()=>{l&&!o&&ee(t)},children:[t.date(),a&&e.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},n)})})]})]})]}),m?.enable_gender_preference&&e.jsxs(Y,{style:{marginBottom:24},children:[e.jsxs(I,{level:4,style:{marginBottom:16},children:[e.jsx("span",{style:{marginRight:8},children:"👥"}),m?.gender_preference_label||"Preferred HospiPal"]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(i,{type:"secondary",children:m?.gender_preference_description||"Select your preferred HospiPal gender. Choosing a specific gender may incur an additional fee."})}),e.jsxs(H,{gutter:[12,12],children:[e.jsx(C,{xs:24,sm:8,children:e.jsxs(b,{type:f==="no_preference"?"primary":"default",style:{width:"100%",height:"100px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"16px 12px"},onClick:()=>A("no_preference"),children:[e.jsx("div",{style:{fontSize:"22px",marginBottom:"8px",lineHeight:1},children:"🤝"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",textAlign:"center"},children:"No Preference"}),e.jsx("div",{style:{fontSize:"12px",color:"#666",textAlign:"center"},children:"Auto-assign"})]})}),e.jsx(C,{xs:24,sm:8,children:e.jsxs(b,{type:f==="male"?"primary":"default",style:{width:"100%",height:"100px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"16px 12px"},onClick:()=>A("male"),children:[e.jsx("div",{style:{fontSize:"22px",marginBottom:"8px",lineHeight:1},children:"👨"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",textAlign:"center"},children:"Male"}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",textAlign:"center"},children:["+₹",m?.male_preference_fee||0]})]})}),e.jsx(C,{xs:24,sm:8,children:e.jsxs(b,{type:f==="female"?"primary":"default",style:{width:"100%",height:"100px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",padding:"16px 12px"},onClick:()=>A("female"),children:[e.jsx("div",{style:{fontSize:"22px",marginBottom:"8px",lineHeight:1},children:"👩"}),e.jsx("div",{style:{fontSize:"14px",fontWeight:"600",marginBottom:"4px",textAlign:"center"},children:"Female"}),e.jsxs("div",{style:{fontSize:"12px",color:"#666",textAlign:"center"},children:["+₹",m?.female_preference_fee||0]})]})})]})]}),V&&e.jsx(fe,{message:"Time slot reset",description:"Your selected time has been cleared because the available slots changed with your gender preference. Please select a new time slot.",type:"info",showIcon:!0,closable:!0,onClose:()=>W(!1),style:{marginBottom:16}}),h&&e.jsxs(Y,{children:[e.jsxs(I,{level:4,style:{marginBottom:16},children:[e.jsx(xe,{style:{marginRight:8}}),"Available Time Slots",m?.enable_gender_preference&&f!=="no_preference"&&e.jsxs(i,{type:"secondary",style:{fontSize:14,marginLeft:8},children:["(Filtered for"," ",f==="male"?"Male":"Female"," ","HospiPal)"]})]}),U?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(ye,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(i,{type:"secondary",children:"Loading available slots..."})})]}):N.length===0?e.jsx(E,{description:"No available slots for this date",image:E.PRESENTED_IMAGE_SIMPLE}):e.jsx(H,{gutter:[12,12],children:N.map((t,n)=>{const r=typeof t=="object"?t.start:t;if(!r||typeof r!="string")return console.error("Invalid slot start time:",r,"for slot:",t),null;const o=r.split(":");if(o.length!==2)return console.error("Invalid time format:",r),null;const a=parseInt(o[0],10),c=parseInt(o[1],10);if(isNaN(a)||isNaN(c)||a<0||a>23||c<0||c>59)return console.error("Invalid time values:",a,c,"for slot:",r),null;const u=M().hour(a).minute(c).second(0).millisecond(0),l=g&&g.format("HH:mm")===r,d=typeof t=="object"?t.available!==!1:!0;return e.jsx(C,{xs:12,sm:8,md:6,children:e.jsx(b,{size:"large",disabled:!d,style:{width:"100%",height:48,border:l?"2px solid #1890ff":d?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:l?"#e6f7ff":d?"white":"#fff2f0",opacity:d?1:.6},onClick:()=>d&&te(u),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[l&&e.jsx(he,{style:{marginRight:8,color:"#1890ff"}}),L(r)]}),!d&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},n)}).filter(Boolean)})]})]}),e.jsx(C,{xs:24,xl:8,lg:10,children:e.jsxs(Y,{style:{position:"sticky",top:24},children:[e.jsx(I,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(i,{strong:!0,children:[p.name,s&&e.jsx(ue,{color:"blue",style:{marginLeft:8,fontSize:10},children:s.name})]}),e.jsx(i,{children:k(s?s.price:p.price)})]}),e.jsx(i,{type:"secondary",style:{fontSize:12},children:s?O(s.duration_minutes):p.duration_label||O(p.duration)})]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(z,{style:{margin:"12px 0"}}),y.map(t=>{const n=t.quantity||1;return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(i,{children:["+ ",t.name,n>1&&e.jsxs(i,{type:"secondary",style:{fontSize:12},children:[" ","× ",n]})]}),e.jsx(i,{children:k(parseFloat(t.price)*n)})]}),e.jsxs(i,{type:"secondary",style:{fontSize:12},children:[t.duration_relation?t.duration_relation.label:"No additional time",n>1&&e.jsxs(i,{type:"secondary",style:{fontSize:12},children:[" ","× ",n]})]})]},t.id)})]}),m?.enable_gender_preference&&f!=="no_preference"&&e.jsxs(e.Fragment,{children:[e.jsx(z,{style:{margin:"12px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(i,{children:["+"," ",f==="male"?"Male":"Female"," ","Preference"]}),e.jsx(i,{children:k(f==="male"?m?.male_preference_fee||0:m?.female_preference_fee||0)})]})]}),e.jsx(z,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(i,{strong:!0,children:"Total Price"}),e.jsx(i,{strong:!0,style:{fontSize:16},children:k(parseFloat(s?s.price:p.price)+y.reduce((t,n)=>{const r=n.quantity||1;return t+parseFloat(n.price)*r},0)+(m?.enable_gender_preference&&f!=="no_preference"?f==="male"?m?.male_preference_fee||0:m?.female_preference_fee||0:0))})]}),(h||g)&&e.jsxs(e.Fragment,{children:[e.jsx(z,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(i,{type:"secondary",children:"Selected Date"}),e.jsx("div",{children:e.jsx(i,{strong:!0,children:h?h.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),e.jsxs("div",{children:[e.jsx(i,{type:"secondary",children:"Selected Time"}),e.jsx("div",{children:e.jsx(i,{strong:!0,children:g&&g.isValid()?L(g):"Not selected"})})]})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(b,{block:!0,style:{marginBottom:12,height:"40px",fontSize:"13px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},icon:e.jsx(ge,{}),onClick:X,children:"← Back"}),e.jsx(b,{type:"primary",block:!0,size:"large",style:{height:"44px",fontSize:"13px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},icon:e.jsx(je,{}),onClick:Z,disabled:!h||!g,children:"Continue →"})]})]})})]})]})]})}export{st as default};
