import{r as m,j as e,H as L,a as I}from"./app-3tTvWG7F.js";import{A as O}from"./AdminLayout-D_9Fxt-K.js";import{d as y}from"./dayjs.min-BKNG2TBz.js";import{F as i}from"./index-CTnKv-J6.js";import{C as W,T as J,B as u}from"./Logo-rayZKRcw.js";import{R as K}from"./GiftOutlined-Dtz9EpI0.js";import{R as Q}from"./PlusOutlined-DYW8kB3o.js";import{R as a,C as r}from"./row-C65rk7Ki.js";import{I as g}from"./index-BTdPj1Qo.js";import{R as G}from"./SearchOutlined-BQEL0NTF.js";import{S as h}from"./index-COVV0ej8.js";import{F as X}from"./Table-vQmYyUIp.js";import{M as Z}from"./index-CFEXor_e.js";import{T as p}from"./index-ZZ2YxTUO.js";import{D as M}from"./index-P0Rvbp7-.js";import{S as A}from"./index-CY6fL3op.js";import{S as o}from"./index-p4o9N5do.js";import{s as x}from"./index-BifKxE5H.js";import{T as f}from"./index--pVH7BcC.js";import{B as ee}from"./index-Cc7IyuMM.js";import{R as se}from"./EditOutlined-CD-S8o6w.js";import{P as te}from"./index-DsSUm5zC.js";import{R as ie}from"./DeleteOutlined-BoPt6pT3.js";/* empty css            */import"./index-IPmGLXg8.js";import"./PurePanel-DXiUjHrT.js";import"./move-BVQvMDGH.js";import"./useBreakpoint-7Cp1MNIL.js";import"./CalendarOutlined-Cndvh6Iq.js";import"./ClockCircleOutlined-CjPCZBGw.js";import"./FileTextOutlined-DseNwxBW.js";import"./useForm-DSJ2AETk.js";import"./CheckCircleFilled-DFLxh8X4.js";import"./ExclamationCircleFilled-BGQteKAO.js";import"./Input-DaIDtzBe.js";import"./pickAttrs-Dt8ggxWk.js";import"./EyeOutlined-n83X2x7U.js";import"./index-BWgYkv6T.js";import"./addEventListener-01mFqfQT.js";import"./index-1l_CTVwk.js";import"./index-ChTt3zmJ.js";import"./index-Bycx1CbC.js";import"./InfoCircleFilled-CJ6Fm1u3.js";const{Title:re,Text:n}=J,{Option:l}=h,{Search:le}=g,{TextArea:ne}=g;function Qe({auth:D,coupons:R,services:F}){const[Y,v]=m.useState(!1),[c,C]=m.useState(null),[d]=i.useForm(),[j,z]=m.useState(""),[b,E]=m.useState("all"),[P,S]=m.useState("percentage"),k=()=>{C(null),S("percentage"),d.resetFields(),v(!0)},U=s=>{C(s),S(s.discount_type);const t={...s,discount_value:parseFloat(s.discount_value)||null,minimum_amount:parseFloat(s.minimum_amount)||null,maximum_discount:s.maximum_discount?parseFloat(s.maximum_discount):null,valid_from:s.valid_from?y(s.valid_from):null,valid_until:s.valid_until?y(s.valid_until):null};d.setFieldsValue(t),v(!0)},w=()=>{v(!1),C(null),d.resetFields()},V=async s=>{try{console.log("Form values:",s);const t={code:s.code,name:s.name,description:s.description||"",discount_type:s.discount_type,discount_value:s.discount_value,minimum_amount:s.minimum_amount,maximum_discount:s.maximum_discount||null,max_uses:s.max_uses||null,max_uses_per_user:s.max_uses_per_user,valid_from:s.valid_from?s.valid_from.format("YYYY-MM-DD HH:mm:ss"):null,valid_until:s.valid_until?s.valid_until.format("YYYY-MM-DD HH:mm:ss"):null,is_active:s.is_active??!0,is_first_time_only:s.is_first_time_only??!1,applicable_services:s.applicable_services||[],excluded_services:s.excluded_services||[]};console.log("Form data to submit:",t),c?await I.put(`/admin/coupons/${c.id}`,t):await I.post("/admin/coupons",t),x.success(`Coupon ${c?"updated":"created"} successfully!`),w()}catch(t){if(console.error("Coupon submission error:",t),console.error("Error details:",t.response?.data),t.response?.data?.errors){const _=t.response.data.errors;Object.keys(_).forEach(T=>{d.setFields([{name:T,errors:_[T]}])}),x.error("Please fix the validation errors above.")}else x.error("An error occurred. Please try again.")}},$=async s=>{try{await I.post(`/admin/coupons/${s}/delete`),x.success("Coupon deleted successfully!")}catch{x.error("An error occurred. Please try again.")}},N=s=>{switch(s){case"Active":return"success";case"Inactive":return"error";case"Expired":return"warning";case"Not Started":return"processing";case"Fully Used":return"default";default:return"default"}},B=s=>s==="percentage"?"blue":"green",q=R.filter(s=>{const t=j===""||s.code.toLowerCase().includes(j.toLowerCase())||s.name.toLowerCase().includes(j.toLowerCase()),_=b==="all"||s.validity_status===b;return t&&_}),H=[{title:"Code",key:"code",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsx(n,{strong:!0,style:{fontSize:"16px",fontFamily:"monospace"},children:t.code}),e.jsx(n,{type:"secondary",style:{fontSize:"12px"},children:t.name})]})},{title:"Discount",key:"discount",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsx(f,{color:B(t.discount_type),children:t.discount_text}),t.minimum_amount>0&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["Min: Rs. ",t.minimum_amount]}),t.maximum_discount&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["Max: Rs. ",t.maximum_discount]})]})},{title:"Usage",key:"usage",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsxs(n,{children:[t.used_count," / ",t.max_uses||"âˆž"]}),e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:[t.max_uses_per_user," per user"]})]})},{title:"Validity",key:"validity",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[e.jsx(ee,{status:N(t.validity_status),text:t.validity_status}),t.valid_from&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["From:"," ",y(t.valid_from).format("MMM DD, YYYY")]}),t.valid_until&&e.jsxs(n,{type:"secondary",style:{fontSize:"12px"},children:["Until:"," ",y(t.valid_until).format("MMM DD, YYYY")]})]})},{title:"Restrictions",key:"restrictions",render:(s,t)=>e.jsxs(o,{direction:"vertical",size:"small",children:[t.is_first_time_only&&e.jsx(f,{color:"orange",children:"First-time only"}),t.applicable_services&&t.applicable_services.length>0&&e.jsx(f,{color:"blue",children:"Service specific"}),t.excluded_services&&t.excluded_services.length>0&&e.jsx(f,{color:"red",children:"Excluded services"})]})},{title:"Actions",key:"actions",render:(s,t)=>e.jsxs(o,{children:[e.jsx(u,{type:"primary",icon:e.jsx(se,{}),size:"small",onClick:()=>U(t),children:"Edit"}),e.jsx(te,{title:"Are you sure you want to delete this coupon?",onConfirm:()=>$(t.id),okText:"Yes",cancelText:"No",children:e.jsx(u,{type:"default",danger:!0,icon:e.jsx(ie,{}),size:"small",disabled:t.used_count>0,children:"Delete"})})]})}];return e.jsxs(O,{auth:D,children:[e.jsx(L,{title:"Coupons"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(W,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[e.jsxs(re,{level:2,style:{margin:0},children:[e.jsx(K,{style:{marginRight:8}}),"Coupons"]}),e.jsx(u,{type:"primary",icon:e.jsx(Q,{}),onClick:k,children:"Create Coupon"})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(le,{placeholder:"Search by code or name",allowClear:!0,value:j,onChange:s=>z(s.target.value),prefix:e.jsx(G,{})})}),e.jsx(r,{span:4,children:e.jsxs(h,{placeholder:"Status",value:b,onChange:E,style:{width:"100%"},children:[e.jsx(l,{value:"all",children:"All Status"}),e.jsx(l,{value:"Active",children:"Active"}),e.jsx(l,{value:"Inactive",children:"Inactive"}),e.jsx(l,{value:"Expired",children:"Expired"}),e.jsx(l,{value:"Not Started",children:"Not Started"}),e.jsx(l,{value:"Fully Used",children:"Fully Used"})]})})]})}),e.jsx(X,{columns:H,dataSource:q,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,t)=>`${t[0]}-${t[1]} of ${s} coupons`}})]}),e.jsx(Z,{title:c?"Edit Coupon":"Create Coupon",open:Y,onCancel:w,footer:null,width:800,children:e.jsxs(i,{form:d,layout:"vertical",onFinish:V,validateOnMount:!1,initialValues:{discount_type:"percentage",max_uses_per_user:1,is_active:!0,is_first_time_only:!1},children:[e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"code",label:"Coupon Code",rules:[{required:!0,message:"Please enter coupon code"},{min:3,message:"Code must be at least 3 characters"}],children:e.jsx(g,{placeholder:"e.g., WELCOME20"})})}),e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"name",label:"Coupon Name",rules:[{required:!0,message:"Please enter coupon name"}],children:e.jsx(g,{placeholder:"e.g., Welcome Discount"})})})]}),e.jsx(i.Item,{name:"description",label:"Description",children:e.jsx(ne,{rows:3,placeholder:"Optional description"})}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"discount_type",label:"Discount Type",rules:[{required:!0,message:"Please select discount type"}],children:e.jsxs(h,{onChange:s=>S(s),children:[e.jsx(l,{value:"percentage",children:"Percentage"}),e.jsx(l,{value:"fixed",children:"Fixed Amount"})]})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"discount_value",label:"Discount Value",rules:[{required:!0,message:"Please enter discount value"},{type:"number",min:0,message:"Value must be positive"}],validateTrigger:["onChange","onBlur"],children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 20",min:0,precision:2,addonAfter:P==="percentage"?"%":"Rs."})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"minimum_amount",label:"Minimum Amount",rules:[{required:!0,message:"Please enter minimum amount"},{type:"number",min:0,message:"Amount must be positive"}],validateTrigger:["onChange","onBlur"],children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 500",min:0,precision:2,addonAfter:"Rs."})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"maximum_discount",label:"Maximum Discount",children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 1000",min:0,precision:2,addonAfter:"Rs."})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"max_uses",label:"Max Total Uses",children:e.jsx(p,{style:{width:"100%"},placeholder:"Unlimited",min:1})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"max_uses_per_user",label:"Max Uses Per User",rules:[{required:!0,message:"Please enter max uses per user"},{type:"number",min:1,message:"Must be at least 1"}],children:e.jsx(p,{style:{width:"100%"},placeholder:"e.g., 1",min:1})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"valid_from",label:"Valid From",children:e.jsx(M,{style:{width:"100%"},showTime:!0,placeholder:"Start date & time"})})}),e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"valid_until",label:"Valid Until",children:e.jsx(M,{style:{width:"100%"},showTime:!0,placeholder:"End date & time"})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"applicable_services",label:"Applicable Services",children:e.jsx(h,{mode:"multiple",placeholder:"All services (if none selected)",allowClear:!0,children:F.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})})}),e.jsx(r,{span:12,children:e.jsx(i.Item,{name:"excluded_services",label:"Excluded Services",children:e.jsx(h,{mode:"multiple",placeholder:"No exclusions",allowClear:!0,children:F.map(s=>e.jsx(l,{value:s.id,children:s.name},s.id))})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"is_active",label:"Active",valuePropName:"checked",children:e.jsx(A,{})})}),e.jsx(r,{span:8,children:e.jsx(i.Item,{name:"is_first_time_only",label:"First-time Users Only",valuePropName:"checked",children:e.jsx(A,{})})})]}),e.jsx(i.Item,{style:{marginTop:24,textAlign:"right"},children:e.jsxs(o,{children:[e.jsx(u,{onClick:w,children:"Cancel"}),e.jsxs(u,{type:"primary",htmlType:"submit",children:[c?"Update":"Create"," Coupon"]})]})})]})})]})]})}export{Qe as default};
