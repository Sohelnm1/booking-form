import{r as n,j as e,H as xe,a as J}from"./app-B0cWkBWz.js";import{d as G}from"./dayjs.min-DYLjuGX6.js";import{B as je}from"./BookingHeader-Cdwhey2Z.js";import{aa as ve,T as Ce,C as B,B as p}from"./Logo-BdBrmI7S.js";import{L as se}from"./index-DzU9cNkj.js";import{P as be}from"./progress-Dg_tEXUU.js";import{R as Se,C as Q}from"./row-CarD1OOM.js";import{R as U}from"./FileTextOutlined-CLpTPwBT.js";import{C as Z}from"./index-BuHJ7Zwf.js";import{S as ee}from"./index-Cy8ytTRt.js";import{T as N}from"./index-CKJFBpTl.js";import{R as te}from"./EyeOutlined-oy15B03z.js";import{A as S}from"./index-DaZbv8VD.js";import{D as O}from"./index-Bvkzo-Jn.js";import{R as ke}from"./ArrowLeftOutlined-Bw10PqbN.js";import{R as Re}from"./ArrowRightOutlined-Ucg3po1z.js";import{M as re}from"./index-CHmL9A8j.js";import{I as ie}from"./index-BDbgyLmG.js";import{R as oe}from"./PhoneOutlined-B9lDR37l.js";import{R as Te}from"./SendOutlined-CbtNaHyZ.js";import{R as we}from"./CheckOutlined-Czr40q_G.js";import{s as l}from"./index-DBBHLkC6.js";import{C as Pe}from"./Collapse-DFitmrD-.js";/* empty css            */import"./CustomerLoginModal-1083HXRl.js";import"./LockOutlined-BAJ-PRGV.js";import"./LogoutOutlined-D3grUEh9.js";import"./BookOutlined-Cj3M7L4e.js";import"./CalendarOutlined-DRNv4K1_.js";import"./CheckCircleFilled-Bzti_DAd.js";import"./useClosable-C3NTBGzV.js";import"./pickAttrs-BYNbLnRC.js";import"./PurePanel-P76UYIOx.js";import"./EyeOutlined-Bmd706kk.js";import"./InfoCircleFilled-BG1v0Kdu.js";import"./Input-CnuedqSf.js";import"./EyeOutlined-BEq4RqmN.js";const{Title:u,Text:i,Paragraph:Be}=Ce,{Panel:ht}=Pe,{Content:Oe}=se;function ut({service:g,selectedExtras:v,date:$,time:D,consentSettings:C,auth:y}){const[m,E]=n.useState([]),[x,ne]=n.useState(null),[le,I]=n.useState(!1),[a,k]=n.useState(""),[d,q]=n.useState(""),[A,z]=n.useState(!1),[c,R]=n.useState(!1),[T,V]=n.useState(!1),[f,w]=n.useState(!1),[ae,F]=n.useState(!1),[H,de]=n.useState("");n.useEffect(()=>{y&&y.user&&y.user.phone_number&&(R(!0),V(!0),k(y.user.phone_number)),pe()},[y]);const ce=()=>{const t=v.map(r=>r.id);J.visit(route("booking.select-datetime"),{data:{service_id:g.id,extras:t}})},fe=()=>{const t=C.filter(s=>s.is_required),r=t.every(s=>m.includes(s.id));if(console.log("handleContinue called",{allRequiredAccepted:r,otpVerified:c,verificationCompleted:T,requiredConsents:t.length,acceptedConsents:m.length}),!r){l.error("Please accept all required agreements to continue");return}if(t.length>0&&!c&&!T){console.log("Showing phone verification modal"),F(!0);return}T&&!c&&R(!0),console.log("Proceeding to confirmation page");const o=v.map(s=>s.id),P=m,j={service_id:g.id,extras:o,date:$,time:D,consents:P};(c||T)&&a&&(j.verified_phone=a),console.log("Navigating to confirm page with data:",j),J.visit(route("booking.confirm"),{data:j})},Y=t=>{ne(t),I(!0)},L=t=>{E(r=>r.includes(t)?r.filter(o=>o!==t):[...r,t])},_=()=>{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return t||(console.error("CSRF token not found in meta tag"),l.error("CSRF token not found. Please refresh the page."),null)},W=()=>{l.error("Session expired. Please refresh the page and try again.")},pe=async()=>{const t=_();if(!t)return!1;try{const r=await fetch(route("test-csrf"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"}});return r.ok?(console.log("CSRF token is valid"),!0):(console.error("CSRF token validation failed:",r.status),!1)}catch(r){return console.error("Error testing CSRF token:",r),!1}},K=async()=>{if(!a||a.length<10){l.error("Please enter a valid phone number");return}const t=_();if(t)try{w(!0);const r=await fetch(route("booking.send-otp"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"},body:JSON.stringify({phone_number:a})});if(!r.ok){if(r.status===419){W();return}const P=await r.json().catch(()=>({}));l.error(P.error||"Failed to send OTP");return}const o=await r.json();l.success("OTP sent successfully to your phone number"),z(!0),o.otp&&de(o.otp)}catch(r){console.error("Error sending OTP:",r),l.error("Failed to send OTP")}finally{w(!1)}},me=async()=>{if(!d||d.length!==6){l.error("Please enter a valid 6-digit OTP");return}const t=_();if(t)try{w(!0);const r=await fetch(route("customer.login"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"},body:JSON.stringify({phone_number:a,otp:d})});if(!r.ok){if(r.status===419){W();return}const s=await r.json().catch(()=>({}));l.error(s.error||"Invalid OTP");return}const o=await r.json();l.success("Phone number verified successfully!"),R(!0),V(!0),F(!1),o.formatted_phone&&k(o.formatted_phone),o.user;const j=C.filter(s=>s.is_required).find(s=>!m.includes(s.id));j&&E(s=>[...s,j.id])}catch(r){console.error("Error verifying OTP:",r),l.error("Failed to verify OTP")}finally{w(!1)}},he=()=>{F(!1),k(""),q(""),z(!1),R(!1),V(!1)},M=t=>`₹${parseFloat(t).toFixed(2)}`,ue=t=>{if(t<60)return`${t} min`;{const r=Math.floor(t/60),o=t%60;return o>0?`${r}h ${o}m`:`${r}h`}},ge=t=>G(t,"HH:mm").format("h:mm A"),ye=t=>G(t).format("dddd, MMMM D, YYYY"),h=C.filter(t=>t.is_required),X=C.filter(t=>!t.is_required),b=h.every(t=>m.includes(t.id));return e.jsxs(se,{style:{minHeight:"100vh"},children:[e.jsx(xe,{title:"Consent & Terms - Book Appointment"}),e.jsx(je,{auth:y}),e.jsx(Oe,{children:e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(ve,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(u,{level:2,style:{marginTop:24,marginBottom:8},children:"Consent & Terms"}),e.jsx(i,{type:"secondary",style:{fontSize:16},children:"Please review and accept our terms and conditions"})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(be,{percent:80,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(i,{type:"secondary",children:"Step 4 of 5"})})]}),e.jsxs(Se,{gutter:[32,32],children:[e.jsxs(Q,{xs:24,lg:16,children:[h.length>0&&e.jsxs(B,{style:{marginBottom:24},children:[e.jsxs(u,{level:4,style:{marginBottom:16},children:[e.jsx(U,{style:{marginRight:8,color:"#ff4d4f"}}),"Required Agreements"]}),h.map(t=>{const r=m.includes(t.id);return e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:r?"#f6ffed":"white"},children:[e.jsx(Z,{checked:r,onChange:()=>L(t.id),style:{marginRight:12,marginTop:2}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(u,{level:5,style:{margin:0},children:t.title}),e.jsxs(ee,{children:[e.jsx(N,{color:"red",children:"Required"}),e.jsx(p,{type:"text",size:"small",icon:e.jsx(te,{}),onClick:()=>Y(t),children:"View"})]})]}),t.summary&&e.jsx(i,{type:"secondary",style:{fontSize:14},children:t.summary})]})]})},t.id)})]}),X.length>0&&e.jsxs(B,{children:[e.jsxs(u,{level:4,style:{marginBottom:16},children:[e.jsx(U,{style:{marginRight:8,color:"#1890ff"}}),"Optional Agreements"]}),X.map(t=>{const r=m.includes(t.id);return e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:r?"#f6ffed":"white"},children:[e.jsx(Z,{checked:r,onChange:()=>L(t.id),style:{marginRight:12,marginTop:2}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(u,{level:5,style:{margin:0},children:t.title}),e.jsxs(ee,{children:[e.jsx(N,{color:"blue",children:"Optional"}),e.jsx(p,{type:"text",size:"small",icon:e.jsx(te,{}),onClick:()=>Y(t),children:"View"})]})]}),t.summary&&e.jsx(i,{type:"secondary",style:{fontSize:14},children:t.summary})]})]})},t.id)})]}),C.length===0&&e.jsx(B,{children:e.jsx(S,{message:"No consent documents available",description:"There are no terms and conditions to review at this time.",type:"info",showIcon:!0})})]}),e.jsx(Q,{xs:24,lg:8,children:e.jsxs(B,{style:{position:"sticky",top:24},children:[e.jsx(u,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(i,{strong:!0,children:g.name}),e.jsx(i,{children:M(g.price)})]}),e.jsx(i,{type:"secondary",style:{fontSize:12},children:ue(g.duration)})]}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{style:{margin:"12px 0"}}),v.map(t=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(i,{children:["+ ",t.name]}),e.jsx(i,{children:M(t.price)})]})},t.id))]}),e.jsx(O,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(i,{strong:!0,children:"Total Price"}),e.jsx(i,{strong:!0,style:{fontSize:16},children:M(parseFloat(g.price)+v.reduce((t,r)=>t+parseFloat(r.price),0))})]}),e.jsx(O,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(i,{type:"secondary",children:"Appointment Date"}),e.jsx("div",{children:e.jsx(i,{strong:!0,children:ye($)})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(i,{type:"secondary",children:"Appointment Time"}),e.jsx("div",{children:e.jsx(i,{strong:!0,children:ge(D)})})]}),e.jsx(O,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(i,{type:"secondary",children:"Required Agreements"}),e.jsx("div",{children:e.jsxs(i,{strong:!0,style:{color:b?"#52c41a":"#ff4d4f"},children:[m.filter(t=>h.find(r=>r.id===t)).length," ","of ",h.length," ","accepted"]})})]}),h.length>0&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(i,{type:"secondary",children:"Phone Verification"}),e.jsx("div",{children:e.jsx(i,{strong:!0,style:{color:c?"#52c41a":"#ff4d4f"},children:c?"✓ Verified":"✗ Not Verified"})})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(p,{block:!0,style:{marginBottom:12},icon:e.jsx(ke,{}),onClick:ce,children:"Back to Date & Time"}),e.jsx(p,{type:"primary",block:!0,size:"large",icon:e.jsx(Re,{}),onClick:fe,disabled:!b||f,loading:f,children:h.length>0&&!c?"Verify Phone Number":"Continue to Confirmation"})]}),!b&&e.jsx(S,{message:"Required agreements not accepted",description:"Please accept all required terms and conditions to continue.",type:"warning",showIcon:!0,style:{marginTop:16}}),b&&!c&&h.length>0&&e.jsx(S,{message:"Phone verification required",description:"Please verify your phone number to continue with the booking.",type:"warning",showIcon:!0,style:{marginTop:16}}),b&&c&&e.jsx(S,{message:"All requirements completed",description:"You can now proceed to the confirmation page.",type:"success",showIcon:!0,style:{marginTop:16}})]})})]}),e.jsx(re,{title:x?.title,open:le,onCancel:()=>I(!1),footer:[e.jsx(p,{onClick:()=>I(!1),children:"Close"},"close")],width:800,children:x&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(N,{color:x.is_required?"red":"blue",children:x.is_required?"Required":"Optional"}),e.jsxs(i,{type:"secondary",style:{marginLeft:8},children:["Version ",x.version]})]}),e.jsx("div",{style:{maxHeight:400,overflowY:"auto",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:"#fafafa"},children:e.jsx(Be,{style:{whiteSpace:"pre-line",margin:0},children:x.content})})]})}),e.jsx(re,{title:e.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[e.jsx("div",{style:{width:60,height:60,borderRadius:"50%",backgroundColor:"#f0f8ff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",border:"2px solid #e6f7ff"},children:e.jsx(oe,{style:{fontSize:28,color:"#1890ff"}})}),e.jsx(u,{level:3,style:{margin:0,color:"#262626"},children:"Phone Verification"})]}),open:ae,onCancel:he,footer:null,width:480,closable:!f,centered:!0,style:{top:20},styles:{body:{padding:"32px 24px"}},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(i,{type:"secondary",style:{fontSize:16,lineHeight:1.6,color:"#595959"},children:A?`We've sent a 6-digit code to ${a}`:"Enter your phone number to receive a verification code"}),A&&H&&e.jsx(S,{message:"Testing Mode - OTP Code",description:`Your verification code is: ${H}`,type:"info",showIcon:!0,style:{marginTop:16}})]}),A?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:32},children:[e.jsxs("div",{style:{position:"relative",display:"flex",justifyContent:"center",gap:8,marginBottom:16},children:[e.jsx(ie,{size:"large",placeholder:"Enter 6-digit code",value:d,onChange:t=>q(t.target.value),maxLength:6,style:{position:"absolute",opacity:0,zIndex:10,width:"100%",height:"100%"},autoFocus:!0}),[0,1,2,3,4,5].map(t=>e.jsx("div",{style:{width:48,height:56,border:"2px solid #d9d9d9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:600,backgroundColor:d[t]?"#f6ffed":"#fafafa",borderColor:d[t]?"#52c41a":"#d9d9d9",transition:"all 0.2s ease",cursor:"text"},children:d[t]||""},t))]}),e.jsx(i,{type:"secondary",style:{fontSize:14},children:"Enter the 6-digit verification code"})]}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[e.jsx(p,{onClick:()=>{z(!1),q("")},disabled:f,style:{height:44,borderRadius:8,border:"1px solid #d9d9d9",color:"#595959"},children:"Change Number"}),e.jsx(p,{type:"primary",icon:e.jsx(we,{}),onClick:me,loading:f,disabled:!d||d.length!==6,style:{height:44,borderRadius:8,background:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",boxShadow:"0 4px 12px rgba(82, 196, 26, 0.3)"},children:f?"Verifying...":"Verify Code"})]}),e.jsx("div",{style:{marginTop:24},children:e.jsxs(i,{type:"secondary",style:{fontSize:12},children:["Didn't receive the code?"," ",e.jsx(p,{type:"link",size:"small",style:{padding:0,height:"auto"},onClick:K,disabled:f,children:"Resend"})]})})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{position:"relative",marginBottom:8},children:e.jsx(ie,{size:"large",placeholder:"+91 98765 43210",prefix:e.jsx(oe,{style:{color:"#bfbfbf"}}),value:a,onChange:t=>k(t.target.value),style:{height:48,fontSize:16,borderRadius:8,border:"1px solid #d9d9d9"}})}),e.jsx(i,{type:"secondary",style:{fontSize:12},children:"We'll send you a verification code via SMS"})]}),e.jsx(p,{type:"primary",size:"large",icon:e.jsx(Te,{}),onClick:K,loading:f,disabled:!a||a.length<10,style:{height:48,fontSize:16,fontWeight:500,borderRadius:8,width:"100%",background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",border:"none",boxShadow:"0 4px 12px rgba(24, 144, 255, 0.3)"},children:f?"Sending...":"Send Verification Code"})]})]})})]})})]})}export{ut as default};
