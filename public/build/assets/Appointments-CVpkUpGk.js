import{r as o,j as e,H as oe}from"./app-GHJ6SJ9p.js";import{A as ce}from"./AdminLayout-BAgcmyjt.js";import{C as de}from"./CancelModal-V8HPvk4t.js";import{R as me,u as ue,t as pe}from"./timezone-CTZRx_pf.js";import{d as _}from"./dayjs.min-B4YUl899.js";import{I as he,C as g,T as xe,B as u}from"./Logo-CgCrcYaU.js";import{S as r}from"./index-C4h3PxPQ.js";import{R as fe,C as k}from"./row-CgwhhCUf.js";import{I as je}from"./index-BKi5BDEi.js";import{R as _e}from"./SearchOutlined-CX9C8anT.js";import{S as V}from"./index-CnMyniK2.js";import{D as ye}from"./index-CS0MLHUR.js";import{F as ge}from"./Table-D-mWpawj.js";import{M as ve}from"./index-BI7GSswp.js";import{D as l}from"./index-CBzPM23J.js";import{D as f}from"./index-DshskHDl.js";import{T as D}from"./index-Di36YMr6.js";import{B as c}from"./index-DlwDRAxA.js";import{R as be}from"./CheckCircleOutlined-BjpEP8Ct.js";import{R as Ce,a as Se}from"./PrinterOutlined-CkPo5NPz.js";import{s as E}from"./index-BceBb3gr.js";import{R as Re}from"./UserOutlined-CB-PlqxZ.js";import{R as Ie}from"./MailOutlined-BkPy6jAc.js";import{R as we}from"./PhoneOutlined-X5LTcP1J.js";import{R as ze}from"./CalendarOutlined-DRjFhB-3.js";import{R as ke}from"./ClockCircleOutlined-DL0l6okk.js";import{R as De}from"./EyeOutlined-Dm-7CYKk.js";import{R as Fe}from"./CloseCircleOutlined-qGQraqlM.js";/* empty css            */import"./index-C_hlbVzA.js";import"./index-CFCYulKb.js";import"./PurePanel-oknD4ArD.js";import"./move-BQEn0wCQ.js";import"./LogoutOutlined-Bdb2DG7j.js";import"./DollarOutlined-DkHeabU4.js";import"./PlusOutlined-CtpEdgYh.js";import"./SettingOutlined-B_syKyCn.js";import"./FileTextOutlined-DYWq0JzC.js";import"./GiftOutlined-C9tE1WQH.js";import"./index-DQaT6v9B.js";import"./useForm-c8FVYlit.js";import"./CheckCircleFilled-C6274V1h.js";import"./InfoCircleFilled-BgQ81YM8.js";import"./index-C9xZ2qKj.js";import"./pickAttrs-BVXv29NF.js";import"./ExclamationCircleOutlined-D4DdctsG.js";import"./index-DIcGKw6c.js";import"./Input-Ba6sZIOH.js";import"./EyeOutlined-BUY3z7ff.js";import"./EyeOutlined-Bmd706kk.js";import"./index-BHN9A3hJ.js";import"./DownOutlined-CnWx9RdQ.js";import"./addEventListener-DIGLTZCa.js";import"./index-Ckzs-oZH.js";import"./index-DSrkMEKC.js";import"./extendsObject-78o_rR5W.js";import"./useClosable-C7FjKwvd.js";import"./DownloadOutlined-DTidZHln.js";var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"};function F(){return F=Object.assign?Object.assign.bind():function(p){for(var d=1;d<arguments.length;d++){var t=arguments[d];for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(p[h]=t[h])}return p},F.apply(this,arguments)}const Ae=(p,d)=>o.createElement(he,F({},p,{ref:d,icon:Te})),Me=o.forwardRef(Ae);_.extend(ue);_.extend(pe);const{Title:v,Text:a}=xe,{Option:j}=V,{Search:$e}=je;function Vt({auth:p,bookings:d}){const[t,h]=o.useState(null),[N,T]=o.useState(!1),[Y,b]=o.useState(!1),[O,C]=o.useState(null),[H,S]=o.useState(!1),[K,R]=o.useState(null),[x,q]=o.useState(""),[I,U]=o.useState("all"),[w,G]=o.useState(null),J=n=>{h(n),T(!0)},A=()=>{T(!1),h(null)},M=n=>{window.open(`/admin/appointments/${n}/pdf`,"_blank")},Q=()=>{window.open("/admin/appointments/export-excel","_blank")},W=n=>{C(n),b(!0)},X=n=>{b(!1),C(null),E.success("Booking cancelled successfully"),window.location.reload()},Z=()=>{b(!1),C(null)},ee=n=>{R(n),S(!0)},te=n=>{S(!1),R(null),E.success("Refund processed successfully"),window.location.reload()},se=()=>{S(!1),R(null)},$=n=>{switch(n){case"confirmed":return"success";case"pending":return"warning";case"completed":return"processing";case"cancelled":return"error";case"no_show":return"default";default:return"default"}},B=n=>{switch(n){case"paid":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"default";default:return"default"}},L=n=>{switch(n){case"pending":return"warning";case"processed":return"success";case"failed":return"error";case"not_applicable":return"default";default:return"default"}},ne=n=>_(n).tz("Asia/Kolkata").format("h:mm A"),le=n=>_(n).tz("Asia/Kolkata").format("MMM DD, YYYY"),m=n=>_(n).tz("Asia/Kolkata").format("MMM DD, YYYY h:mm A"),z=n=>{if(n<60)return`${n} min`;{const s=Math.floor(n/60),i=n%60;return i>0?`${s}h ${i}m`:`${s}h`}},ae=n=>{const s=n.form_field;if(!s)return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(a,{strong:!0,style:{fontSize:"12px",color:"#666"},children:["Unknown Field (ID: ",n.form_field_id,"):"]}),e.jsx("br",{}),e.jsx(a,{children:n.response_value||"Not provided"})]},n.id);const i=n.formatted_value||n.response_value;return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(a,{strong:!0,style:{fontSize:"12px",color:"#666"},children:[s.label,":"]}),e.jsx("br",{}),e.jsx(a,{children:i||"Not provided"})]},n.id)},P=d.filter(n=>{const s=x===""||n.customer.name.toLowerCase().includes(x.toLowerCase())||n.customer.email.toLowerCase().includes(x.toLowerCase())||n.service.name.toLowerCase().includes(x.toLowerCase())||n.employee.name.toLowerCase().includes(x.toLowerCase()),i=I==="all"||n.status===I,y=!w||_(n.appointment_time).tz("Asia/Kolkata").isSame(w,"day");return s&&i&&y}),ie=[{title:"Customer",key:"customer",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs(r,{children:[e.jsx(Re,{}),e.jsx(a,{strong:!0,children:s.customer.name})]}),e.jsxs(r,{children:[e.jsx(Ie,{}),e.jsx(a,{copyable:!0,style:{fontSize:"12px"},children:s.customer.email})]}),e.jsxs(r,{children:[e.jsx(we,{}),e.jsx(a,{copyable:!0,style:{fontSize:"12px"},children:s.customer.phone_number})]})]})},{title:"Service & Employee",key:"service",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs("div",{children:[e.jsx(a,{strong:!0,children:s.service.name}),s.pricingTier&&e.jsx(D,{color:"blue",style:{marginLeft:8,fontSize:10},children:s.pricingTier.name}),e.jsx("br",{}),e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:[z(s.pricingTier?.duration_minutes||s.service.duration)," ","• ₹",s.pricingTier?.price||s.service.price]})]}),e.jsx("div",{children:e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Assigned to: ",s.employee.name,e.jsx(c,{status:s.employee.is_active?"success":"error",text:s.employee.is_active?"Active":"Inactive",style:{marginLeft:4,fontSize:"10px"}})]})})]})},{title:"Appointment",key:"appointment",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs(r,{children:[e.jsx(ze,{}),e.jsx(a,{children:le(s.appointment_time)})]}),e.jsxs(r,{children:[e.jsx(ke,{}),e.jsx(a,{children:ne(s.appointment_time)})]}),e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Duration: ",z(s.duration)]})]})},{title:"Extras",key:"extras",render:(n,s)=>e.jsx("div",{children:s.extras&&s.extras.length>0?s.extras.map(i=>{const y=i.pivot?.quantity||1,re=parseFloat(i.pivot?.price||i.price)*y;return e.jsxs(D,{color:"blue",style:{marginBottom:4},children:[i.name,y>1&&` × ${y}`,` (₹${re.toFixed(2)})`]},i.id)}):e.jsx(a,{type:"secondary",style:{fontSize:"12px"},children:"No extras"})})},{title:"Total & Status",key:"total",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs(r,{children:[e.jsx(a,{strong:!0,style:{color:"#1890ff"},children:"₹"}),e.jsxs(a,{strong:!0,children:["₹",s.total_amount]})]}),e.jsx(r,{children:e.jsx(c,{status:$(s.status),text:s.status_text||s.status})}),e.jsx(r,{children:e.jsx(c,{status:B(s.payment_status),text:s.payment_status_text||s.payment_status})}),s.status==="cancelled"&&s.refund_amount>0&&e.jsx(r,{children:e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Refund: ₹",s.refund_amount]})}),s.status==="cancelled"&&s.refund_status&&e.jsx(r,{children:e.jsx(c,{status:L(s.refund_status),text:s.refund_status_text||s.refund_status})}),s.reschedule_attempts>0&&e.jsx(r,{children:e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Rescheduled: ",s.reschedule_attempts," ","time(s)"]})})]})},{title:"Actions",key:"actions",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsx(u,{type:"primary",icon:e.jsx(De,{}),size:"small",onClick:()=>J(s),style:{width:"100%"},children:"View Details"}),e.jsx(u,{type:"default",icon:e.jsx(Se,{}),size:"small",onClick:()=>M(s.id),style:{width:"100%"},children:"Download PDF"}),(s.status==="pending"||s.status==="confirmed")&&e.jsx(u,{type:"default",danger:!0,icon:e.jsx(Fe,{}),size:"small",onClick:()=>W(s),style:{width:"100%"},children:"Cancel"}),s.status==="cancelled"&&s.refund_status==="pending"&&s.payment_status==="paid"&&e.jsx(u,{type:"default",style:{width:"100%",backgroundColor:"#52c41a",color:"white",borderColor:"#52c41a"},size:"small",onClick:()=>ee(s),children:"Process Refund"})]})}];return e.jsxs(ce,{auth:p,children:[e.jsx(oe,{title:"Appointments"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(g,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[e.jsx(v,{level:2,style:{margin:0},children:"Appointments"}),e.jsxs(r,{children:[e.jsx(u,{type:"primary",icon:e.jsx(Me,{}),onClick:Q,style:{marginRight:8},children:"Export to Excel"}),e.jsxs(a,{type:"secondary",children:["Total: ",P.length," bookings"]})]})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(fe,{gutter:16,children:[e.jsx(k,{span:8,children:e.jsx($e,{placeholder:"Search by customer, service, or employee",allowClear:!0,value:x,onChange:n=>q(n.target.value),prefix:e.jsx(_e,{})})}),e.jsx(k,{span:4,children:e.jsxs(V,{placeholder:"Status",value:I,onChange:U,style:{width:"100%"},children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"confirmed",children:"Confirmed"}),e.jsx(j,{value:"completed",children:"Completed"}),e.jsx(j,{value:"cancelled",children:"Cancelled"}),e.jsx(j,{value:"no_show",children:"No Show"})]})}),e.jsx(k,{span:4,children:e.jsx(ye,{placeholder:"Filter by date",value:w,onChange:G,style:{width:"100%"},allowClear:!0})})]})}),e.jsx(ge,{columns:ie,dataSource:P,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(n,s)=>`${s[0]}-${s[1]} of ${n} appointments`}})]}),e.jsx(ve,{title:"Booking Details",open:N,onCancel:A,footer:[e.jsx(u,{icon:e.jsx(Ce,{}),onClick:()=>M(t.id),children:"Print PDF"},"print"),e.jsx(u,{onClick:A,children:"Close"},"close")],width:800,children:t&&e.jsxs("div",{children:[e.jsxs(l,{title:"Customer Information",bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Name",span:2,children:t.customer.name}),e.jsx(l.Item,{label:"Email",span:2,children:t.customer.email}),e.jsx(l.Item,{label:"Phone",span:2,children:t.customer.phone_number})]}),e.jsx(f,{}),e.jsxs(l,{title:"Booking Information",bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Service",children:e.jsxs("div",{children:[e.jsx(a,{children:t.service.name}),t.pricingTier&&e.jsx(D,{color:"blue",style:{marginLeft:8,fontSize:10},children:t.pricingTier.name})]})}),e.jsxs(l.Item,{label:"Employee",children:[t.employee.name,e.jsx(c,{status:t.employee.is_active?"success":"error",text:t.employee.is_active?"Active":"Inactive",style:{marginLeft:8}})]}),e.jsx(l.Item,{label:"Date & Time",children:m(t.appointment_time)}),e.jsx(l.Item,{label:"Duration",children:z(t.duration)}),e.jsx(l.Item,{label:"Status",children:e.jsx(c,{status:$(t.status),text:t.status_text||t.status})}),e.jsx(l.Item,{label:"Payment Status",children:e.jsx(c,{status:B(t.payment_status),text:t.payment_status_text||t.payment_status})}),e.jsx(l.Item,{label:"Total Amount",span:2,children:e.jsxs(a,{strong:!0,style:{fontSize:"16px"},children:["₹",t.total_amount]})}),t.reschedule_attempts>0&&e.jsxs(l.Item,{label:"Reschedule Attempts",children:[t.reschedule_attempts," ","time(s)"]}),t.rescheduled_at&&e.jsx(l.Item,{label:"Last Rescheduled",children:m(t.rescheduled_at)})]}),e.jsx(f,{}),t.extras&&t.extras.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{title:"Selected Extras",bordered:!0,size:"small",children:t.extras.map(n=>{const s=n.pivot?.quantity||1,i=parseFloat(n.pivot?.price||n.price)*s;return n.duration_relation?(n.duration_relation.hours*60+n.duration_relation.minutes)*s:(n.total_duration||0)*s,e.jsx(l.Item,{label:e.jsxs("div",{children:[n.name,s>1&&e.jsxs(a,{type:"secondary",style:{fontSize:12,marginLeft:8},children:["×"," ",s]})]}),children:e.jsxs("div",{children:[e.jsxs("div",{children:["₹",i.toFixed(2)]}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:[n.duration_relation?n.duration_relation.label:"No additional time",s>1&&e.jsxs(a,{type:"secondary",style:{fontSize:12},children:[" ","×"," ",s]})]})]})},n.id)})}),e.jsx(f,{})]}),t.status==="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs(l,{title:"Refund Information",bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Refund Status",children:e.jsx(c,{status:L(t.refund_status),text:t.refund_status_text||t.refund_status})}),t.refund_amount>0&&e.jsx(l.Item,{label:"Refund Amount",children:e.jsxs(a,{strong:!0,style:{color:"#52c41a",fontSize:"16px"},children:["₹",t.refund_amount]})}),t.cancellation_fee_charged>0&&e.jsx(l.Item,{label:"Cancellation Fee",children:e.jsxs(a,{strong:!0,style:{color:"#ff4d4f",fontSize:"16px"},children:["₹",t.cancellation_fee_charged]})}),t.refund_transaction_id&&e.jsx(l.Item,{label:"Refund Transaction ID",children:e.jsx(a,{copyable:!0,children:t.refund_transaction_id})}),t.refund_processed_at&&e.jsx(l.Item,{label:"Refund Processed At",children:m(t.refund_processed_at)}),t.refund_method&&e.jsx(l.Item,{label:"Refund Method",children:t.refund_method}),t.refund_notes&&e.jsx(l.Item,{label:"Refund Notes",span:2,children:e.jsx(a,{children:t.refund_notes})}),t.cancellation_reason&&e.jsx(l.Item,{label:"Cancellation Reason",span:2,children:e.jsx(a,{children:t.cancellation_reason})}),t.cancelled_at&&e.jsx(l.Item,{label:"Cancelled At",children:m(t.cancelled_at)})]})]}),(()=>{const n=t.form_responses;if(n&&n.length>0){const s=n.filter(i=>i.form_field&&!i.form_field.is_primary);return s.length>0?e.jsxs("div",{children:[e.jsx(v,{level:4,children:"Custom Field Responses"}),e.jsx(g,{size:"small",children:s.map(ae)})]}):e.jsxs("div",{children:[e.jsx(v,{level:4,children:"Custom Field Responses"}),e.jsx(g,{size:"small",children:e.jsx(a,{type:"secondary",children:"No custom field responses found."})})]})}else return e.jsxs("div",{children:[e.jsx(v,{level:4,children:"Custom Field Responses"}),e.jsx(g,{size:"small",children:e.jsx(a,{type:"secondary",children:"No form responses found."})})]})})(),t.consent_given&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs(l,{title:"Consent Information",bordered:!0,size:"small",children:[e.jsxs(l.Item,{label:"Consent Given",children:[e.jsx(be,{style:{color:"green"}})," ","Yes"]}),e.jsx(l.Item,{label:"Consent Date",children:t.consent_given_at?m(t.consent_given_at):"Not recorded"})]})]}),(t.reschedule_attempts>0||t.reschedule_payment_amount>0)&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs(l,{title:"Reschedule Information",bordered:!0,size:"small",children:[t.reschedule_attempts>0&&e.jsxs(l.Item,{label:"Reschedule Attempts",children:[t.reschedule_attempts," ","time(s)"]}),t.rescheduled_at&&e.jsx(l.Item,{label:"Last Rescheduled",children:m(t.rescheduled_at)}),t.reschedule_payment_amount>0&&e.jsx(l.Item,{label:"Reschedule Fee Paid",children:e.jsxs(a,{strong:!0,style:{color:"#52c41a"},children:["₹",t.reschedule_payment_amount]})}),t.reschedule_payment_id&&e.jsx(l.Item,{label:"Payment ID",children:e.jsx(a,{code:!0,children:t.reschedule_payment_id})}),t.reschedule_payment_date&&e.jsx(l.Item,{label:"Payment Date",children:m(t.reschedule_payment_date)}),t.reschedule_payment_status&&e.jsx(l.Item,{label:"Payment Status",children:e.jsx(c,{status:t.reschedule_payment_status==="paid"?"success":t.reschedule_payment_status==="pending"?"warning":t.reschedule_payment_status==="failed"?"error":"default",text:t.reschedule_payment_status.charAt(0).toUpperCase()+t.reschedule_payment_status.slice(1).replace("_"," ")})})]})]})]})}),e.jsx(de,{visible:Y,onCancel:Z,onSuccess:X,booking:O,isAdmin:!0}),e.jsx(me,{visible:H,onCancel:se,onSuccess:te,booking:K})]})]})}export{Vt as default};
