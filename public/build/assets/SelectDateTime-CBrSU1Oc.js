import{r as k,j as e,H as ee,a as H}from"./app-9CPhuQ4N.js";import{d as v}from"./dayjs.min-DkyW2i6o.js";import{B as te}from"./BookingHeader-CYZEQGIX.js";import{ad as oe,T as se,C,B as D}from"./Logo-DkqekcuB.js";import{P as ne}from"./progress-DHIiz3aS.js";import{R as N,C as I}from"./row-DZntwU3-.js";import{R as re}from"./CalendarOutlined-BwNhaYMx.js";import{R as ie}from"./ClockCircleOutlined-Bc85Mo5w.js";import{S as ae}from"./index-DtvXIuUr.js";import{E as P}from"./index-CFK0u_yQ.js";import{R as le}from"./CheckOutlined-wbVTjke9.js";import{D as B}from"./index-CaaxMa_b.js";import{R as de}from"./ArrowLeftOutlined-CrWWH_jD.js";import{R as ce}from"./ArrowRightOutlined-DEuONyD4.js";/* empty css            */import"./LogoutOutlined-zRISOHo0.js";import"./index-9Xzw0frF.js";import"./CheckCircleFilled-BMzJfPTH.js";import"./InfoCircleFilled-DTUShVZ5.js";import"./pickAttrs-BDzNXXMc.js";import"./BookOutlined-D8Ddjkqr.js";const{Title:T,Text:l}=se;function Ae({service:c,selectedExtras:p,scheduleSettings:y,auth:F}){const[f,E]=k.useState(null),[x,Y]=k.useState(null),[R,M]=k.useState([]),[L,_]=k.useState(!1),[b,A]=k.useState(v()),$=c.duration+p.reduce((t,o)=>t+(o.duration||0),0),O=()=>{const t=p.map(o=>o.id);H.visit(route("booking.select-extras"),{data:{service_id:c.id,extras:t}})},G=()=>{if(f&&x){const t=p.map(o=>o.id);H.visit(route("booking.consent"),{data:{service_id:c.id,extras:t,date:f.format("YYYY-MM-DD"),time:x.format("HH:mm")}})}},U=async t=>{_(!0);try{console.log("Fetching slots for date:",t.format("YYYY-MM-DD")),console.log("Service ID:",c.id),console.log("Service duration:",c.duration),console.log("Selected extras:",p),console.log("Total duration:",$);const o=new URLSearchParams({date:t.format("YYYY-MM-DD"),service_id:c.id});p.length>0&&p.forEach(r=>{o.append("extras[]",r.id)});const s=await(await fetch(`${route("booking.available-slots")}?${o.toString()}`)).json();console.log("Available slots response:",s),s.slots&&s.slots.length>0?M(s.slots):(console.log("No slots returned from backend"),M([]))}catch(o){console.error("Error fetching slots:",o),M([])}finally{_(!1)}},V=t=>{E(t),Y(null),U(t)},q=t=>{Y(t)},w=t=>`â‚¹${parseFloat(t).toFixed(2)}`,W=t=>{if(t<60)return`${t} min`;{const o=Math.floor(t/60),n=t%60;return n>0?`${o}h ${n}m`:`${o}h`}},z=t=>{try{if(!t)return console.error("Time is null or undefined"),"Invalid Time";let o=t;if(t&&typeof t=="object"&&t.format?o=t.format("HH:mm"):typeof t=="object"&&t.start&&(o=t.start),!o||typeof o!="string")return console.error("Invalid time format:",t),"Invalid Time";const n=o.match(/^(\d{1,2}):(\d{2})$/);if(!n)return console.error("Invalid time string format:",o),"Invalid Time";const s=parseInt(n[1],10),r=parseInt(n[2],10);if(s<0||s>23||r<0||r>59)return console.error("Invalid time values:",s,r),"Invalid Time";const d=s>=12?"PM":"AM",m=s===0?12:s>12?s-12:s,i=r.toString().padStart(2,"0");return`${m}:${i} ${d}`}catch(o){return console.error("Error formatting time:",o,t),"Invalid Time"}},J=t=>{const o=t.year(),n=t.month(),s=v(new Date(o,n,1)),r=v(new Date(o,n+1,0)),d=s.startOf("week"),m=r.endOf("week"),i=[];let a=d;for(;a.isBefore(m)||a.isSame(m,"day");)i.push(a),a=a.add(1,"day");return i},K=()=>{A(b.subtract(1,"month"))},Q=()=>{A(b.add(1,"month"))},X=t=>{const o=v(),n=y?.[0];if(!n)return t.isAfter(o.subtract(1,"day"))&&t.isBefore(o.add(31,"day"));const s=n.min_advance_hours||2,r=n.max_advance_days||30,d=n.working_days||[1,2,3,4,5],m=o.add(s,"hour"),i=o.add(r,"day"),a=t.isSame(o,"day"),j=a||t.isAfter(m)&&t.isBefore(i),h=t.day(),S=h===0?7:h,u=d.includes(S),g=j&&u;return t.isSame(o,"day")&&console.log("Today date check:",{date:t.format("YYYY-MM-DD"),isToday:a,isWithinRange:j,isWorkingDay:u,isSelectable:g,minAdvanceHours:s,workingDays:d}),g};return e.jsxs("div",{children:[e.jsx(ee,{title:"Select Date & Time - Book Appointment"}),e.jsx(te,{auth:F}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(oe,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(T,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),e.jsx(l,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),y&&y.length>0&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(l,{type:"secondary",style:{fontSize:"12px"},children:["ðŸ“… Booking window:"," ",y[0].booking_window_days," days ahead â€¢ â° Min advance:"," ",y[0].min_advance_hours," hours â€¢ ðŸ• Working hours:"," ",y[0].start_time," -"," ",y[0].end_time," â€¢ ðŸ“† Working days: ",y[0].working_days_text]})})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(ne,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(l,{type:"secondary",children:"Step 3 of 5"})})]}),e.jsxs(N,{gutter:[32,32],children:[e.jsxs(I,{xs:24,lg:16,children:[e.jsxs(C,{style:{marginBottom:24},children:[e.jsxs(T,{level:4,style:{marginBottom:16},children:[e.jsx(re,{style:{marginRight:8}}),"Select Date"]}),e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{size:"small",onClick:K,style:{border:"none",boxShadow:"none"},children:"â€¹"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:b.format("MMMM YYYY")}),e.jsx(D,{size:"small",onClick:Q,style:{border:"none",boxShadow:"none"},children:"â€º"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(t=>e.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:t},t))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:J(b).map((t,o)=>{const n=v(),s=t.isBefore(n,"day"),r=t.isSame(n,"day"),d=f&&f.isSame(t,"day"),m=t.month()===b.month(),i=X(t),a={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:i&&!s?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:m?1:.3};let j="transparent",h="#333",S="1px solid transparent";s?h="#999":d?(j="#e6f7ff",h="#1890ff",S="2px solid #1890ff"):r&&!f?(j="#1890ff",h="white",S="none"):i?h="#333":h="#999";let u="";if(s)u="Past date - cannot be selected";else if(i)u=`Available for booking on ${t.format("dddd, MMMM D")}`;else{const g=t.day(),Z=g===0?7:g;(y?.[0]?.working_days||[1,2,3,4,5]).includes(Z)?u="Date not available for booking":u=`${t.format("dddd")} - Not a working day`}return e.jsxs("div",{style:{...a,backgroundColor:j,color:h,border:S},title:u,onMouseEnter:g=>{i&&!s&&!d&&(g.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:g=>{i&&!s&&!d&&(g.currentTarget.style.backgroundColor="transparent")},onClick:()=>{i&&!s&&V(t)},children:[t.date(),r&&e.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},o)})})]})]})]}),f&&e.jsxs(C,{children:[e.jsxs(T,{level:4,style:{marginBottom:16},children:[e.jsx(ie,{style:{marginRight:8}}),"Available Time Slots"]}),L?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(ae,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(l,{type:"secondary",children:"Loading available slots..."})})]}):R.length===0?e.jsx(P,{description:"No available slots for this date",image:P.PRESENTED_IMAGE_SIMPLE}):e.jsx(N,{gutter:[12,12],children:R.map((t,o)=>{const n=typeof t=="object"?t.start:t;if(!n||typeof n!="string")return console.error("Invalid slot start time:",n,"for slot:",t),null;const s=n.split(":");if(s.length!==2)return console.error("Invalid time format:",n),null;const r=parseInt(s[0],10),d=parseInt(s[1],10);if(isNaN(r)||isNaN(d)||r<0||r>23||d<0||d>59)return console.error("Invalid time values:",r,d,"for slot:",n),null;const m=v().hour(r).minute(d).second(0).millisecond(0),i=x&&x.format("HH:mm")===n,a=typeof t=="object"?t.available!==!1:!0;return e.jsx(I,{xs:12,sm:8,md:6,children:e.jsx(D,{size:"large",disabled:!a,style:{width:"100%",height:48,border:i?"2px solid #1890ff":a?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:i?"#e6f7ff":a?"white":"#fff2f0",opacity:a?1:.6},onClick:()=>a&&q(m),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[i&&e.jsx(le,{style:{marginRight:8,color:"#1890ff"}}),z(n)]}),!a&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},o)}).filter(Boolean)})]})]}),e.jsx(I,{xs:24,lg:8,children:e.jsxs(C,{style:{position:"sticky",top:24},children:[e.jsx(T,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(l,{strong:!0,children:c.name}),e.jsx(l,{children:w(c.price)})]}),e.jsx(l,{type:"secondary",style:{fontSize:12},children:W(c.duration)})]}),p.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{margin:"12px 0"}}),p.map(t=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(l,{children:["+ ",t.name]}),e.jsx(l,{children:w(t.price)})]})},t.id))]}),e.jsx(B,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(l,{strong:!0,children:"Total Price"}),e.jsx(l,{strong:!0,style:{fontSize:16},children:w(parseFloat(c.price)+p.reduce((t,o)=>t+parseFloat(o.price),0))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{type:"secondary",children:"Total Duration"}),e.jsx(l,{type:"secondary",children:W($)})]}),(f||x)&&e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(l,{type:"secondary",children:"Selected Date"}),e.jsx("div",{children:e.jsx(l,{strong:!0,children:f?f.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),e.jsxs("div",{children:[e.jsx(l,{type:"secondary",children:"Selected Time"}),e.jsx("div",{children:e.jsx(l,{strong:!0,children:x&&x.isValid()?z(x):"Not selected"})})]})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(D,{block:!0,style:{marginBottom:12},icon:e.jsx(de,{}),onClick:O,children:"Back to Extras"}),e.jsx(D,{type:"primary",block:!0,size:"large",icon:e.jsx(ce,{}),onClick:G,disabled:!f||!x,children:"Continue to Consent"})]})]})})]})]})]})}export{Ae as default};
