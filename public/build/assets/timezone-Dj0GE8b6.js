import{r as I,b as Y,j as t,g as B}from"./app-CA7f6DU0.js";import{F as z}from"./index-CRTO14NW.js";import{M as Z}from"./index-Cz5OlNXb.js";import{A as E}from"./index-zzVee3yh.js";import{D as q}from"./index-2F6H9U2M.js";import{I as L}from"./index-DcCG8vEq.js";import{S as U,B as H,T as k}from"./Logo-MHWbOqmI.js";import{R as N}from"./DollarOutlined-BsKy45ix.js";import{S as K}from"./index-DUSDSuH6.js";import{D as y}from"./index-B80iarPt.js";import{R as V}from"./UserOutlined-1UXzhebA.js";const{Text:m,Title:he}=k,{TextArea:W}=L,me=({visible:D,onCancel:F,onSuccess:v,booking:f})=>{const[R]=z.useForm(),[O,l]=I.useState(!1),[p,i]=I.useState(null),[$,d]=I.useState(null);I.useEffect(()=>{D&&f&&S()},[D,f]);const S=async()=>{if(f){l(!0),d(null);try{const e=await Y.get(`/admin/appointments/${f.id}/refund-details`);e.data.success?i(e.data.data):d("Failed to load refund details")}catch(e){console.error("Error fetching refund details:",e),d("Failed to load refund details")}finally{l(!1)}}},o=async e=>{l(!0),d(null);try{console.log("Processing refund for booking:",f.id),console.log("Refund values:",e);const r=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");console.log("CSRF Token:",r);const s=await Y.post(`/admin/appointments/${f.id}/refund`,{refund_method:e.refund_method||"original_payment_method",refund_notes:e.refund_notes||null},{headers:{"X-CSRF-TOKEN":r,"Content-Type":"application/json"}});console.log("Refund response:",s.data),s.data.success?v(s.data):d(s.data.message||"Failed to process refund")}catch(r){console.error("Error processing refund:",r),console.error("Error response:",r.response?.data);const s=r.response?.data?.message||"Failed to process refund";d(s)}finally{l(!1)}},c=()=>{R.resetFields(),d(null),F()},n=()=>{if(O)return t.jsx(K,{size:"large"});if(!p)return t.jsx(m,{type:"secondary",children:"No refund details available"});const{booking:e,customer:r,service:s,policy:u,cancelled_by:a}=p;return t.jsx("div",{children:t.jsxs(y,{title:"Refund Information",bordered:!0,size:"small",column:1,children:[t.jsxs(y.Item,{label:"Customer",children:[t.jsxs(U,{children:[t.jsx(V,{}),t.jsx(m,{children:r.name})]}),t.jsx("br",{}),t.jsx(m,{type:"secondary",children:r.email}),t.jsx("br",{}),t.jsx(m,{type:"secondary",children:r.phone})]}),t.jsxs(y.Item,{label:"Service",children:[t.jsx(m,{strong:!0,children:s.name}),t.jsx("br",{}),t.jsxs(m,{type:"secondary",children:["₹",s.price]})]}),t.jsx(y.Item,{label:"Original Amount",children:t.jsxs(m,{strong:!0,style:{color:"#1890ff"},children:["₹",e.total_amount]})}),t.jsx(y.Item,{label:"Refund Amount",children:t.jsxs(m,{strong:!0,style:{color:"#52c41a"},children:["₹",e.refund_amount]})}),e.cancellation_fee_charged>0&&t.jsx(y.Item,{label:"Cancellation Fee",children:t.jsxs(m,{strong:!0,style:{color:"#ff4d4f"},children:["₹",e.cancellation_fee_charged]})}),t.jsxs(y.Item,{label:"Cancellation Policy",children:[t.jsx(m,{children:u?.name||"Default Policy"}),t.jsx("br",{}),t.jsx(m,{type:"secondary",children:u?.cancellation_policy||"Full Refund"})]}),t.jsxs(y.Item,{label:"Cancelled By",children:[t.jsx(m,{children:a?.name||"Customer"}),t.jsx("br",{}),t.jsx(m,{type:"secondary",children:e.cancelled_at})]}),e.cancellation_reason&&t.jsx(y.Item,{label:"Cancellation Reason",children:t.jsx(m,{children:e.cancellation_reason})})]})})};return t.jsxs(Z,{title:t.jsxs(U,{children:[t.jsx(N,{style:{color:"#52c41a"}}),t.jsx("span",{children:"Process Refund"})]}),open:D,onCancel:c,footer:null,width:700,destroyOnClose:!0,children:[t.jsx("div",{style:{marginBottom:16},children:t.jsx(E,{message:"Refund Processing",description:"This will process the refund for the cancelled booking. The refund will be processed according to the original payment method.",type:"info",showIcon:!0,style:{marginBottom:16}})}),$&&t.jsx(E,{message:"Error",description:$,type:"error",showIcon:!0,style:{marginBottom:16}}),n(),t.jsx(q,{}),t.jsxs(z,{form:R,layout:"vertical",onFinish:o,children:[t.jsx(z.Item,{label:"Refund Method",name:"refund_method",initialValue:"original_payment_method",children:t.jsx(L,{placeholder:"Refund method",disabled:!0,value:"Original Payment Method"})}),t.jsx(z.Item,{label:"Refund Notes",name:"refund_notes",children:t.jsx(W,{rows:3,placeholder:"Add any notes about this refund..."})}),t.jsx(z.Item,{style:{marginBottom:0},children:t.jsxs(U,{style:{width:"100%",justifyContent:"flex-end"},children:[t.jsx(H,{onClick:c,disabled:O,children:"Cancel"}),t.jsx(H,{type:"primary",htmlType:"submit",loading:O,icon:t.jsx(N,{}),style:{backgroundColor:"#52c41a",borderColor:"#52c41a"},children:"Process Refund"})]})})]})]})};var M={exports:{}},X=M.exports,P;function G(){return P||(P=1,function(D,F){(function(v,f){D.exports=f()})(X,function(){var v="minute",f=/[+-]\d\d(?::?\d\d)?/g,R=/([+-]|\d\d)/g;return function(O,l,p){var i=l.prototype;p.utc=function(e){var r={date:e,utc:!0,args:arguments};return new l(r)},i.utc=function(e){var r=p(this.toDate(),{locale:this.$L,utc:!0});return e?r.add(this.utcOffset(),v):r},i.local=function(){return p(this.toDate(),{locale:this.$L,utc:!1})};var $=i.parse;i.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),$.call(this,e)};var d=i.init;i.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else d.call(this)};var S=i.utcOffset;i.utcOffset=function(e,r){var s=this.$utils().u;if(s(e))return this.$u?0:s(this.$offset)?S.call(this):this.$offset;if(typeof e=="string"&&(e=function(h){h===void 0&&(h="");var T=h.match(f);if(!T)return null;var g=(""+T[0]).match(R)||["-",0,0],C=g[0],j=60*+g[1]+ +g[2];return j===0?0:C==="+"?j:-j}(e),e===null))return this;var u=Math.abs(e)<=16?60*e:e,a=this;if(r)return a.$offset=u,a.$u=e===0,a;if(e!==0){var x=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(a=this.local().add(u+x,v)).$offset=u,a.$x.$localOffset=x}else a=this.utc();return a};var o=i.format;i.format=function(e){var r=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return o.call(this,r)},i.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},i.isUTC=function(){return!!this.$u},i.toISOString=function(){return this.toDate().toISOString()},i.toString=function(){return this.toDate().toUTCString()};var c=i.toDate;i.toDate=function(e){return e==="s"&&this.$offset?p(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():c.call(this)};var n=i.diff;i.diff=function(e,r,s){if(e&&this.$u===e.$u)return n.call(this,e,r,s);var u=this.local(),a=p(e).local();return n.call(u,a,r,s)}}})}(M)),M.exports}var J=G();const pe=B(J);var _={exports:{}},Q=_.exports,A;function ee(){return A||(A=1,function(D,F){(function(v,f){D.exports=f()})(Q,function(){var v={year:0,month:1,day:2,hour:3,minute:4,second:5},f={};return function(R,O,l){var p,i=function(o,c,n){n===void 0&&(n={});var e=new Date(o),r=function(s,u){u===void 0&&(u={});var a=u.timeZoneName||"short",x=s+"|"+a,h=f[x];return h||(h=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:s,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:a}),f[x]=h),h}(c,n);return r.formatToParts(e)},$=function(o,c){for(var n=i(o,c),e=[],r=0;r<n.length;r+=1){var s=n[r],u=s.type,a=s.value,x=v[u];x>=0&&(e[x]=parseInt(a,10))}var h=e[3],T=h===24?0:h,g=e[0]+"-"+e[1]+"-"+e[2]+" "+T+":"+e[4]+":"+e[5]+":000",C=+o;return(l.utc(g).valueOf()-(C-=C%1e3))/6e4},d=O.prototype;d.tz=function(o,c){o===void 0&&(o=p);var n,e=this.utcOffset(),r=this.toDate(),s=r.toLocaleString("en-US",{timeZone:o}),u=Math.round((r-new Date(s))/1e3/60),a=15*-Math.round(r.getTimezoneOffset()/15)-u;if(!Number(a))n=this.utcOffset(0,c);else if(n=l(s,{locale:this.$L}).$set("millisecond",this.$ms).utcOffset(a,!0),c){var x=n.utcOffset();n=n.add(e-x,"minute")}return n.$x.$timezone=o,n},d.offsetName=function(o){var c=this.$x.$timezone||l.tz.guess(),n=i(this.valueOf(),c,{timeZoneName:o}).find(function(e){return e.type.toLowerCase()==="timezonename"});return n&&n.value};var S=d.startOf;d.startOf=function(o,c){if(!this.$x||!this.$x.$timezone)return S.call(this,o,c);var n=l(this.format("YYYY-MM-DD HH:mm:ss:SSS"),{locale:this.$L});return S.call(n,o,c).tz(this.$x.$timezone,!0)},l.tz=function(o,c,n){var e=n&&c,r=n||c||p,s=$(+l(),r);if(typeof o!="string")return l(o).tz(r);var u=function(T,g,C){var j=T-60*g*1e3,b=$(j,C);if(g===b)return[j,g];var w=$(j-=60*(b-g)*1e3,C);return b===w?[j,b]:[T-60*Math.min(b,w)*1e3,Math.max(b,w)]}(l.utc(o,e).valueOf(),s,r),a=u[0],x=u[1],h=l(a).utcOffset(x);return h.$x.$timezone=r,h},l.tz.guess=function(){return Intl.DateTimeFormat().resolvedOptions().timeZone},l.tz.setDefault=function(o){p=o}}})}(_)),_.exports}var te=ee();const xe=B(te);export{me as R,xe as t,pe as u};
