import{r as s,j as e,H as ve,a as Z}from"./app-CADLw3G9.js";import{d as ee}from"./dayjs.min-DKN-ELA8.js";import{B as be}from"./BookingHeader-eDzihycA.js";import{a9 as Se,T as Re,C as I,B as u}from"./Logo-CLAK33tc.js";import{L as de}from"./index-C06X103F.js";import{P as ke}from"./progress-SnWWg880.js";import{R as we,C as te}from"./row-Dom2nqZh.js";import{R as re}from"./FileTextOutlined-BXH5MtbD.js";import{C as oe}from"./index-DnbYL6Tl.js";import{S as ie}from"./index-nwNNYHB9.js";import{T as z}from"./index-CKLq3zDx.js";import{R as ne}from"./EyeOutlined-BYtrtgzO.js";import{A as k}from"./index-CfCHoYee.js";import{D as A}from"./index-B12X-zrZ.js";import{R as Te}from"./ArrowLeftOutlined-Br1CB3En.js";import{R as qe}from"./ArrowRightOutlined-BJ7EAVJj.js";import{M as se}from"./index-C6Y6ZG1D.js";import{I as ae}from"./index-SwRbmmP5.js";import{R as le}from"./PhoneOutlined-gkVsPP0b.js";import{R as Be}from"./SendOutlined-Cs3YIVtG.js";import{R as _e}from"./CheckOutlined-CB16nTDZ.js";import{s as a}from"./index-2mpHb7UY.js";import{C as Oe}from"./Collapse-DwQef7_i.js";/* empty css            */import"./CustomerLoginModal-D-DurPKh.js";import"./LockOutlined-COLUNfIz.js";import"./LogoutOutlined-D2_QBXct.js";import"./BookOutlined-0oTi6rVr.js";import"./CalendarOutlined-Cm65HkJR.js";import"./CheckCircleFilled-CHwNSVBx.js";import"./useClosable-CSbyRlS0.js";import"./pickAttrs-9MlZ-O9_.js";import"./extendsObject-78o_rR5W.js";import"./EyeOutlined-Bmd706kk.js";import"./InfoCircleFilled-DJey1gcQ.js";import"./PurePanel-DvLIh7gb.js";import"./Input-DEZKARtK.js";import"./EyeOutlined-DLLudd9l.js";const{Title:C,Text:o,Paragraph:Ie}=Re,{Panel:Ct}=Oe,{Content:ze}=de;function vt({service:l,selectedExtras:j,date:E,time:L,consentSettings:S,selectedPricingTier:n,selectedDuration:Ae,selectedPrice:Pe,auth:v}){const[y,Y]=s.useState([]),[b,ce]=s.useState(null),[pe,P]=s.useState(!1),[d,w]=s.useState(""),[c,V]=s.useState(""),[F,N]=s.useState(!1),[p,T]=s.useState(!1),[q,M]=s.useState(!1),[f,B]=s.useState(!1),[fe,D]=s.useState(!1),[J,me]=s.useState("");s.useEffect(()=>{v&&v.user&&v.user.phone_number&&(T(!0),M(!0),w(v.user.phone_number)),ye()},[v]);const he=()=>{const t=j.map(m=>m.id),r=j.map(m=>({id:m.id,quantity:m.quantity||1})),i=encodeURIComponent(JSON.stringify(r));Z.visit(route("booking.select-datetime"),{data:{service_id:l.id,pricing_tier_id:n?.id,selected_duration:n?.duration_minutes||l.duration,selected_price:n?.price||l.price,extras:t,extra_quantities_json:i}})},ue=()=>{const t=S.filter(x=>x.is_required),r=t.every(x=>y.includes(x.id));if(console.log("handleContinue called",{allRequiredAccepted:r,otpVerified:p,verificationCompleted:q,requiredConsents:t.length,acceptedConsents:y.length}),!r){a.error("Please accept all required agreements to continue");return}if(t.length>0&&!p&&!q){console.log("Showing phone verification modal"),D(!0);return}q&&!p&&T(!0),console.log("Proceeding to confirmation page");const i=j.map(x=>x.id),m=j.map(x=>({id:x.id,quantity:x.quantity||1})),O=encodeURIComponent(JSON.stringify(m)),h=y,H={service_id:l.id,pricing_tier_id:n?.id,selected_duration:n?.duration_minutes||l.duration,selected_price:n?.price||l.price,extras:i,extra_quantities_json:O,date:E,time:L,consents:h};(p||q)&&d&&(H.verified_phone=d),console.log("Navigating to confirm page with data:",H),Z.visit(route("booking.confirm"),{data:H})},W=t=>{ce(t),P(!0)},Q=t=>{Y(r=>r.includes(t)?r.filter(i=>i!==t):[...r,t])},$=()=>{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return t||(console.error("CSRF token not found in meta tag"),a.error("CSRF token not found. Please refresh the page."),null)},K=()=>{a.error("Session expired. Please refresh the page and try again.")},ye=async()=>{const t=$();if(!t)return!1;try{const r=await fetch(route("test-csrf"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"}});return r.ok?(console.log("CSRF token is valid"),!0):(console.error("CSRF token validation failed:",r.status),!1)}catch(r){return console.error("Error testing CSRF token:",r),!1}},X=async()=>{if(!d||d.length<10){a.error("Please enter a valid phone number");return}const t=$();if(t)try{B(!0);const r=await fetch(route("booking.send-otp"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"},body:JSON.stringify({phone_number:d})});if(!r.ok){if(r.status===419){K();return}const m=await r.json().catch(()=>({}));a.error(m.error||"Failed to send OTP");return}const i=await r.json();a.success("OTP sent successfully to your phone number"),N(!0),i.otp&&me(i.otp)}catch(r){console.error("Error sending OTP:",r),a.error("Failed to send OTP")}finally{B(!1)}},ge=async()=>{if(!c||c.length!==6){a.error("Please enter a valid 6-digit OTP");return}const t=$();if(t)try{B(!0);const r=await fetch(route("customer.login"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"},body:JSON.stringify({phone_number:d,otp:c})});if(!r.ok){if(r.status===419){K();return}const h=await r.json().catch(()=>({}));a.error(h.error||"Invalid OTP");return}const i=await r.json();a.success("Phone number verified successfully!"),T(!0),M(!0),D(!1),i.formatted_phone&&w(i.formatted_phone),i.user;const O=S.filter(h=>h.is_required).find(h=>!y.includes(h.id));O&&Y(h=>[...h,O.id])}catch(r){console.error("Error verifying OTP:",r),a.error("Failed to verify OTP")}finally{B(!1)}},xe=()=>{D(!1),w(""),V(""),N(!1),T(!1),M(!1)},_=t=>`₹${parseFloat(t).toFixed(2)}`,U=t=>{if(t<60)return`${t} min`;{const r=Math.floor(t/60),i=t%60;return i>0?`${r}h ${i}m`:`${r}h`}},je=t=>ee(t,"HH:mm").format("h:mm A"),Ce=t=>ee(t).format("dddd, MMMM D, YYYY"),g=S.filter(t=>t.is_required),G=S.filter(t=>!t.is_required),R=g.every(t=>y.includes(t.id));return e.jsxs(de,{style:{minHeight:"100vh"},children:[e.jsx(ve,{title:"Consent & Terms - Book Appointment"}),e.jsx(be,{auth:v}),e.jsx(ze,{children:e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(Se,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(C,{level:2,style:{marginTop:24,marginBottom:8},children:"Consent & Terms"}),e.jsx(o,{type:"secondary",style:{fontSize:16},children:"Please review and accept our terms and conditions"})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(ke,{percent:80,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(o,{type:"secondary",children:"Step 4 of 5"})})]}),e.jsxs(we,{gutter:[32,32],children:[e.jsxs(te,{xs:24,lg:16,children:[g.length>0&&e.jsxs(I,{style:{marginBottom:24},children:[e.jsxs(C,{level:4,style:{marginBottom:16},children:[e.jsx(re,{style:{marginRight:8,color:"#ff4d4f"}}),"Required Agreements"]}),g.map(t=>{const r=y.includes(t.id);return e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:r?"#f6ffed":"white"},children:[e.jsx(oe,{checked:r,onChange:()=>Q(t.id),style:{marginRight:12,marginTop:2}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(C,{level:5,style:{margin:0},children:t.title}),e.jsxs(ie,{children:[e.jsx(z,{color:"red",children:"Required"}),e.jsx(u,{type:"text",size:"small",icon:e.jsx(ne,{}),onClick:()=>W(t),children:"View"})]})]}),t.summary&&e.jsx(o,{type:"secondary",style:{fontSize:14},children:t.summary})]})]})},t.id)})]}),G.length>0&&e.jsxs(I,{children:[e.jsxs(C,{level:4,style:{marginBottom:16},children:[e.jsx(re,{style:{marginRight:8,color:"#1890ff"}}),"Optional Agreements"]}),G.map(t=>{const r=y.includes(t.id);return e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:r?"#f6ffed":"white"},children:[e.jsx(oe,{checked:r,onChange:()=>Q(t.id),style:{marginRight:12,marginTop:2}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(C,{level:5,style:{margin:0},children:t.title}),e.jsxs(ie,{children:[e.jsx(z,{color:"blue",children:"Optional"}),e.jsx(u,{type:"text",size:"small",icon:e.jsx(ne,{}),onClick:()=>W(t),children:"View"})]})]}),t.summary&&e.jsx(o,{type:"secondary",style:{fontSize:14},children:t.summary})]})]})},t.id)})]}),S.length===0&&e.jsx(I,{children:e.jsx(k,{message:"No consent documents available",description:"There are no terms and conditions to review at this time.",type:"info",showIcon:!0})})]}),e.jsx(te,{xs:24,lg:8,children:e.jsxs(I,{style:{position:"sticky",top:24},children:[e.jsx(C,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(o,{strong:!0,children:[l.name,n&&e.jsx(z,{color:"blue",style:{marginLeft:8,fontSize:10},children:n.name})]}),e.jsx(o,{children:_(n?n.price:l.price)})]}),e.jsx(o,{type:"secondary",style:{fontSize:12},children:U(n?n.duration_minutes:l.duration)})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(A,{style:{margin:"12px 0"}}),j.map(t=>{const r=t.quantity||1;return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(o,{children:["+ ",t.name,r>1&&e.jsxs(o,{type:"secondary",style:{fontSize:12},children:[" ","× ",r]})]}),e.jsx(o,{children:_(parseFloat(t.price)*r)})]}),e.jsxs(o,{type:"secondary",style:{fontSize:12},children:[t.duration_relation?t.duration_relation.label:"No additional time",r>1&&e.jsxs(o,{type:"secondary",style:{fontSize:12},children:[" ","× ",r]})]})]},t.id)})]}),e.jsx(A,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(o,{strong:!0,children:"Total Price"}),e.jsx(o,{strong:!0,style:{fontSize:16},children:_(parseFloat(n?n.price:l.price)+j.reduce((t,r)=>{const i=r.quantity||1;return t+parseFloat(r.price)*i},0))})]}),e.jsx(A,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(o,{type:"secondary",children:"Appointment Date"}),e.jsx("div",{children:e.jsx(o,{strong:!0,children:Ce(E)})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(o,{type:"secondary",children:"Appointment Time"}),e.jsx("div",{children:e.jsx(o,{strong:!0,children:je(L)})})]}),e.jsx(A,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(o,{type:"secondary",children:"Required Agreements"}),e.jsx("div",{children:e.jsxs(o,{strong:!0,style:{color:R?"#52c41a":"#ff4d4f"},children:[y.filter(t=>g.find(r=>r.id===t)).length," ","of ",g.length," ","accepted"]})})]}),g.length>0&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(o,{type:"secondary",children:"Phone Verification"}),e.jsx("div",{children:e.jsx(o,{strong:!0,style:{color:p?"#52c41a":"#ff4d4f"},children:p?"✓ Verified":"✗ Not Verified"})})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(u,{block:!0,style:{marginBottom:12},icon:e.jsx(Te,{}),onClick:he,children:"Back to Date & Time"}),e.jsx(u,{type:"primary",block:!0,size:"large",icon:e.jsx(qe,{}),onClick:ue,disabled:!R||f,loading:f,children:g.length>0&&!p?"Verify Phone Number":"Continue to Confirmation"})]}),!R&&e.jsx(k,{message:"Required agreements not accepted",description:"Please accept all required terms and conditions to continue.",type:"warning",showIcon:!0,style:{marginTop:16}}),R&&!p&&g.length>0&&e.jsx(k,{message:"Phone verification required",description:"Please verify your phone number to continue with the booking.",type:"warning",showIcon:!0,style:{marginTop:16}}),R&&p&&e.jsx(k,{message:"All requirements completed",description:"You can now proceed to the confirmation page.",type:"success",showIcon:!0,style:{marginTop:16}})]})})]}),e.jsx(se,{title:b?.title,open:pe,onCancel:()=>P(!1),footer:[e.jsx(u,{onClick:()=>P(!1),children:"Close"},"close")],width:800,children:b&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(z,{color:b.is_required?"red":"blue",children:b.is_required?"Required":"Optional"}),e.jsxs(o,{type:"secondary",style:{marginLeft:8},children:["Version ",b.version]})]}),e.jsx("div",{style:{maxHeight:400,overflowY:"auto",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:"#fafafa"},children:e.jsx(Ie,{style:{whiteSpace:"pre-line",margin:0},children:b.content})})]})}),e.jsx(se,{title:e.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[e.jsx("div",{style:{width:60,height:60,borderRadius:"50%",backgroundColor:"#f0f8ff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",border:"2px solid #e6f7ff"},children:e.jsx(le,{style:{fontSize:28,color:"#1890ff"}})}),e.jsx(C,{level:3,style:{margin:0,color:"#262626"},children:"Phone Verification"})]}),open:fe,onCancel:xe,footer:null,width:480,closable:!f,centered:!0,style:{top:20},styles:{body:{padding:"32px 24px"}},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(o,{type:"secondary",style:{fontSize:16,lineHeight:1.6,color:"#595959"},children:F?`We've sent a 6-digit code to ${d}`:"Enter your phone number to receive a verification code"}),F&&J&&e.jsx(k,{message:"Testing Mode - OTP Code",description:`Your verification code is: ${J}`,type:"info",showIcon:!0,style:{marginTop:16}})]}),F?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:32},children:[e.jsxs("div",{style:{position:"relative",display:"flex",justifyContent:"center",gap:8,marginBottom:16},children:[e.jsx(ae,{size:"large",placeholder:"Enter 6-digit code",value:c,onChange:t=>V(t.target.value),maxLength:6,style:{position:"absolute",opacity:0,zIndex:10,width:"100%",height:"100%"},autoFocus:!0}),[0,1,2,3,4,5].map(t=>e.jsx("div",{style:{width:48,height:56,border:"2px solid #d9d9d9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:600,backgroundColor:c[t]?"#f6ffed":"#fafafa",borderColor:c[t]?"#52c41a":"#d9d9d9",transition:"all 0.2s ease",cursor:"text"},children:c[t]||""},t))]}),e.jsx(o,{type:"secondary",style:{fontSize:14},children:"Enter the 6-digit verification code"})]}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[e.jsx(u,{onClick:()=>{N(!1),V("")},disabled:f,style:{height:44,borderRadius:8,border:"1px solid #d9d9d9",color:"#595959"},children:"Change Number"}),e.jsx(u,{type:"primary",icon:e.jsx(_e,{}),onClick:ge,loading:f,disabled:!c||c.length!==6,style:{height:44,borderRadius:8,background:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",boxShadow:"0 4px 12px rgba(82, 196, 26, 0.3)"},children:f?"Verifying...":"Verify Code"})]}),e.jsx("div",{style:{marginTop:24},children:e.jsxs(o,{type:"secondary",style:{fontSize:12},children:["Didn't receive the code?"," ",e.jsx(u,{type:"link",size:"small",style:{padding:0,height:"auto"},onClick:X,disabled:f,children:"Resend"})]})})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{position:"relative",marginBottom:8},children:e.jsx(ae,{size:"large",placeholder:"+91 98765 43210",prefix:e.jsx(le,{style:{color:"#bfbfbf"}}),value:d,onChange:t=>w(t.target.value),style:{height:48,fontSize:16,borderRadius:8,border:"1px solid #d9d9d9"}})}),e.jsx(o,{type:"secondary",style:{fontSize:12},children:"We'll send you a verification code via SMS"})]}),e.jsx(u,{type:"primary",size:"large",icon:e.jsx(Be,{}),onClick:X,loading:f,disabled:!d||d.length<10,style:{height:48,fontSize:16,fontWeight:500,borderRadius:8,width:"100%",background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",border:"none",boxShadow:"0 4px 12px rgba(24, 144, 255, 0.3)"},children:f?"Sending...":"Send Verification Code"})]})]})})]})})]})}export{vt as default};
