import{r as h,j as e,H as le,a as u}from"./app-CADLw3G9.js";import{A as ae}from"./AdminLayout-Bkcva9sz.js";import{F as o}from"./index-er7eshNq.js";import{T as ce,B as x,C as V}from"./Logo-CLAK33tc.js";import{R as L}from"./PlusOutlined-CiRxDKim.js";import{F as de}from"./Table-f54mNrSR.js";import{M as I}from"./index-C6Y6ZG1D.js";import{R as g,C as d}from"./row-Dom2nqZh.js";import{I as D}from"./index-SwRbmmP5.js";import{T as f}from"./index-CKLq3zDx.js";import{S as G}from"./index-8xFw_M6G.js";import{T as b}from"./index-B59RCmvW.js";import{U as pe,R as me}from"./InboxOutlined-BLZCNtBV.js";import{S as y}from"./index-gi2fN0ny.js";import{S as B}from"./index-nwNNYHB9.js";import{R as N}from"./EditOutlined-aUhqXkCX.js";import{R as q}from"./DeleteOutlined-CvjSrNv9.js";import{I as ue}from"./index-DxOU0hPj.js";import{R as he}from"./EyeOutlined-BYtrtgzO.js";import{s as a}from"./index-2mpHb7UY.js";/* empty css            */import"./index-C06X103F.js";import"./index-La3HCdEx.js";import"./PurePanel-DvLIh7gb.js";import"./move-JM2Y3ogW.js";import"./LogoutOutlined-D2_QBXct.js";import"./CalendarOutlined-Cm65HkJR.js";import"./DollarOutlined-dEwdo4p7.js";import"./UserOutlined-JTobUxAg.js";import"./ClockCircleOutlined-BiPqo-PL.js";import"./SettingOutlined-BGwVwhiu.js";import"./FileTextOutlined-BXH5MtbD.js";import"./GiftOutlined-DD_DTpKe.js";import"./useForm-2v7yEcOp.js";import"./CheckCircleFilled-CHwNSVBx.js";import"./InfoCircleFilled-DJey1gcQ.js";import"./pickAttrs-9MlZ-O9_.js";import"./addEventListener-nc9iz5R8.js";import"./DownOutlined-iF-x33Tt.js";import"./index-DnbYL6Tl.js";import"./index-CA6uoqpu.js";import"./index-0L_wmmjA.js";import"./extendsObject-78o_rR5W.js";import"./index-DDNcFxHa.js";import"./Input-DEZKARtK.js";import"./useClosable-CSbyRlS0.js";import"./EyeOutlined-DLLudd9l.js";import"./EyeOutlined-Bmd706kk.js";import"./DownloadOutlined-DTidZHln.js";import"./progress-SnWWg880.js";const{Title:$,Text:m}=ce,{TextArea:k}=D,{Option:ge}=G;function mi({auth:H,services:Y,durations:J,errors:S,editService:w}){const[P,j]=h.useState(!1),[n,M]=h.useState(null),[l]=o.useForm(),[O,v]=h.useState(!1),[R,T]=h.useState(null),[K,_]=h.useState(!1),[F,C]=h.useState(null),[A]=o.useForm(),E=Y||[],z=J||[];h.useEffect(()=>{S&&Object.keys(S).length>0&&(Object.keys(S).forEach(i=>{l.setFields([{name:i,errors:[S[i]]}])}),j(!0))},[S,l]),h.useEffect(()=>{if(P)if(n){const i={name:n.name,description:n.description||"",price:parseFloat(n.price)||0,duration:parseInt(n.duration)||60,color:n.color||"#1890ff",sort_order:n.sort_order||0,is_active:n.is_active!==void 0?n.is_active:!0,is_upcoming:n.is_upcoming||!1,has_flexible_duration:n.has_flexible_duration||!1,has_tba_pricing:n.has_tba_pricing||!1,coming_soon_description:n.coming_soon_description||""};setTimeout(()=>{l.setFieldsValue(i),console.log("Form values set via useEffect for editing:",i)},100)}else setTimeout(()=>{l.setFieldsValue({is_active:!0,color:"#1890ff",duration:60,sort_order:0,description:"",is_upcoming:!1,has_flexible_duration:!1,has_tba_pricing:!1,coming_soon_description:""}),console.log("Default form values set via useEffect for adding")},100)},[P,n,l]),h.useEffect(()=>{if(w){const i=E.find(s=>s.id==w);i&&U(i)}},[w,E]);const W=[{title:"Image",dataIndex:"image",key:"image",render:(i,s)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(ue,{width:40,height:40,src:i||`https://placehold.co/40x40/${s.color?.replace("#","")||"1890ff"}/ffffff?text=${s.name?.charAt(0)?.toUpperCase()||"S"}`,alt:s.name,style:{borderRadius:4},fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"}),e.jsx("div",{children:e.jsx("div",{style:{fontWeight:"bold"},children:s.name})})]})},{title:"Price",dataIndex:"price",key:"price",render:(i,s)=>s.has_tba_pricing?e.jsx(f,{color:"orange",children:"To be announced"}):`₹${i}`},{title:"Duration",dataIndex:"duration",key:"duration",render:(i,s)=>{if(s.has_flexible_duration)return e.jsx(f,{color:"blue",children:"Flexible"});const t=z.find(c=>c.value===i);return t?t.label:`${i} min`}},{title:"Pricing Tiers",dataIndex:"pricing_tiers",key:"pricing_tiers",render:(i,s)=>!i||i.length===0?e.jsx(m,{type:"secondary",style:{fontSize:12},children:"Standard pricing"}):e.jsxs("div",{children:[e.jsxs(m,{strong:!0,style:{fontSize:12},children:[i.length," tier",i.length>1?"s":""]}),e.jsx("br",{}),e.jsxs(m,{type:"secondary",style:{fontSize:11},children:["From ₹",Math.min(...i.map(t=>t.price))," - ₹",Math.max(...i.map(t=>t.price))]})]})},{title:"Employees",dataIndex:"employees",key:"employees",render:()=>e.jsx("div",{style:{opacity:.5},children:e.jsx(f,{color:"orange",size:"small",children:"Coming Soon"})})},{title:"Sort Order",dataIndex:"sort_order",key:"sort_order",render:(i,s)=>e.jsx(b,{min:0,max:999,value:i,onChange:t=>ee(s.id,t),style:{width:80},size:"small"})},{title:"Status",dataIndex:"is_active",key:"is_active",render:(i,s)=>e.jsxs(B,{direction:"vertical",size:4,children:[e.jsx(f,{color:i?"green":"red",children:i?"Active":"Inactive"}),s.is_upcoming&&e.jsx(f,{color:"purple",children:"Coming Soon"})]})},{title:"Actions",key:"actions",render:(i,s)=>e.jsxs(B,{children:[e.jsx(x,{type:"text",icon:e.jsx(he,{}),size:"small",onClick:()=>Z(s)}),e.jsx(x,{type:"text",icon:e.jsx(N,{}),size:"small",onClick:()=>U(s)}),e.jsx(x,{type:"text",icon:e.jsx(q,{}),size:"small",danger:!0,loading:R===s.id,disabled:R===s.id,onClick:()=>ie(s)})]})}],X=()=>{M(null),l.resetFields(),l.setFields([]),j(!0)},U=i=>{M(i),l.setFields([]),l.resetFields(),console.log("Service data for editing:",i),j(!0)},Z=i=>{u.visit(route("admin.services.show",i.id))},ee=(i,s)=>{if(s===null||s<0){a.error("Sort order must be a positive number");return}u.put(route("admin.services.update-sort-order",i),{sort_order:s},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{a.success("Sort order updated successfully")},onError:t=>{a.error(t.error||"Failed to update sort order")}})},ie=i=>{I.confirm({title:"Delete Service",content:e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsxs("strong",{children:['"',i.name,'"']}),"?"]}),e.jsxs("p",{style:{color:"#ff4d4f",fontSize:"14px",marginTop:8},children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone and will permanently remove:"]}),e.jsxs("ul",{style:{color:"#666",fontSize:"14px",marginTop:4},children:[e.jsx("li",{children:"The service and all its data"}),e.jsx("li",{children:"Any associated bookings (if they exist)"}),e.jsx("li",{children:"Service images and files"})]})]}),okText:"Delete Service",okType:"danger",cancelText:"Cancel",width:500,onOk(){T(i.id),a.loading({content:"Deleting service...",key:"deleteService"}),console.log("Attempting to delete service:",i.id),console.log("Delete route:",route("admin.services.delete",i.id)),u.post(route("admin.services.delete",i.id),{onSuccess:()=>{console.log("Service deleted successfully"),a.success({content:`Service "${i.name}" deleted successfully`,key:"deleteService",duration:3}),T(null),u.visit(route("admin.services"),{replace:!0,preserveScroll:!1})},onError:s=>{console.error("Delete service errors:",s),a.error({content:"Failed to delete service. Please try again.",key:"deleteService",duration:5}),T(null)},onFinish:()=>{console.log("Delete request finished")}})}})},re=()=>{const i=l.getFieldsValue();console.log("Current form values before validation:",i);const s=l.getFieldValue("description");console.log("Description field value:",s),l.validateFields().then(t=>{v(!0),console.log("Form validation passed, values:",t);const c=new FormData;console.log("Form values:",t),Object.keys(t).forEach(r=>{if(console.log(`Processing field ${r}:`,t[r]),r!=="employees")if(r==="image"&&t[r]?.fileList?.[0]?.originFileObj)c.append("image",t[r].fileList[0].originFileObj);else if(r==="color")c.append("color",t[r]||"#1890ff");else if(r==="price"){const p=parseFloat(t[r])||0;c.append(r,p),console.log("Price value:",p)}else if(r==="duration"){const p=parseInt(t[r])||0;c.append(r,p),console.log("Duration value:",p)}else r==="is_active"?(c.append(r,t[r]?"1":"0"),console.log("is_active value:",t[r]?"1":"0")):r==="is_upcoming"||r==="has_flexible_duration"||r==="has_tba_pricing"?(c.append(r,t[r]?"1":"0"),console.log(`${r} value:`,t[r]?"1":"0")):r==="description"?(c.append(r,t[r]||""),console.log("Description value:",t[r]||"")):(c.append(r,t[r]||""),console.log(`${r} value:`,t[r]||""))}),console.log("=== FormData being sent to backend ===");for(let[r,p]of c.entries())console.log(`${r}:`,p);console.log("=== End FormData ==="),n?(c.append("_method","PUT"),u.post(route("admin.services.update",n.id),c,{onSuccess:()=>{a.success("Service updated successfully"),j(!1),l.resetFields()},onError:r=>{console.error("Update service errors:",r),r&&Object.keys(r).forEach(p=>{l.setFields([{name:p,errors:[r[p]]}])}),a.error("Failed to update service")},onFinish:()=>{v(!1)}})):u.post(route("admin.services.store"),c,{onSuccess:()=>{a.success("Service created successfully"),j(!1),l.resetFields()},onError:r=>{console.error("Create service errors:",r),r&&Object.keys(r).forEach(p=>{l.setFields([{name:p,errors:[r[p]]}])}),a.error("Failed to create service")},onFinish:()=>{v(!1)}})}).catch(t=>{console.error("Form validation failed:",t),a.error("Please check the form and try again")})},se=()=>{j(!1),l.resetFields()},te=i=>{C(i),_(!0),setTimeout(()=>{A.setFieldsValue({name:i.name,description:i.description||"",duration_minutes:i.duration_minutes,price:i.price,is_popular:i.is_popular||!1,is_active:i.is_active!==void 0?i.is_active:!0,sort_order:i.sort_order||0})},100)},oe=i=>{I.confirm({title:"Delete Pricing Tier",content:"Are you sure you want to delete this pricing tier?",okText:"Yes",okType:"danger",cancelText:"No",onOk(){u.post(route("admin.pricing-tiers.delete",i),{},{onSuccess:()=>{a.success("Pricing tier deleted successfully"),u.reload()},onError:()=>{a.error("Failed to delete pricing tier")}})}})},Q=()=>{A.validateFields().then(i=>{v(!0);const s=new FormData;!F&&n&&s.append("service_id",n.id),Object.keys(i).forEach(t=>{t==="is_popular"||t==="is_active"?s.append(t,i[t]?"1":"0"):s.append(t,i[t]||"")}),F?(s.append("_method","PUT"),u.post(route("admin.pricing-tiers.update",F.id),s,{onSuccess:()=>{a.success("Pricing tier updated successfully"),_(!1),A.resetFields(),C(null),u.reload()},onError:t=>{console.error("Update pricing tier errors:",t),a.error("Failed to update pricing tier")},onFinish:()=>{v(!1)}})):u.post(route("admin.pricing-tiers.store"),s,{onSuccess:()=>{a.success("Pricing tier created successfully"),_(!1),A.resetFields(),u.reload()},onError:t=>{console.error("Create pricing tier errors:",t),a.error("Failed to create pricing tier")},onFinish:()=>{v(!1)}})}).catch(i=>{console.error("Pricing tier form validation failed:",i),a.error("Please check the form and try again")})},ne=()=>{_(!1),A.resetFields(),C(null)};return e.jsxs(ae,{auth:H,children:[e.jsx(le,{title:"Services Management"}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:24,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx($,{level:2,style:{marginBottom:8},children:"Services"}),e.jsx(m,{type:"secondary",children:"Create and manage your services for customer bookings"})]}),e.jsx(x,{type:"primary",icon:e.jsx(L,{}),size:"large",onClick:X,children:"Create Service"})]}),e.jsx(V,{children:e.jsx(de,{columns:W,dataSource:E,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(i,s)=>`${s[0]}-${s[1]} of ${i} services`}})}),e.jsx(I,{title:n?"Edit Service":"Create Service",open:P,onOk:re,onCancel:se,width:800,okText:n?"Update":"Add Service",confirmLoading:O,children:e.jsxs(o,{form:l,layout:"vertical",children:[e.jsxs(g,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"name",label:"Service name*",rules:[{required:!0,message:"Please enter service name",whitespace:!0}],children:e.jsx(D,{placeholder:"Enter name"})})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"color",label:"Color",children:e.jsx(D,{type:"color",style:{width:"100%",height:"40px"}})})})]}),e.jsx(g,{gutter:16,children:e.jsx(d,{span:12,children:e.jsx(o.Item,{label:"Employees",children:e.jsx("div",{style:{padding:"8px 12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"not-allowed"},children:e.jsxs(m,{type:"secondary",children:[e.jsx(f,{color:"orange",children:"Coming Soon"})," ","Employee assignment will be available soon"]})})})})}),e.jsx(o.Item,{name:"description",label:"Description",children:e.jsx(k,{rows:4,placeholder:"Insert text here ...",style:{minHeight:100}})}),e.jsx(m,{type:"secondary",style:{fontSize:"12px",marginTop:4,marginBottom:16},children:"Descriptions appear on your booking page."}),e.jsxs(g,{gutter:16,children:[e.jsxs(d,{span:12,children:[e.jsx(o.Item,{name:"duration",label:"Duration*",rules:[{required:!0,message:"Please select duration"}],children:e.jsx(G,{placeholder:"Select duration",children:z.map(i=>e.jsx(ge,{value:i.value,children:i.label},i.value))})}),e.jsxs(m,{type:"secondary",style:{fontSize:"12px",marginTop:4},children:["Manage available durations in the"," ",e.jsx("a",{href:route("admin.durations"),style:{color:"#1890ff"},children:"Durations"})," ","section."]})]}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"price",label:"Price*",rules:[{required:!0,message:"Please enter price"},{type:"number",min:0,message:"Price must be a positive number"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"0.00",min:0,step:.01,formatter:i=>`₹ ${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:i=>i.replace(/₹\s?|(,*)/g,"")})})})]}),e.jsx(g,{gutter:16,children:e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"sort_order",label:"Sort Order",rules:[{type:"number",min:0,message:"Sort order must be a positive number"}],children:e.jsx(b,{style:{width:"100%"},placeholder:"0",min:0,max:999})})})}),e.jsx(o.Item,{name:"image",label:"Service image",children:e.jsxs(pe.Dragger,{name:"file",multiple:!1,beforeUpload:()=>!1,showUploadList:!0,accept:"image/*",maxCount:1,fileList:[],children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(me,{})}),e.jsx("p",{className:"ant-upload-text",children:"Drag and drop or choose from files"})]})}),e.jsxs(g,{gutter:16,children:[e.jsx(d,{span:8,children:e.jsx(o.Item,{name:"is_active",label:"Active",valuePropName:"checked",children:e.jsx(y,{})})}),e.jsx(d,{span:8,children:e.jsx(o.Item,{name:"is_upcoming",label:"Upcoming Service",valuePropName:"checked",children:e.jsx(y,{})})})]}),e.jsx(o.Item,{noStyle:!0,shouldUpdate:(i,s)=>i.is_upcoming!==s.is_upcoming,children:({getFieldValue:i})=>i("is_upcoming")?e.jsxs(e.Fragment,{children:[e.jsxs(g,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"has_flexible_duration",label:"Flexible Duration",valuePropName:"checked",children:e.jsx(y,{})})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"has_tba_pricing",label:"TBA Pricing",valuePropName:"checked",children:e.jsx(y,{})})})]}),e.jsx(o.Item,{name:"coming_soon_description",label:"Coming Soon Description",children:e.jsx(k,{rows:3,placeholder:"Describe what makes this upcoming service special...",style:{minHeight:80}})}),e.jsx("div",{style:{padding:"12px",backgroundColor:"#f0f8ff",border:"1px solid #bae7ff",borderRadius:"6px",marginBottom:16},children:e.jsxs(m,{type:"secondary",style:{fontSize:"12px"},children:[e.jsx("strong",{children:"Note:"}),` Upcoming services will be displayed to customers but cannot be booked. They're perfect for announcing new services that are "Coming Soon".`]})})]}):null}),e.jsxs("div",{style:{marginTop:24,marginBottom:16},children:[e.jsx($,{level:4,style:{marginBottom:16},children:"Pricing Tiers (Optional)"}),e.jsx(m,{type:"secondary",style:{fontSize:14,marginBottom:16,display:"block"},children:"Add multiple pricing options for this service. If no tiers are added, the service will use the standard price and duration above."}),e.jsx("div",{style:{marginBottom:16},children:n?.pricing_tiers?.length>0?e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:12},children:e.jsx(m,{strong:!0,children:"Current Pricing Tiers:"})}),n.pricing_tiers.map((i,s)=>e.jsx(V,{size:"small",style:{marginBottom:8,border:"1px solid #f0f0f0"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(m,{strong:!0,children:i.name}),e.jsx("br",{}),e.jsxs(m,{type:"secondary",style:{fontSize:12},children:[i.duration_minutes," ","min • ₹",i.price,i.is_popular&&e.jsx(f,{color:"gold",style:{marginLeft:8},children:"Popular"})]})]}),e.jsxs(B,{children:[e.jsx(x,{size:"small",icon:e.jsx(N,{}),onClick:()=>te(i),children:"Edit"}),e.jsx(x,{size:"small",danger:!0,icon:e.jsx(q,{}),onClick:()=>oe(i.id),children:"Delete"})]})]})},i.id||s))]}):e.jsx("div",{style:{padding:16,border:"1px dashed #d9d9d9",borderRadius:8,backgroundColor:"#fafafa",textAlign:"center"},children:e.jsx(m,{type:"secondary",children:"No pricing tiers added yet."})})}),e.jsx(x,{type:"dashed",icon:e.jsx(L,{}),onClick:()=>_(!0),style:{width:"100%"},children:"Add Pricing Tier"})]})]})}),e.jsx(I,{title:F?"Edit Pricing Tier":"Add Pricing Tier",open:K,onOk:Q,onCancel:ne,confirmLoading:O,width:600,children:e.jsxs(o,{form:A,layout:"vertical",onFinish:Q,children:[e.jsxs(g,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"name",label:"Tier Name",rules:[{required:!0,message:"Please enter tier name"}],children:e.jsx(D,{placeholder:"e.g., Single Visit, Pack of 5"})})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"duration_minutes",label:"Duration (minutes)",rules:[{required:!0,message:"Please enter duration"}],children:e.jsx(b,{min:1,style:{width:"100%"},placeholder:"e.g., 120 for 2 hours"})})})]}),e.jsx(o.Item,{name:"price",label:"Price (₹)",rules:[{required:!0,message:"Please enter price"}],children:e.jsx(b,{min:0,step:.01,style:{width:"100%"},placeholder:"e.g., 1000.00"})}),e.jsx(o.Item,{name:"description",label:"Description (Optional)",children:e.jsx(k,{rows:3,placeholder:"Describe what's included in this tier..."})}),e.jsxs(g,{gutter:16,children:[e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"is_popular",label:"Mark as Popular",valuePropName:"checked",children:e.jsx(y,{})})}),e.jsx(d,{span:12,children:e.jsx(o.Item,{name:"is_active",label:"Active",valuePropName:"checked",children:e.jsx(y,{})})})]}),e.jsx(o.Item,{name:"sort_order",label:"Sort Order",children:e.jsx(b,{min:0,style:{width:"100%"},placeholder:"Lower numbers appear first"})})]})})]})]})}export{mi as default};
