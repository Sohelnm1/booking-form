import{r as S,j as e,H as $,a as b}from"./app-CPGIdf66.js";import{A as D,R as k}from"./AdminLayout-B8Y-DD0S.js";import{F as t}from"./index-CmeEpjCY.js";import{C as H,T as J,B as x}from"./Logo-C5VDWex5.js";import{F as K}from"./Table-DHGJ6vyl.js";import{M as Q}from"./index-BHPqcyf2.js";import{I as u}from"./index-C78txZ5m.js";import{S as y}from"./index-BbU2uYPn.js";import{S as v}from"./CalendarOutlined-YTOqVM8w.js";import{R as F}from"./DeleteOutlined-BfYGLu7V.js";import{S as C}from"./index-y3F3xwDu.js";import{T as Y}from"./index-BmYLcQHs.js";import{T as o}from"./index-CjqFdU0W.js";import{R as P}from"./EditOutlined-BHAhMzYA.js";import{P as G}from"./index-BAa84Fm3.js";import{s as A}from"./index-CmI5py2r.js";/* empty css            */import"./index-B9cl6QOW.js";import"./PurePanel-CUrSghJ3.js";import"./move-mzGHPlV9.js";import"./LogoutOutlined-Bmhw5HJk.js";import"./UserOutlined-B95ctLO-.js";import"./ClockCircleOutlined-0V1XWKS2.js";import"./FileTextOutlined-09k9LAsj.js";import"./GiftOutlined-DfU1Lm2e.js";import"./SettingOutlined-tIu02gm6.js";import"./useForm-DFVLUtZ8.js";import"./row-Dy6vFv_G.js";import"./index-DbtxnYOi.js";import"./CheckCircleFilled-BZu22oMK.js";import"./InfoCircleFilled-5CKzh4TH.js";import"./pickAttrs-C99Lq9X0.js";import"./addEventListener-C5sHXDwt.js";import"./index-DB-YLNZl.js";import"./index-C6RbRrvz.js";import"./index-C_lKc-58.js";import"./useClosable-DenjQPEG.js";import"./index-BkBoFlCG.js";import"./Input-ClntIoea.js";import"./EyeOutlined-bhdB6agL.js";const{Title:W,Text:X}=J,{TextArea:Z}=u;function Me({auth:V,forms:I,services:E,extras:z,fieldTypes:w}){const[T,j]=S.useState(!1),[c,f]=S.useState(null),[m]=t.useForm(),g=I.find(r=>r.name==="Default Booking Form")||I[0],q=()=>{f(null),m.resetFields(),m.setFieldsValue({form_id:g?.id,type:"text",is_required:!1,is_primary:!1,sort_order:0,rendering_control:"services"}),j(!0)},O=r=>{const s=r.target.value.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");m.setFieldsValue({name:s})},N=r=>{if(r.is_primary){A.error("Primary fields (Name, Phone, Email) cannot be edited as they are required for all bookings.");return}f(r);let l=[];r.options&&Array.isArray(r.options)&&(l=r.options.map((s,i)=>({key:i,label:s.label||s,value:s.value||s}))),m.setFieldsValue({form_id:r.form_id,label:r.label,name:r.name,type:r.type,placeholder:r.placeholder,help_text:r.help_text,is_required:r.is_required,is_primary:r.is_primary,sort_order:r.sort_order,options:l,validation_rules:r.validation_rules||[],services:r.services?.map(s=>s.id)||[],extras:r.extras?.map(s=>s.id)||[],rendering_control:r.rendering_control||"services"}),j(!0)},L=r=>{O(r)},R=()=>{m.validateFields().then(r=>{let l=[];r.options&&Array.isArray(r.options)&&(l=r.options.map(i=>({label:i.label,value:i.value})));const s={form_id:r.form_id,label:r.label,name:r.name,type:r.type,placeholder:r.placeholder||"",help_text:r.help_text||"",is_required:r.is_required||!1,is_primary:r.is_primary||!1,sort_order:r.sort_order||0,options:l,validation_rules:r.validation_rules||[],services:r.services||[],extras:r.extras||[],rendering_control:r.rendering_control||"services"};c?b.put(route("admin.form-fields.update",c.id),s):b.post(route("admin.form-fields.store"),s),j(!1)})},B=()=>{j(!1),f(null),m.resetFields()},M=r=>{if(g?.fields?.find(s=>s.id===r)?.is_primary){A.error("Primary fields (Name, Phone, Email) cannot be deleted as they are required for all bookings.");return}b.post(route("admin.form-fields.delete",r))},U=[{title:"Label",dataIndex:"label",key:"label"},{title:"Type",dataIndex:"type",key:"type",render:r=>e.jsx(o,{color:"blue",children:w[r]||r})},{title:"Required",dataIndex:"is_required",key:"is_required",render:r=>e.jsx(o,{color:r?"red":"default",children:r?"Required":"Optional"})},{title:"Primary",dataIndex:"is_primary",key:"is_primary",render:r=>e.jsx(o,{color:r?"green":"default",children:r?"Primary":"Custom"})},{title:"Rendering Control",key:"rendering_control",render:(r,l)=>{const{rendering_control:s,services:i,extras:a,is_primary:_}=l;if(_)return e.jsx(o,{color:"green",size:"small",children:"All services"});switch(s){case"services":return!i||i.length===0?e.jsx(o,{color:"green",size:"small",children:"All services"}):e.jsxs("div",{children:[e.jsx(o,{color:"blue",size:"small",style:{marginBottom:4},children:"Services"}),i.slice(0,2).map((n,h)=>e.jsx(o,{color:"purple",size:"small",children:n.name},h)),i.length>2&&e.jsxs(o,{size:"small",children:["+",i.length-2," more"]})]});case"extras":return!a||a.length===0?e.jsx(o,{color:"orange",size:"small",children:"All extras"}):e.jsxs("div",{children:[e.jsx(o,{color:"orange",size:"small",style:{marginBottom:4},children:"Extras"}),a.slice(0,2).map((n,h)=>e.jsx(o,{color:"orange",size:"small",children:n.name},h)),a.length>2&&e.jsxs(o,{size:"small",children:["+",a.length-2," more"]})]});case"both":const p=[],d=[];return!i||i.length===0?p.push(e.jsx(o,{color:"green",size:"small",children:"All services"},"all-services")):(p.push(e.jsx(o,{color:"blue",size:"small",children:"Services"},"services-label")),i.slice(0,1).forEach((n,h)=>{p.push(e.jsx(o,{color:"purple",size:"small",children:n.name},`service-${h}`))}),i.length>1&&p.push(e.jsxs(o,{size:"small",children:["+",i.length-1," more"]},"services-more"))),!a||a.length===0?d.push(e.jsx(o,{color:"orange",size:"small",children:"All extras"},"all-extras")):(d.push(e.jsx(o,{color:"orange",size:"small",children:"Extras"},"extras-label")),a.slice(0,1).forEach((n,h)=>{d.push(e.jsx(o,{color:"orange",size:"small",children:n.name},`extra-${h}`))}),a.length>1&&d.push(e.jsxs(o,{size:"small",children:["+",a.length-1," more"]},"extras-more"))),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:4},children:p}),e.jsx("div",{children:d})]});default:return e.jsx(o,{color:"default",size:"small",children:"All services"})}}},{title:"Actions",key:"actions",render:(r,l)=>l.is_primary?e.jsxs(v,{children:[e.jsx(x,{type:"text",icon:e.jsx(P,{}),disabled:!0,title:"Primary fields cannot be edited"}),e.jsx(x,{type:"text",danger:!0,icon:e.jsx(F,{}),disabled:!0,title:"Primary fields cannot be deleted"})]}):e.jsxs(v,{children:[e.jsx(x,{type:"text",icon:e.jsx(P,{}),onClick:()=>N(l),title:"Edit Field"}),e.jsx(G,{title:"Are you sure you want to delete this field?",onConfirm:()=>M(l.id),okText:"Yes",cancelText:"No",children:e.jsx(x,{type:"text",danger:!0,icon:e.jsx(F,{}),title:"Delete Field"})})]})}];return e.jsxs(D,{children:[e.jsx($,{title:"Booking Form Fields"}),e.jsxs("div",{children:[e.jsxs(H,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(W,{level:3,style:{margin:0},children:"Booking Form Fields"}),e.jsx(x,{type:"primary",icon:e.jsx(k,{}),onClick:q,children:"Add Field"})]}),children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(X,{type:"secondary",children:"Manage the fields for the booking form. Primary fields (Name, Phone, Email) are shown for all services. Custom fields can be assigned to specific services."})}),e.jsx(K,{columns:U,dataSource:g?.fields||[],rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0}})]}),e.jsx(Q,{title:c?"Edit Field":"Add Field",open:T,onOk:R,onCancel:B,width:600,okText:c?"Update":"Create",cancelText:"Cancel",children:e.jsxs(t,{form:m,layout:"vertical",children:[e.jsx(t.Item,{name:"form_id",hidden:!0,children:e.jsx(u,{})}),e.jsx(t.Item,{name:"label",label:"Field Label",rules:[{required:!0,message:"Please enter field label"}],children:e.jsx(u,{placeholder:"Enter field label",onChange:L})}),e.jsx(t.Item,{name:"name",label:c?"Field Name":"Field Name (Auto-generated)",rules:[{required:!0,message:"Please enter field name"}],children:e.jsx(u,{placeholder:c?"Field name":"Field name will be auto-generated",disabled:!c})}),e.jsx(t.Item,{name:"type",label:"Field Type",rules:[{required:!0,message:"Please select field type"}],children:e.jsx(y,{placeholder:"Select field type",options:Object.entries(w).map(([r,l])=>({label:l,value:r}))})}),e.jsx(t.Item,{name:"placeholder",label:"Placeholder",children:e.jsx(u,{placeholder:"Enter placeholder text"})}),e.jsx(t.Item,{name:"help_text",label:"Help Text",children:e.jsx(Z,{rows:2,placeholder:"Enter help text"})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.type!==l.type,children:({getFieldValue:r})=>{const l=r("type");return["select","radio","checkbox"].includes(l)?e.jsx(t.Item,{name:"options",label:"Field Options",rules:[{required:!0,message:"Please add at least one option"}],children:e.jsx(t.List,{name:"options",children:(i,{add:a,remove:_})=>e.jsxs(e.Fragment,{children:[i.map(({key:p,name:d,...n})=>e.jsxs(v,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(t.Item,{...n,name:[d,"label"],rules:[{required:!0,message:"Please enter option label"}],children:e.jsx(u,{placeholder:"Option label",style:{width:200}})}),e.jsx(t.Item,{...n,name:[d,"value"],rules:[{required:!0,message:"Please enter option value"}],children:e.jsx(u,{placeholder:"Option value",style:{width:150}})}),e.jsx(x,{type:"text",danger:!0,onClick:()=>_(d),icon:e.jsx(F,{})})]},p)),e.jsx(t.Item,{children:e.jsx(x,{type:"dashed",onClick:()=>a(),block:!0,icon:e.jsx(k,{}),children:"Add Option"})})]})})}):null}}),e.jsx(t.Item,{name:"is_required",label:"Required",valuePropName:"checked",children:e.jsx(C,{})}),e.jsx(t.Item,{name:"is_primary",label:"Primary Field (Phone, Name, Email)",valuePropName:"checked",children:e.jsx(C,{})}),e.jsx(t.Item,{name:"sort_order",label:"Sort Order",children:e.jsx(Y,{min:0,placeholder:"Enter sort order",style:{width:"100%"}})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.is_primary!==l.is_primary,children:({getFieldValue:r})=>r("is_primary")?null:e.jsx(t.Item,{name:"rendering_control",label:"Field Rendering Control",children:e.jsxs(y,{placeholder:"Select rendering control",style:{width:"100%"},children:[e.jsx(Option,{value:"services",children:"Show based on Services"}),e.jsx(Option,{value:"extras",children:"Show based on Extras"}),e.jsx(Option,{value:"both",children:"Show based on Services AND Extras"})]})})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.is_primary!==l.is_primary||r.rendering_control!==l.rendering_control,children:({getFieldValue:r})=>{const l=r("is_primary"),s=r("rendering_control");return!l&&(s==="services"||s==="both")?e.jsx(t.Item,{name:"services",label:"Available for Services",children:e.jsx(y,{mode:"multiple",placeholder:"Select specific services (leave empty to show for ALL services)",allowClear:!0,style:{width:"100%"},children:E.map(i=>e.jsx(Option,{value:i.id,children:i.name},i.id))})}):null}}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.is_primary!==l.is_primary||r.rendering_control!==l.rendering_control,children:({getFieldValue:r})=>{const l=r("is_primary"),s=r("rendering_control");return!l&&(s==="extras"||s==="both")?e.jsx(t.Item,{name:"extras",label:"Available for Extras",children:e.jsx(y,{mode:"multiple",placeholder:"Select specific extras (leave empty to show for ALL extras)",allowClear:!0,style:{width:"100%"},children:z.map(i=>e.jsx(Option,{value:i.id,children:i.name},i.id))})}):null}})]})})]})]})}export{Me as default};
