import{r as p,j as e,H,a as f}from"./app-BA7by1EP.js";import{A as Y}from"./AdminLayout-C4wIse1L.js";import{F as c,I as D}from"./index-CGSh92UT.js";import{T as _,B as h,a as N,R as I,C as u}from"./SettingOutlined-Z3C5fP-7.js";import{R as J}from"./PlusOutlined-imxDIpvd.js";import{F as K,S as F}from"./Table-Wfepau0O.js";import{M as R,R as W}from"./EditOutlined-B_Wxalx8.js";import{T as x}from"./index-C2m6lP5V.js";import{T as X}from"./index-S90Po-GT.js";import{U as Z,R as ee}from"./InboxOutlined-DWATKMKT.js";import{S as se}from"./index-DHv4hztg.js";import{I as te}from"./index-Cf_sTmsP.js";import{S as ie}from"./index-DBoILsXb.js";import{R as oe}from"./EyeOutlined-CT3vUkmD.js";import{R as re}from"./DeleteOutlined-BK-DMYmT.js";import{s as d}from"./index-v6Rs4xIt.js";/* empty css            */import"./UserOutlined-CmmhnGCb.js";import"./index-U6fO8HFV.js";import"./CalendarOutlined-DTiTVZwL.js";import"./ClockCircleOutlined-DS4F1Odj.js";import"./Input-Bsa4J8jQ.js";import"./CheckCircleFilled-_KBAN88a.js";import"./EyeOutlined-DAC7kkoL.js";import"./pickAttrs-UXPnEPeG.js";import"./addEventListener-C4wz7XiZ.js";import"./progress-CCkJonHV.js";const{Title:le,Text:A}=_,{TextArea:ae}=D,{Option:B}=F;function Pe({auth:M,services:Q,categories:P,durations:k,errors:g,editService:j}){const[v,m]=p.useState(!1),[l,E]=p.useState(null),[r]=c.useForm(),[O,y]=p.useState(!1),[w,S]=p.useState(null),b=Q||[],U=P||[],C=k||[];p.useEffect(()=>{g&&Object.keys(g).length>0&&(Object.keys(g).forEach(s=>{r.setFields([{name:s,errors:[g[s]]}])}),m(!0))},[g,r]),p.useEffect(()=>{if(v)if(l){const s={name:l.name,description:l.description||"",price:parseFloat(l.price)||0,duration:parseInt(l.duration)||60,category:l.category||"Default",color:l.color||"#1890ff",is_active:l.is_active!==void 0?l.is_active:!0};setTimeout(()=>{r.setFieldsValue(s),console.log("Form values set via useEffect for editing:",s)},100)}else setTimeout(()=>{r.setFieldsValue({is_active:!0,color:"#1890ff",category:"Default",duration:60,description:""}),console.log("Default form values set via useEffect for adding")},100)},[v,l,r]),p.useEffect(()=>{if(j){const s=b.find(i=>i.id==j);s&&T(s)}},[j,b]);const V=[{title:"Image",dataIndex:"image",key:"image",render:(s,i)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(te,{width:40,height:40,src:s||`https://placehold.co/40x40/${i.color?.replace("#","")||"1890ff"}/ffffff?text=${i.name?.charAt(0)?.toUpperCase()||"S"}`,alt:i.name,style:{borderRadius:4},fallback:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMIAAADDCAYAAADQvc6UAAABRWlDQ1BJQ0MgUHJvZmlsZQAAKJFjYGASSSwoyGFhYGDIzSspCnJ3UoiIjFJgf8LAwSDCIMogwMCcmFxc4BgQ4ANUwgCjUcG3awyMIPqyLsis7PPOq3QdDFcvjV3jOD1boQVTPQrgSkktTgbSf4A4LbmgqISBgTEFyFYuLykAsTuAbJEioKOA7DkgdjqEvQHEToKwj4DVhAQ5A9k3gGyB5IxEoBmML4BsnSQk8XQkNtReEOBxcfXxUQg1Mjc0dyHgXNJBSWpFCYh2zi+oLMpMzyhRcASGUqqCZ16yno6CkYGRAQMDKMwhqj/fAIcloxgHQqxAjIHBEugw5sUIsSQpBobtQPdLciLEVJYzMPBHMDBsayhILEqEO4DxG0txmrERhM29nYGBddr//5/DGRjYNRkY/l7////39v///y4Dmn+LgeHANwDrkl1AuO+pmgAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAwqADAAQAAAABAAAAwwAAAAD9b/HnAAAHlklEQVR4Ae3dP3Ik1RnG4W+FgYxN"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold"},children:i.name}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:i.category})]})]})},{title:"Category",dataIndex:"category",key:"category",render:s=>e.jsx(x,{color:"blue",children:s})},{title:"Price",dataIndex:"price",key:"price",render:s=>`â‚¹${s}`},{title:"Duration",dataIndex:"duration",key:"duration",render:s=>{const i=C.find(o=>o.value===s);return i?i.label:`${s} min`}},{title:"Employees",dataIndex:"employees",key:"employees",render:()=>e.jsx("div",{style:{opacity:.5},children:e.jsx(x,{color:"orange",size:"small",children:"Coming Soon"})})},{title:"Status",dataIndex:"is_active",key:"is_active",render:s=>e.jsx(x,{color:s?"green":"red",children:s?"Active":"Inactive"})},{title:"Actions",key:"actions",render:(s,i)=>e.jsxs(ie,{children:[e.jsx(h,{type:"text",icon:e.jsx(oe,{}),size:"small",onClick:()=>q(i)}),e.jsx(h,{type:"text",icon:e.jsx(W,{}),size:"small",onClick:()=>T(i)}),e.jsx(h,{type:"text",icon:e.jsx(re,{}),size:"small",danger:!0,loading:w===i.id,disabled:w===i.id,onClick:()=>z(i)})]})}],L=()=>{E(null),r.resetFields(),r.setFields([]),m(!0)},T=s=>{E(s),r.setFields([]),r.resetFields(),console.log("Service data for editing:",s),m(!0)},q=s=>{f.visit(route("admin.services.show",s.id))},z=s=>{R.confirm({title:"Delete Service",content:e.jsxs("div",{children:[e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsxs("strong",{children:['"',s.name,'"']}),"?"]}),e.jsxs("p",{style:{color:"#ff4d4f",fontSize:"14px",marginTop:8},children:[e.jsx("strong",{children:"Warning:"})," This action cannot be undone and will permanently remove:"]}),e.jsxs("ul",{style:{color:"#666",fontSize:"14px",marginTop:4},children:[e.jsx("li",{children:"The service and all its data"}),e.jsx("li",{children:"Any associated bookings (if they exist)"}),e.jsx("li",{children:"Service images and files"})]})]}),okText:"Delete Service",okType:"danger",cancelText:"Cancel",width:500,onOk(){S(s.id),d.loading({content:"Deleting service...",key:"deleteService"}),console.log("Attempting to delete service:",s.id),console.log("Delete route:",route("admin.services.delete",s.id)),f.post(route("admin.services.delete",s.id),{onSuccess:()=>{console.log("Service deleted successfully"),d.success({content:`Service "${s.name}" deleted successfully`,key:"deleteService",duration:3}),S(null),f.visit(route("admin.services"),{replace:!0,preserveScroll:!1})},onError:i=>{console.error("Delete service errors:",i),d.error({content:"Failed to delete service. Please try again.",key:"deleteService",duration:5}),S(null)},onFinish:()=>{console.log("Delete request finished")}})}})},$=()=>{const s=r.getFieldsValue();console.log("Current form values before validation:",s);const i=r.getFieldValue("description");console.log("Description field value:",i),r.validateFields().then(o=>{y(!0),console.log("Form validation passed, values:",o);const n=new FormData;console.log("Form values:",o),Object.keys(o).forEach(t=>{if(console.log(`Processing field ${t}:`,o[t]),t!=="employees")if(t==="image"&&o[t]?.fileList?.[0]?.originFileObj)n.append("image",o[t].fileList[0].originFileObj);else if(t==="color")n.append("color",o[t]||"#1890ff");else if(t==="price"){const a=parseFloat(o[t])||0;n.append(t,a),console.log("Price value:",a)}else if(t==="duration"){const a=parseInt(o[t])||0;n.append(t,a),console.log("Duration value:",a)}else t==="is_active"?(n.append(t,o[t]?"1":"0"),console.log("is_active value:",o[t]?"1":"0")):t==="description"?(n.append(t,o[t]||""),console.log("Description value:",o[t]||"")):(n.append(t,o[t]||""),console.log(`${t} value:`,o[t]||""))}),console.log("=== FormData being sent to backend ===");for(let[t,a]of n.entries())console.log(`${t}:`,a);console.log("=== End FormData ==="),l?(n.append("_method","PUT"),f.post(route("admin.services.update",l.id),n,{onSuccess:()=>{d.success("Service updated successfully"),m(!1),r.resetFields()},onError:t=>{console.error("Update service errors:",t),t&&Object.keys(t).forEach(a=>{r.setFields([{name:a,errors:[t[a]]}])}),d.error("Failed to update service")},onFinish:()=>{y(!1)}})):f.post(route("admin.services.store"),n,{onSuccess:()=>{d.success("Service created successfully"),m(!1),r.resetFields()},onError:t=>{console.error("Create service errors:",t),t&&Object.keys(t).forEach(a=>{r.setFields([{name:a,errors:[t[a]]}])}),d.error("Failed to create service")},onFinish:()=>{y(!1)}})}).catch(o=>{console.error("Form validation failed:",o),d.error("Please check the form and try again")})},G=()=>{m(!1),r.resetFields()};return e.jsxs(Y,{auth:M,children:[e.jsx(H,{title:"Services Management"}),e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:24,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx(le,{level:2,style:{marginBottom:8},children:"Services"}),e.jsx(A,{type:"secondary",children:"Create and manage your services for customer bookings"})]}),e.jsx(h,{type:"primary",icon:e.jsx(J,{}),size:"large",onClick:L,children:"Create Service"})]}),e.jsx(N,{children:e.jsx(K,{columns:V,dataSource:b,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(s,i)=>`${i[0]}-${i[1]} of ${s} services`}})}),e.jsx(R,{title:l?"Edit Service":"Create Service",open:v,onOk:$,onCancel:G,width:800,okText:l?"Update":"Add Service",confirmLoading:O,children:e.jsxs(c,{form:r,layout:"vertical",children:[e.jsxs(I,{gutter:16,children:[e.jsx(u,{span:12,children:e.jsx(c.Item,{name:"name",label:"Service name*",rules:[{required:!0,message:"Please enter service name",whitespace:!0}],children:e.jsx(D,{placeholder:"Enter name"})})}),e.jsx(u,{span:12,children:e.jsx(c.Item,{name:"color",label:"Color",children:e.jsx(D,{type:"color",style:{width:"100%",height:"40px"}})})})]}),e.jsxs(I,{gutter:16,children:[e.jsx(u,{span:12,children:e.jsx(c.Item,{name:"category",label:"Category*",rules:[{required:!0,message:"Please select category"}],children:e.jsx(F,{placeholder:"Select category",children:U.map((s,i)=>e.jsx(B,{value:s,children:s},i))})})}),e.jsx(u,{span:12,children:e.jsx(c.Item,{label:"Employees",children:e.jsx("div",{style:{padding:"8px 12px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#f5f5f5",color:"#999",cursor:"not-allowed"},children:e.jsxs(A,{type:"secondary",children:[e.jsx(x,{color:"orange",children:"Coming Soon"})," ","Employee assignment will be available soon"]})})})})]}),e.jsx(c.Item,{name:"description",label:"Description",children:e.jsx(ae,{rows:4,placeholder:"Insert text here ...",style:{minHeight:100}})}),e.jsx(A,{type:"secondary",style:{fontSize:"12px",marginTop:4,marginBottom:16},children:"Descriptions appear on your booking page."}),e.jsxs(I,{gutter:16,children:[e.jsxs(u,{span:12,children:[e.jsx(c.Item,{name:"duration",label:"Duration*",rules:[{required:!0,message:"Please select duration"}],children:e.jsx(F,{placeholder:"Select duration",children:C.map(s=>e.jsx(B,{value:s.value,children:s.label},s.value))})}),e.jsxs(A,{type:"secondary",style:{fontSize:"12px",marginTop:4},children:["If you need a different duration that isn't among the displayed ones, please visit our"," ",e.jsx("a",{href:"#",style:{color:"#1890ff"},children:"General Settings"})," ","and change Default Time Slot Step."]})]}),e.jsx(u,{span:12,children:e.jsx(c.Item,{name:"price",label:"Price*",rules:[{required:!0,message:"Please enter price"},{type:"number",min:0,message:"Price must be a positive number"}],children:e.jsx(X,{style:{width:"100%"},placeholder:"0.00",min:0,step:.01,formatter:s=>`â‚¹ ${s}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),parser:s=>s.replace(/â‚¹\s?|(,*)/g,"")})})})]}),e.jsx(c.Item,{name:"image",label:"Service image",children:e.jsxs(Z.Dragger,{name:"file",multiple:!1,beforeUpload:()=>!1,showUploadList:!0,accept:"image/*",maxCount:1,fileList:[],children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(ee,{})}),e.jsx("p",{className:"ant-upload-text",children:"Drag and drop or choose from files"})]})}),e.jsx(c.Item,{name:"is_active",label:"Active",valuePropName:"checked",children:e.jsx(se,{})})]})})]})]})}export{Pe as default};
