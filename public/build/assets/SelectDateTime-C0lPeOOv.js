import{r as k,j as t,H as ot,a as q}from"./app-DM8mHM6T.js";import{d as b}from"./dayjs.min-C5vpXjSe.js";import{B as nt}from"./BookingHeader-CTH1qbpX.js";import{a9 as st,T as it,C,B as _}from"./Logo-BtQWxE8e.js";import{P as rt}from"./progress-x-Z8BGbs.js";import{R as H,C as I}from"./row-DZZA-w4e.js";import{R as at}from"./CalendarOutlined-Drq1mFbB.js";import{R as lt}from"./ClockCircleOutlined-BZq8M5LK.js";import{S as dt}from"./index-C2u7ABHH.js";import{E as F}from"./index-BGLt6gSa.js";import{R as ct}from"./CheckOutlined-Ck8jOq_J.js";import{T as mt}from"./index-afnbUcZ0.js";import{D as B}from"./index-C0Sossdu.js";import{R as pt}from"./ArrowLeftOutlined-BqnizSMc.js";import{R as ft}from"./ArrowRightOutlined-Drh9tARo.js";/* empty css            */import"./CustomerLoginModal-CpIS-3fk.js";import"./index-BZvJRm4C.js";import"./CheckCircleFilled-KckMlIoE.js";import"./InfoCircleFilled-DFS2Ja07.js";import"./pickAttrs-Bc1XmkZK.js";import"./useClosable-CILIJ6OR.js";import"./extendsObject-78o_rR5W.js";import"./PurePanel-BcquoL0T.js";import"./PhoneOutlined-BkUSxdpB.js";import"./LockOutlined-DTdB5Y5r.js";import"./index-D5GqZUJv.js";import"./Input-BpbqI2go.js";import"./EyeOutlined-BaSjPXUK.js";import"./EyeOutlined-Bmd706kk.js";import"./index-BXRzC7yq.js";import"./index-BqIB-K8V.js";import"./index-BLuLJRHE.js";import"./LogoutOutlined-D2XJGWQ6.js";import"./BookOutlined-DtJCWtTV.js";const{Title:Y,Text:l}=it;function Pt({service:m,selectedExtras:f,scheduleSettings:p,selectedPricingTier:i,selectedDuration:ut,selectedPrice:yt,auth:L}){const[y,O]=k.useState(null),[h,R]=k.useState(null),[T,w]=k.useState([]),[J,z]=k.useState(!1),[D,A]=k.useState(b());console.log("SelectDateTime component - Schedule settings:",{scheduleSettings:p,scheduleSettingsLength:p?.length,firstSchedule:p?.[0]});const Q=(i?i.duration_minutes:m.duration)+f.reduce((e,o)=>{const s=o.quantity||1;if(o.durationRelation){const n=o.durationRelation.hours*60+o.durationRelation.minutes;return e+n*s}return e+(o.total_duration||0)*s},0),E=()=>{const e=f.map(n=>n.id),o=f.map(n=>({id:n.id,quantity:n.quantity||1})),s=encodeURIComponent(JSON.stringify(o));q.visit(route("booking.select-extras"),{data:{service_id:m.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||m.duration,selected_price:i?.price||m.price,extras:e,extra_quantities_json:s}})},U=()=>{if(y&&h){const e=f.map(n=>n.id),o=f.map(n=>({id:n.id,quantity:n.quantity||1})),s=encodeURIComponent(JSON.stringify(o));q.visit(route("booking.consent"),{data:{service_id:m.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||m.duration,selected_price:i?.price||m.price,extras:e,extra_quantities_json:s,date:y.format("YYYY-MM-DD"),time:h.format("HH:mm")}})}},G=async e=>{z(!0);try{console.log("Fetching slots for date:",e.format("YYYY-MM-DD")),console.log("Service ID:",m.id),console.log("Service duration:",m.duration),console.log("Selected extras:",f),console.log("Total duration:",Q);const o=new URLSearchParams({date:e.format("YYYY-MM-DD"),service_id:m.id});i&&(o.append("pricing_tier_id",i.id),o.append("selected_duration",i.duration_minutes),o.append("selected_price",i.price)),f.length>0&&f.forEach(r=>{o.append("extras[]",r.id)}),console.log("Normal booking - Request params:",o.toString()),console.log("Normal booking - Selected extras:",f);const n=await(await fetch(`${route("booking.available-slots")}?${o.toString()}`)).json();console.log("Available slots response:",n),n.slots&&n.slots.length>0?w(n.slots):(console.log("No slots returned from backend"),w([]))}catch(o){console.error("Error fetching slots:",o),w([])}finally{z(!1)}},V=e=>{O(e),R(null),G(e)},K=e=>{R(e)},M=e=>`â‚¹${parseFloat(e).toFixed(2)}`,N=e=>{if(e<60)return`${e} min`;{const o=Math.floor(e/60),s=e%60;return s>0?`${o}h ${s}m`:`${o}h`}},$=e=>{try{if(!e)return console.error("Time is null or undefined"),"Invalid Time";let o=e;if(e&&typeof e=="object"&&e.format?o=e.format("HH:mm"):typeof e=="object"&&e.start&&(o=e.start),!o||typeof o!="string")return console.error("Invalid time format:",e),"Invalid Time";const s=o.match(/^(\d{1,2}):(\d{2})$/);if(!s)return console.error("Invalid time string format:",o),"Invalid Time";const n=parseInt(s[1],10),r=parseInt(s[2],10);if(n<0||n>23||r<0||r>59)return console.error("Invalid time values:",n,r),"Invalid Time";const c=n>=12?"PM":"AM",u=n===0?12:n>12?n-12:n,a=r.toString().padStart(2,"0");return`${u}:${a} ${c}`}catch(o){return console.error("Error formatting time:",o,e),"Invalid Time"}},X=e=>{const o=e.year(),s=e.month(),n=b(new Date(o,s,1)),r=b(new Date(o,s+1,0)),c=n.startOf("week"),u=r.endOf("week"),a=[];let d=c;for(;d.isBefore(u)||d.isSame(u,"day");)a.push(d),d=d.add(1,"day");return a},Z=()=>{A(D.subtract(1,"month"))},P=()=>{A(D.add(1,"month"))},tt=e=>{const o=b(),s=p?.[0];if(!s)return!1;const n=s.min_advance_hours,r=s.max_advance_days,c=s.working_days,u=o.add(n,"hour"),a=o.add(r,"day"),d=e.isSame(o,"day"),v=d||e.isAfter(u)&&(e.isBefore(a)||e.isSame(a,"day")),x=e.day(),S=x===0?7:x,j=c.includes(S),g=v&&j;return(e.isSame(o,"day")||e.format("YYYY-MM-DD")==="2025-08-18")&&console.log("Date selectability check:",{date:e.format("YYYY-MM-DD"),isToday:d,isWithinRange:v,isWorkingDay:j,isSelectable:g,minAdvanceHours:n,maxAdvanceDays:r,workingDays:c,adjustedDayOfWeek:S,minDate:u.format("YYYY-MM-DD"),maxDate:a.format("YYYY-MM-DD"),scheduleSettings:p,defaultSchedule:s}),g};return t.jsxs("div",{children:[t.jsx(ot,{title:"Select Date & Time - Book Appointment"}),t.jsx(nt,{auth:L}),t.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[t.jsx("div",{className:"mobile-top-spacing"}),t.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[t.jsx(st,{variant:"primary",color:"color",background:"white",size:"large"}),t.jsx(Y,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),t.jsx(l,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),p&&p.length>0&&t.jsx("div",{style:{marginTop:8},children:t.jsxs(l,{type:"secondary",style:{fontSize:"12px"},children:["ðŸ“… Booking window:"," ",p[0].booking_window_days," days ahead â€¢ â° Min advance:"," ",p[0].min_advance_hours," hours â€¢ ðŸ• Working hours:"," ",p[0].start_time," -"," ",p[0].end_time," â€¢ ðŸ“† Working days: ",p[0].working_days_text]})})]}),t.jsxs("div",{style:{marginBottom:32},children:[t.jsx(rt,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),t.jsx("div",{style:{textAlign:"center",marginTop:8},children:t.jsx(l,{type:"secondary",children:"Step 3 of 5"})})]}),t.jsxs(H,{gutter:[32,32],children:[t.jsxs(I,{xs:24,lg:16,children:[t.jsxs(C,{style:{marginBottom:24},children:[t.jsxs(Y,{level:4,style:{marginBottom:16},children:[t.jsx(at,{style:{marginRight:8}}),"Select Date"]}),t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(_,{size:"small",onClick:Z,style:{border:"none",boxShadow:"none"},children:"â€¹"}),t.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:D.format("MMMM YYYY")}),t.jsx(_,{size:"small",onClick:P,style:{border:"none",boxShadow:"none"},children:"â€º"})]}),t.jsxs("div",{style:{padding:"16px"},children:[t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>t.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:e},e))}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:X(D).map((e,o)=>{const s=b(),n=e.isBefore(s,"day"),r=e.isSame(s,"day"),c=y&&y.isSame(e,"day"),u=e.month()===D.month(),a=tt(e),d={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:a&&!n?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:u?1:.3};let v="transparent",x="#333",S="1px solid transparent";n?x="#999":c?(v="#e6f7ff",x="#1890ff",S="2px solid #1890ff"):r&&!y?(v="#1890ff",x="white",S="none"):a?x="#333":x="#999";let j="";if(n)j="Past date - cannot be selected";else if(a)j=`Available for booking on ${e.format("dddd, MMMM D")}`;else{const g=e.day(),et=g===0?7:g,W=p?.[0]?.working_days;W&&!W.includes(et)?j=`${e.format("dddd")} - Not a working day`:j="Date not available for booking"}return t.jsxs("div",{style:{...d,backgroundColor:v,color:x,border:S},title:j,onMouseEnter:g=>{a&&!n&&!c&&(g.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:g=>{a&&!n&&!c&&(g.currentTarget.style.backgroundColor="transparent")},onClick:()=>{a&&!n&&V(e)},children:[e.date(),r&&t.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},o)})})]})]})]}),y&&t.jsxs(C,{children:[t.jsxs(Y,{level:4,style:{marginBottom:16},children:[t.jsx(lt,{style:{marginRight:8}}),"Available Time Slots"]}),J?t.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[t.jsx(dt,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:t.jsx(l,{type:"secondary",children:"Loading available slots..."})})]}):T.length===0?t.jsx(F,{description:"No available slots for this date",image:F.PRESENTED_IMAGE_SIMPLE}):t.jsx(H,{gutter:[12,12],children:T.map((e,o)=>{const s=typeof e=="object"?e.start:e;if(!s||typeof s!="string")return console.error("Invalid slot start time:",s,"for slot:",e),null;const n=s.split(":");if(n.length!==2)return console.error("Invalid time format:",s),null;const r=parseInt(n[0],10),c=parseInt(n[1],10);if(isNaN(r)||isNaN(c)||r<0||r>23||c<0||c>59)return console.error("Invalid time values:",r,c,"for slot:",s),null;const u=b().hour(r).minute(c).second(0).millisecond(0),a=h&&h.format("HH:mm")===s,d=typeof e=="object"?e.available!==!1:!0;return t.jsx(I,{xs:12,sm:8,md:6,children:t.jsx(_,{size:"large",disabled:!d,style:{width:"100%",height:48,border:a?"2px solid #1890ff":d?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:a?"#e6f7ff":d?"white":"#fff2f0",opacity:d?1:.6},onClick:()=>d&&K(u),children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[a&&t.jsx(ct,{style:{marginRight:8,color:"#1890ff"}}),$(s)]}),!d&&t.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},o)}).filter(Boolean)})]})]}),t.jsx(I,{xs:24,lg:8,children:t.jsxs(C,{style:{position:"sticky",top:24},children:[t.jsx(Y,{level:4,style:{marginBottom:16},children:"Booking Summary"}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsxs(l,{strong:!0,children:[m.name,i&&t.jsx(mt,{color:"blue",style:{marginLeft:8,fontSize:10},children:i.name})]}),t.jsx(l,{children:M(i?i.price:m.price)})]}),t.jsx(l,{type:"secondary",style:{fontSize:12},children:i?N(i.duration_minutes):m.duration_label||N(m.duration)})]}),f.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(B,{style:{margin:"12px 0"}}),f.map(e=>{const o=e.quantity||1;return t.jsxs("div",{style:{marginBottom:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(l,{children:["+ ",e.name,o>1&&t.jsxs(l,{type:"secondary",style:{fontSize:12},children:[" ","Ã— ",o]})]}),t.jsx(l,{children:M(parseFloat(e.price)*o)})]}),t.jsxs(l,{type:"secondary",style:{fontSize:12},children:[e.duration_relation?e.duration_relation.label:"No additional time",o>1&&t.jsxs(l,{type:"secondary",style:{fontSize:12},children:[" ","Ã— ",o]})]})]},e.id)})]}),t.jsx(B,{style:{margin:"16px 0"}}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx(l,{strong:!0,children:"Total Price"}),t.jsx(l,{strong:!0,style:{fontSize:16},children:M(parseFloat(i?i.price:m.price)+f.reduce((e,o)=>{const s=o.quantity||1;return e+parseFloat(o.price)*s},0))})]}),(y||h)&&t.jsxs(t.Fragment,{children:[t.jsx(B,{style:{margin:"16px 0"}}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx(l,{type:"secondary",children:"Selected Date"}),t.jsx("div",{children:t.jsx(l,{strong:!0,children:y?y.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),t.jsxs("div",{children:[t.jsx(l,{type:"secondary",children:"Selected Time"}),t.jsx("div",{children:t.jsx(l,{strong:!0,children:h&&h.isValid()?$(h):"Not selected"})})]})]}),t.jsxs("div",{style:{marginTop:24},children:[t.jsx(_,{block:!0,style:{marginBottom:12},icon:t.jsx(pt,{}),onClick:E,children:"Back to Extras"}),t.jsx(_,{type:"primary",block:!0,size:"large",icon:t.jsx(ft,{}),onClick:U,disabled:!y||!h,children:"Continue to Consent"})]})]})})]})]})]})}export{Pt as default};
