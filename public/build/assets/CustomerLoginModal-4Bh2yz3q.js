import{r as i,j as t}from"./app-CPGIdf66.js";import{M as S}from"./index-BHPqcyf2.js";import{I as g}from"./index-C78txZ5m.js";import{B as u}from"./Logo-C5VDWex5.js";import{s as r}from"./index-CmI5py2r.js";function w({isVisible:O,onClose:p,onSuccess:h}){const[n,d]=i.useState(""),[a,l]=i.useState(""),[m,c]=i.useState(!1),[f,s]=i.useState(!1),[y,T]=i.useState(""),x=async()=>{if(!n||n.length<10){r.error("Please enter a valid phone number");return}try{s(!0);const e=await fetch(route("booking.send-otp"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({phone_number:n})}),o=await e.json();e.ok?(r.success("OTP sent successfully to your phone number"),c(!0),o.otp&&T(o.otp)):r.error(o.error||"Failed to send OTP")}catch(e){console.error("Error sending OTP:",e),r.error("Failed to send OTP")}finally{s(!1)}},j=async()=>{if(!a||a.length!==6){r.error("Please enter a valid 6-digit OTP");return}try{s(!0);const e=await fetch(route("customer.login"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({phone_number:n,otp:a})}),o=await e.json();e.ok?(r.success("Login successful!"),c(!1),l(""),d(""),h&&h(o.user),p(),window.location.reload()):r.error(o.error||"Invalid OTP")}catch(e){console.error("Error verifying OTP:",e),r.error("Failed to verify OTP")}finally{s(!1)}},P=()=>{c(!1),l(""),d(""),s(!1),p()};return t.jsx(S,{title:"Customer Login",open:O,onCancel:P,footer:null,width:480,centered:!0,children:t.jsxs("div",{style:{textAlign:"center"},children:[t.jsx("div",{style:{marginBottom:32},children:t.jsx("p",{style:{fontSize:16,color:"#666"},children:m?"Enter the 6-digit OTP sent to your phone":"Enter your phone number to receive an OTP"})}),m?t.jsxs("div",{children:[t.jsx(g,{size:"large",placeholder:"Enter 6-digit OTP",value:a,onChange:e=>l(e.target.value),style:{marginBottom:16},maxLength:6}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsx(u,{type:"default",size:"large",onClick:()=>{c(!1),l("")},style:{marginRight:8},children:"Back"}),t.jsx(u,{type:"primary",size:"large",onClick:j,loading:f,children:"Verify OTP"})]}),y&&t.jsxs("p",{style:{fontSize:12,color:"#999"},children:["Test OTP: ",y]})]}):t.jsxs("div",{children:[t.jsx(g,{size:"large",placeholder:"Enter your phone number",value:n,onChange:e=>d(e.target.value),style:{marginBottom:16},maxLength:10}),t.jsx(u,{type:"primary",size:"large",onClick:x,loading:f,style:{width:"100%"},children:"Send OTP"})]})]})})}export{w as C};
