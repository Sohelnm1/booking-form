import{r as i,j as e,H as ae}from"./app-CjLSFTvF.js";import{A as re}from"./AdminLayout-CaACskhm.js";import{C as ie}from"./CancelModal-dUSJe_6O.js";import{R as oe,u as ce,t as de}from"./timezone-Bg3xXcl_.js";import{d as _}from"./dayjs.min-BGN71OSw.js";import{I as me,C as y,T as ue,B as u}from"./Logo-DLy9Pi-u.js";import{S as r}from"./index-Cz--6uym.js";import{R as pe,C as w}from"./row-CQ454HWN.js";import{I as he}from"./index-D0ij-sgg.js";import{R as xe}from"./SearchOutlined-CMjNe8x3.js";import{S as L}from"./index-Dc7Stc7a.js";import{D as fe}from"./index-CICymlMJ.js";import{F as je}from"./Table-7REDeCqW.js";import{M as _e}from"./index-BFDovZzk.js";import{D as l}from"./index-B-DCaxHt.js";import{D as f}from"./index-Czbv6qhl.js";import{B as c}from"./index-BdeOgk2e.js";import{R as ye}from"./CheckCircleOutlined-C-7EDMiG.js";import{R as ge,a as ve}from"./PrinterOutlined-CrkJaTjD.js";import{s as P}from"./index-BdNhniXG.js";import{R as be}from"./UserOutlined-BTlIJHQK.js";import{R as Ce}from"./MailOutlined-BmieC3hh.js";import{R as Re}from"./PhoneOutlined-DCAGKc-b.js";import{R as Ie}from"./CalendarOutlined-C51-_ebW.js";import{R as Se}from"./ClockCircleOutlined-B5klXXHM.js";import{T as we}from"./index-YgNiGMGF.js";import{R as ze}from"./EyeOutlined-C1FdwiFg.js";import{R as ke}from"./CloseCircleOutlined-C6LZGqJL.js";/* empty css            */import"./index-CgCFGhN9.js";import"./index-DczFaLwX.js";import"./PurePanel-Ctdvl-zP.js";import"./move-BHpooOi0.js";import"./LogoutOutlined-Di16fjZE.js";import"./DollarOutlined-CnvFJIap.js";import"./FileTextOutlined-CosqdZ2W.js";import"./GiftOutlined-CqMUofQ6.js";import"./SettingOutlined-CjjuPnIM.js";import"./index-BhQBVMnT.js";import"./useForm-DYbDyyqO.js";import"./CheckCircleFilled-Dt1Auu-O.js";import"./InfoCircleFilled-D_PNQDwx.js";import"./index-DVTfiP3p.js";import"./pickAttrs-D4RZEvRE.js";import"./ExclamationCircleOutlined-B0G8IDio.js";import"./index-BV1LEswr.js";import"./Input-DRyzWO36.js";import"./EyeOutlined-FpwRxIr8.js";import"./EyeOutlined-Bmd706kk.js";import"./index-_UDQvjMi.js";import"./addEventListener-Dkb8_L8w.js";import"./index-KNdCQ6Gc.js";import"./index-CdVV1a5r.js";import"./useClosable-C1CguS7l.js";import"./DownloadOutlined-DTidZHln.js";var De={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"};function z(){return z=Object.assign?Object.assign.bind():function(p){for(var d=1;d<arguments.length;d++){var t=arguments[d];for(var h in t)Object.prototype.hasOwnProperty.call(t,h)&&(p[h]=t[h])}return p},z.apply(this,arguments)}const Ae=(p,d)=>i.createElement(me,z({},p,{ref:d,icon:De})),Me=i.forwardRef(Ae);_.extend(ce);_.extend(de);const{Title:g,Text:a}=ue,{Option:j}=L,{Search:Fe}=he;function Bt({auth:p,bookings:d}){const[t,h]=i.useState(null),[$,k]=i.useState(!1),[E,v]=i.useState(!1),[V,b]=i.useState(null),[N,C]=i.useState(!1),[Y,R]=i.useState(null),[x,O]=i.useState(""),[I,H]=i.useState("all"),[S,K]=i.useState(null),U=n=>{h(n),k(!0)},D=()=>{k(!1),h(null)},A=n=>{window.open(`/admin/appointments/${n}/pdf`,"_blank")},G=()=>{window.open("/admin/appointments/export-excel","_blank")},J=n=>{b(n),v(!0)},Q=n=>{v(!1),b(null),P.success("Booking cancelled successfully"),window.location.reload()},q=()=>{v(!1),b(null)},W=n=>{R(n),C(!0)},X=n=>{C(!1),R(null),P.success("Refund processed successfully"),window.location.reload()},Z=()=>{C(!1),R(null)},M=n=>{switch(n){case"confirmed":return"success";case"pending":return"warning";case"completed":return"processing";case"cancelled":return"error";case"no_show":return"default";default:return"default"}},F=n=>{switch(n){case"paid":return"success";case"pending":return"warning";case"failed":return"error";case"refunded":return"default";default:return"default"}},T=n=>{switch(n){case"pending":return"warning";case"processed":return"success";case"failed":return"error";case"not_applicable":return"default";default:return"default"}},ee=n=>_(n).tz("Asia/Kolkata").format("h:mm A"),te=n=>_(n).tz("Asia/Kolkata").format("MMM DD, YYYY"),m=n=>_(n).tz("Asia/Kolkata").format("MMM DD, YYYY h:mm A"),se=n=>{const s=n.form_field;if(!s)return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(a,{strong:!0,style:{fontSize:"12px",color:"#666"},children:["Unknown Field (ID: ",n.form_field_id,"):"]}),e.jsx("br",{}),e.jsx(a,{children:n.response_value||"Not provided"})]},n.id);const o=n.formatted_value||n.response_value;return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(a,{strong:!0,style:{fontSize:"12px",color:"#666"},children:[s.label,":"]}),e.jsx("br",{}),e.jsx(a,{children:o||"Not provided"})]},n.id)},B=d.filter(n=>{const s=x===""||n.customer.name.toLowerCase().includes(x.toLowerCase())||n.customer.email.toLowerCase().includes(x.toLowerCase())||n.service.name.toLowerCase().includes(x.toLowerCase())||n.employee.name.toLowerCase().includes(x.toLowerCase()),o=I==="all"||n.status===I,le=!S||_(n.appointment_time).tz("Asia/Kolkata").isSame(S,"day");return s&&o&&le}),ne=[{title:"Customer",key:"customer",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs(r,{children:[e.jsx(be,{}),e.jsx(a,{strong:!0,children:s.customer.name})]}),e.jsxs(r,{children:[e.jsx(Ce,{}),e.jsx(a,{copyable:!0,style:{fontSize:"12px"},children:s.customer.email})]}),e.jsxs(r,{children:[e.jsx(Re,{}),e.jsx(a,{copyable:!0,style:{fontSize:"12px"},children:s.customer.phone_number})]})]})},{title:"Service & Employee",key:"service",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs("div",{children:[e.jsx(a,{strong:!0,children:s.service.name}),e.jsx("br",{}),e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:[s.service.duration," min • ₹",s.service.price]})]}),e.jsx("div",{children:e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Assigned to: ",s.employee.name,e.jsx(c,{status:s.employee.is_active?"success":"error",text:s.employee.is_active?"Active":"Inactive",style:{marginLeft:4,fontSize:"10px"}})]})})]})},{title:"Appointment",key:"appointment",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs(r,{children:[e.jsx(Ie,{}),e.jsx(a,{children:te(s.appointment_time)})]}),e.jsxs(r,{children:[e.jsx(Se,{}),e.jsx(a,{children:ee(s.appointment_time)})]}),e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Duration: ",s.duration," min"]})]})},{title:"Extras",key:"extras",render:(n,s)=>e.jsx("div",{children:s.extras&&s.extras.length>0?s.extras.map(o=>e.jsxs(we,{color:"blue",style:{marginBottom:4},children:[o.name," (₹",o.pivot.price,")"]},o.id)):e.jsx(a,{type:"secondary",style:{fontSize:"12px"},children:"No extras"})})},{title:"Total & Status",key:"total",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsxs(r,{children:[e.jsx(a,{strong:!0,style:{color:"#1890ff"},children:"₹"}),e.jsxs(a,{strong:!0,children:["₹",s.total_amount]})]}),e.jsx(r,{children:e.jsx(c,{status:M(s.status),text:s.status_text||s.status})}),e.jsx(r,{children:e.jsx(c,{status:F(s.payment_status),text:s.payment_status_text||s.payment_status})}),s.status==="cancelled"&&s.refund_amount>0&&e.jsx(r,{children:e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Refund: ₹",s.refund_amount]})}),s.status==="cancelled"&&s.refund_status&&e.jsx(r,{children:e.jsx(c,{status:T(s.refund_status),text:s.refund_status_text||s.refund_status})}),s.reschedule_attempts>0&&e.jsx(r,{children:e.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["Rescheduled: ",s.reschedule_attempts," ","time(s)"]})})]})},{title:"Actions",key:"actions",render:(n,s)=>e.jsxs(r,{direction:"vertical",size:"small",children:[e.jsx(u,{type:"primary",icon:e.jsx(ze,{}),size:"small",onClick:()=>U(s),style:{width:"100%"},children:"View Details"}),e.jsx(u,{type:"default",icon:e.jsx(ve,{}),size:"small",onClick:()=>A(s.id),style:{width:"100%"},children:"Download PDF"}),(s.status==="pending"||s.status==="confirmed")&&e.jsx(u,{type:"default",danger:!0,icon:e.jsx(ke,{}),size:"small",onClick:()=>J(s),style:{width:"100%"},children:"Cancel"}),s.status==="cancelled"&&s.refund_status==="pending"&&s.payment_status==="paid"&&e.jsx(u,{type:"default",style:{width:"100%",backgroundColor:"#52c41a",color:"white",borderColor:"#52c41a"},size:"small",onClick:()=>W(s),children:"Process Refund"})]})}];return e.jsxs(re,{auth:p,children:[e.jsx(ae,{title:"Appointments"}),e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(y,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24},children:[e.jsx(g,{level:2,style:{margin:0},children:"Appointments"}),e.jsxs(r,{children:[e.jsx(u,{type:"primary",icon:e.jsx(Me,{}),onClick:G,style:{marginRight:8},children:"Export to Excel"}),e.jsxs(a,{type:"secondary",children:["Total: ",B.length," bookings"]})]})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(pe,{gutter:16,children:[e.jsx(w,{span:8,children:e.jsx(Fe,{placeholder:"Search by customer, service, or employee",allowClear:!0,value:x,onChange:n=>O(n.target.value),prefix:e.jsx(xe,{})})}),e.jsx(w,{span:4,children:e.jsxs(L,{placeholder:"Status",value:I,onChange:H,style:{width:"100%"},children:[e.jsx(j,{value:"all",children:"All Status"}),e.jsx(j,{value:"pending",children:"Pending"}),e.jsx(j,{value:"confirmed",children:"Confirmed"}),e.jsx(j,{value:"completed",children:"Completed"}),e.jsx(j,{value:"cancelled",children:"Cancelled"}),e.jsx(j,{value:"no_show",children:"No Show"})]})}),e.jsx(w,{span:4,children:e.jsx(fe,{placeholder:"Filter by date",value:S,onChange:K,style:{width:"100%"},allowClear:!0})})]})}),e.jsx(je,{columns:ne,dataSource:B,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(n,s)=>`${s[0]}-${s[1]} of ${n} appointments`}})]}),e.jsx(_e,{title:"Booking Details",open:$,onCancel:D,footer:[e.jsx(u,{icon:e.jsx(ge,{}),onClick:()=>A(t.id),children:"Print PDF"},"print"),e.jsx(u,{onClick:D,children:"Close"},"close")],width:800,children:t&&e.jsxs("div",{children:[e.jsxs(l,{title:"Customer Information",bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Name",span:2,children:t.customer.name}),e.jsx(l.Item,{label:"Email",span:2,children:t.customer.email}),e.jsx(l.Item,{label:"Phone",span:2,children:t.customer.phone_number})]}),e.jsx(f,{}),e.jsxs(l,{title:"Booking Information",bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Service",children:t.service.name}),e.jsxs(l.Item,{label:"Employee",children:[t.employee.name,e.jsx(c,{status:t.employee.is_active?"success":"error",text:t.employee.is_active?"Active":"Inactive",style:{marginLeft:8}})]}),e.jsx(l.Item,{label:"Date & Time",children:m(t.appointment_time)}),e.jsxs(l.Item,{label:"Duration",children:[t.duration," minutes"]}),e.jsx(l.Item,{label:"Status",children:e.jsx(c,{status:M(t.status),text:t.status_text||t.status})}),e.jsx(l.Item,{label:"Payment Status",children:e.jsx(c,{status:F(t.payment_status),text:t.payment_status_text||t.payment_status})}),e.jsx(l.Item,{label:"Total Amount",span:2,children:e.jsxs(a,{strong:!0,style:{fontSize:"16px"},children:["₹",t.total_amount]})}),t.reschedule_attempts>0&&e.jsxs(l.Item,{label:"Reschedule Attempts",children:[t.reschedule_attempts," ","time(s)"]}),t.rescheduled_at&&e.jsx(l.Item,{label:"Last Rescheduled",children:m(t.rescheduled_at)})]}),e.jsx(f,{}),t.extras&&t.extras.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(l,{title:"Selected Extras",bordered:!0,size:"small",children:t.extras.map(n=>e.jsx(l.Item,{label:n.name,children:e.jsxs("div",{children:[e.jsxs("div",{children:["₹",n.pivot.price]}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:n.durationRelation?n.durationRelation.label:"No additional time"})]})},n.id))}),e.jsx(f,{})]}),t.status==="cancelled"&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs(l,{title:"Refund Information",bordered:!0,size:"small",children:[e.jsx(l.Item,{label:"Refund Status",children:e.jsx(c,{status:T(t.refund_status),text:t.refund_status_text||t.refund_status})}),t.refund_amount>0&&e.jsx(l.Item,{label:"Refund Amount",children:e.jsxs(a,{strong:!0,style:{color:"#52c41a",fontSize:"16px"},children:["₹",t.refund_amount]})}),t.cancellation_fee_charged>0&&e.jsx(l.Item,{label:"Cancellation Fee",children:e.jsxs(a,{strong:!0,style:{color:"#ff4d4f",fontSize:"16px"},children:["₹",t.cancellation_fee_charged]})}),t.refund_transaction_id&&e.jsx(l.Item,{label:"Refund Transaction ID",children:e.jsx(a,{copyable:!0,children:t.refund_transaction_id})}),t.refund_processed_at&&e.jsx(l.Item,{label:"Refund Processed At",children:m(t.refund_processed_at)}),t.refund_method&&e.jsx(l.Item,{label:"Refund Method",children:t.refund_method}),t.refund_notes&&e.jsx(l.Item,{label:"Refund Notes",span:2,children:e.jsx(a,{children:t.refund_notes})}),t.cancellation_reason&&e.jsx(l.Item,{label:"Cancellation Reason",span:2,children:e.jsx(a,{children:t.cancellation_reason})}),t.cancelled_at&&e.jsx(l.Item,{label:"Cancelled At",children:m(t.cancelled_at)})]})]}),(()=>{const n=t.form_responses;if(n&&n.length>0){const s=n.filter(o=>o.form_field&&!o.form_field.is_primary);return s.length>0?e.jsxs("div",{children:[e.jsx(g,{level:4,children:"Custom Field Responses"}),e.jsx(y,{size:"small",children:s.map(se)})]}):e.jsxs("div",{children:[e.jsx(g,{level:4,children:"Custom Field Responses"}),e.jsx(y,{size:"small",children:e.jsx(a,{type:"secondary",children:"No custom field responses found."})})]})}else return e.jsxs("div",{children:[e.jsx(g,{level:4,children:"Custom Field Responses"}),e.jsx(y,{size:"small",children:e.jsx(a,{type:"secondary",children:"No form responses found."})})]})})(),t.consent_given&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs(l,{title:"Consent Information",bordered:!0,size:"small",children:[e.jsxs(l.Item,{label:"Consent Given",children:[e.jsx(ye,{style:{color:"green"}})," ","Yes"]}),e.jsx(l.Item,{label:"Consent Date",children:t.consent_given_at?m(t.consent_given_at):"Not recorded"})]})]}),(t.reschedule_attempts>0||t.reschedule_payment_amount>0)&&e.jsxs(e.Fragment,{children:[e.jsx(f,{}),e.jsxs(l,{title:"Reschedule Information",bordered:!0,size:"small",children:[t.reschedule_attempts>0&&e.jsxs(l.Item,{label:"Reschedule Attempts",children:[t.reschedule_attempts," ","time(s)"]}),t.rescheduled_at&&e.jsx(l.Item,{label:"Last Rescheduled",children:m(t.rescheduled_at)}),t.reschedule_payment_amount>0&&e.jsx(l.Item,{label:"Reschedule Fee Paid",children:e.jsxs(a,{strong:!0,style:{color:"#52c41a"},children:["₹",t.reschedule_payment_amount]})}),t.reschedule_payment_id&&e.jsx(l.Item,{label:"Payment ID",children:e.jsx(a,{code:!0,children:t.reschedule_payment_id})}),t.reschedule_payment_date&&e.jsx(l.Item,{label:"Payment Date",children:m(t.reschedule_payment_date)}),t.reschedule_payment_status&&e.jsx(l.Item,{label:"Payment Status",children:e.jsx(c,{status:t.reschedule_payment_status==="paid"?"success":t.reschedule_payment_status==="pending"?"warning":t.reschedule_payment_status==="failed"?"error":"default",text:t.reschedule_payment_status.charAt(0).toUpperCase()+t.reschedule_payment_status.slice(1).replace("_"," ")})})]})]})]})}),e.jsx(ie,{visible:E,onCancel:q,onSuccess:Q,booking:V,isAdmin:!0}),e.jsx(oe,{visible:N,onCancel:Z,onSuccess:X,booking:Y})]})]})}export{Bt as default};
