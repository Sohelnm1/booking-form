import{r as s,j as e,H as be,a as ee}from"./app-C8g8NPlW.js";import{d as te}from"./dayjs.min-C8D6uy6L.js";import{B as we}from"./BookingHeader-K0WWg-n8.js";import{a9 as Se,T as Re,C as z,B as u}from"./Logo-CDqhpTsI.js";import{L as ce}from"./index-BF9Z3oFg.js";import{P as _e}from"./progress-Dez_ubCl.js";import{R as ke,C as re}from"./row-BBkur2F_.js";import{R as ne}from"./FileTextOutlined-DdZh7Ayh.js";import{C as oe}from"./index-Bu3CvMfN.js";import{S as ie}from"./index-DKjJxjzr.js";import{T as A}from"./index-DAuFP0fy.js";import{R as se}from"./EyeOutlined-D0Sv9E-G.js";import{A as _}from"./index-kv2ZU-Ew.js";import{D as k}from"./index-Bi5b3Spo.js";import{R as Be}from"./ArrowLeftOutlined-B6zu6WF4.js";import{R as Te}from"./ArrowRightOutlined-BOynHfFe.js";import{M as ae}from"./index-f4TWz8zb.js";import{I as le}from"./index-Dj2znBUR.js";import{R as de}from"./PhoneOutlined-BB-yXM8E.js";import{R as qe}from"./SendOutlined-Bj4myH7c.js";import{R as Pe}from"./CheckOutlined-ClLlzt6r.js";import{s as l}from"./index-DKkFCNyw.js";import{C as Oe}from"./Collapse-jWFLUUbp.js";/* empty css            */import"./CustomerLoginModal-phdVw1M7.js";import"./LockOutlined-Dj6L2BDk.js";import"./LogoutOutlined-Cjf3cbtA.js";import"./BookOutlined-BSP247HQ.js";import"./CalendarOutlined-B3TgQEw7.js";import"./CheckCircleFilled-MrEsiJ-J.js";import"./useClosable-BmhHyeLv.js";import"./pickAttrs-CL77P40i.js";import"./extendsObject-78o_rR5W.js";import"./EyeOutlined-Bmd706kk.js";import"./InfoCircleFilled-CRmqDlzt.js";import"./PurePanel-DRVFJyWS.js";import"./Input-BEvITN8p.js";import"./EyeOutlined-DKEMeNFp.js";const{Title:C,Text:n,Paragraph:Ie}=Re,{Panel:vt}=Oe,{Content:ze}=ce;function bt({service:a,selectedExtras:j,date:U,time:E,consentSettings:w,selectedPricingTier:i,selectedDuration:Ae,selectedPrice:Ve,bookingSettings:B,auth:v}){const[y,Y]=s.useState([]),[b,pe]=s.useState(null),[fe,V]=s.useState(!1),[d,T]=s.useState(""),[c,F]=s.useState(""),[N,M]=s.useState(!1),[p,q]=s.useState(!1),[P,D]=s.useState(!1),[f,O]=s.useState(!1),[me,L]=s.useState(!1),[J,he]=s.useState("");s.useEffect(()=>{v&&v.user&&v.user.phone_number&&(q(!0),D(!0),T(v.user.phone_number)),ge()},[v]);const ue=()=>{const t=j.map(m=>m.id),r=j.map(m=>({id:m.id,quantity:m.quantity||1})),o=encodeURIComponent(JSON.stringify(r));ee.visit(route("booking.select-datetime"),{data:{service_id:a.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||a.duration,selected_price:i?.price||a.price,extras:t,extra_quantities_json:o}})},ye=()=>{const t=w.filter(x=>x.is_required),r=t.every(x=>y.includes(x.id));if(console.log("handleContinue called",{allRequiredAccepted:r,otpVerified:p,verificationCompleted:P,requiredConsents:t.length,acceptedConsents:y.length}),!r){l.error("Please accept all required agreements to continue");return}if(t.length>0&&!p&&!P){console.log("Showing phone verification modal"),L(!0);return}P&&!p&&q(!0),console.log("Proceeding to confirmation page");const o=j.map(x=>x.id),m=j.map(x=>({id:x.id,quantity:x.quantity||1})),I=encodeURIComponent(JSON.stringify(m)),h=y,H={service_id:a.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||a.duration,selected_price:i?.price||a.price,extras:o,extra_quantities_json:I,date:U,time:E,consents:h,gender_preference:window.location.search.includes("gender_preference=")?new URLSearchParams(window.location.search).get("gender_preference"):"no_preference"};(p||P)&&d&&(H.verified_phone=d),console.log("Navigating to confirm page with data:",H),ee.visit(route("booking.confirm"),{data:H})},W=t=>{pe(t),V(!0)},Q=t=>{Y(r=>r.includes(t)?r.filter(o=>o!==t):[...r,t])},$=()=>{const t=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content");return t||(console.error("CSRF token not found in meta tag"),l.error("CSRF token not found. Please refresh the page."),null)},K=()=>{l.error("Session expired. Please refresh the page and try again.")},ge=async()=>{const t=$();if(!t)return!1;try{const r=await fetch(route("test-csrf"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"}});return r.ok?(console.log("CSRF token is valid"),!0):(console.error("CSRF token validation failed:",r.status),!1)}catch(r){return console.error("Error testing CSRF token:",r),!1}},X=async()=>{if(!d||d.length<10){l.error("Please enter a valid phone number");return}const t=$();if(t)try{O(!0);const r=await fetch(route("booking.send-otp"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"},body:JSON.stringify({phone_number:d})});if(!r.ok){if(r.status===419){K();return}const m=await r.json().catch(()=>({}));l.error(m.error||"Failed to send OTP");return}const o=await r.json();l.success("OTP sent successfully to your phone number"),M(!0),o.otp&&he(o.otp)}catch(r){console.error("Error sending OTP:",r),l.error("Failed to send OTP")}finally{O(!1)}},xe=async()=>{if(!c||c.length!==6){l.error("Please enter a valid 6-digit OTP");return}const t=$();if(t)try{O(!0);const r=await fetch(route("customer.login"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":t,Accept:"application/json"},body:JSON.stringify({phone_number:d,otp:c})});if(!r.ok){if(r.status===419){K();return}const h=await r.json().catch(()=>({}));l.error(h.error||"Invalid OTP");return}const o=await r.json();l.success("Phone number verified successfully!"),q(!0),D(!0),L(!1),o.formatted_phone&&T(o.formatted_phone),o.user;const I=w.filter(h=>h.is_required).find(h=>!y.includes(h.id));I&&Y(h=>[...h,I.id])}catch(r){console.error("Error verifying OTP:",r),l.error("Failed to verify OTP")}finally{O(!1)}},je=()=>{L(!1),T(""),F(""),M(!1),q(!1),D(!1)},S=t=>`₹${parseFloat(t).toFixed(2)}`,G=t=>{if(t<60)return`${t} min`;{const r=Math.floor(t/60),o=t%60;return o>0?`${r}h ${o}m`:`${r}h`}},Ce=t=>te(t,"HH:mm").format("h:mm A"),ve=t=>te(t).format("dddd, MMMM D, YYYY"),g=w.filter(t=>t.is_required),Z=w.filter(t=>!t.is_required),R=g.every(t=>y.includes(t.id));return e.jsxs(ce,{style:{minHeight:"100vh"},children:[e.jsx(be,{title:"Consent & Terms - Book Appointment"}),e.jsx(we,{auth:v}),e.jsx(ze,{children:e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(Se,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(C,{level:2,style:{marginTop:24,marginBottom:8},children:"Consent & Terms"}),e.jsx(n,{type:"secondary",style:{fontSize:16},children:"Please review and accept our terms and conditions"})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(_e,{percent:80,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(n,{type:"secondary",children:"Step 4 of 5"})})]}),e.jsxs(ke,{gutter:[32,32],children:[e.jsxs(re,{xs:24,lg:16,children:[g.length>0&&e.jsxs(z,{style:{marginBottom:24},children:[e.jsxs(C,{level:4,style:{marginBottom:16},children:[e.jsx(ne,{style:{marginRight:8,color:"#ff4d4f"}}),"Required Agreements"]}),g.map(t=>{const r=y.includes(t.id);return e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:r?"#f6ffed":"white"},children:[e.jsx(oe,{checked:r,onChange:()=>Q(t.id),style:{marginRight:12,marginTop:2}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(C,{level:5,style:{margin:0},children:t.title}),e.jsxs(ie,{children:[e.jsx(A,{color:"red",children:"Required"}),e.jsx(u,{type:"text",size:"small",icon:e.jsx(se,{}),onClick:()=>W(t),children:"View"})]})]}),t.summary&&e.jsx(n,{type:"secondary",style:{fontSize:14},children:t.summary})]})]})},t.id)})]}),Z.length>0&&e.jsxs(z,{children:[e.jsxs(C,{level:4,style:{marginBottom:16},children:[e.jsx(ne,{style:{marginRight:8,color:"#1890ff"}}),"Optional Agreements"]}),Z.map(t=>{const r=y.includes(t.id);return e.jsx("div",{style:{marginBottom:16},children:e.jsxs("div",{style:{display:"flex",alignItems:"flex-start",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:r?"#f6ffed":"white"},children:[e.jsx(oe,{checked:r,onChange:()=>Q(t.id),style:{marginRight:12,marginTop:2}}),e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[e.jsx(C,{level:5,style:{margin:0},children:t.title}),e.jsxs(ie,{children:[e.jsx(A,{color:"blue",children:"Optional"}),e.jsx(u,{type:"text",size:"small",icon:e.jsx(se,{}),onClick:()=>W(t),children:"View"})]})]}),t.summary&&e.jsx(n,{type:"secondary",style:{fontSize:14},children:t.summary})]})]})},t.id)})]}),w.length===0&&e.jsx(z,{children:e.jsx(_,{message:"No consent documents available",description:"There are no terms and conditions to review at this time.",type:"info",showIcon:!0})})]}),e.jsx(re,{xs:24,lg:8,children:e.jsxs(z,{style:{position:"sticky",top:24},children:[e.jsx(C,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(n,{strong:!0,children:[a.name,i&&e.jsx(A,{color:"blue",style:{marginLeft:8,fontSize:10},children:i.name})]}),e.jsx(n,{children:S(i?i.price:a.price)})]}),e.jsx(n,{type:"secondary",style:{fontSize:12},children:i?G(i.duration_minutes):a.duration_label||G(a.duration)})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(k,{style:{margin:"12px 0"}}),j.map(t=>{const r=t.quantity||1;return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(n,{children:["+ ",t.name,r>1&&e.jsxs(n,{type:"secondary",style:{fontSize:12},children:[" ","× ",r]})]}),e.jsx(n,{children:S(parseFloat(t.price)*r)})]}),e.jsxs(n,{type:"secondary",style:{fontSize:12},children:[t.duration_relation?t.duration_relation.label:"No additional time",r>1&&e.jsxs(n,{type:"secondary",style:{fontSize:12},children:[" ","× ",r]})]})]},t.id)})]}),window.location.search.includes("gender_preference=")&&new URLSearchParams(window.location.search).get("gender_preference")!=="no_preference"&&e.jsxs(e.Fragment,{children:[e.jsx(k,{style:{margin:"12px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(n,{children:["+"," ",new URLSearchParams(window.location.search).get("gender_preference")==="male"?"Male":"Female"," ","Preference"]}),e.jsx(n,{children:S(new URLSearchParams(window.location.search).get("gender_preference")==="male"?B?.male_preference_fee||0:B?.female_preference_fee||0)})]})]}),e.jsx(k,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(n,{strong:!0,children:"Total Price"}),e.jsx(n,{strong:!0,style:{fontSize:16},children:S(parseFloat(i?i.price:a.price)+j.reduce((t,r)=>{const o=r.quantity||1;return t+parseFloat(r.price)*o},0)+(window.location.search.includes("gender_preference=")&&new URLSearchParams(window.location.search).get("gender_preference")!=="no_preference"?new URLSearchParams(window.location.search).get("gender_preference")==="male"?B?.male_preference_fee||0:B?.female_preference_fee||0:0))})]}),e.jsx(k,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(n,{type:"secondary",children:"Appointment Date"}),e.jsx("div",{children:e.jsx(n,{strong:!0,children:ve(U)})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(n,{type:"secondary",children:"Appointment Time"}),e.jsx("div",{children:e.jsx(n,{strong:!0,children:Ce(E)})})]}),e.jsx(k,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(n,{type:"secondary",children:"Required Agreements"}),e.jsx("div",{children:e.jsxs(n,{strong:!0,style:{color:R?"#52c41a":"#ff4d4f"},children:[y.filter(t=>g.find(r=>r.id===t)).length," ","of ",g.length," ","accepted"]})})]}),g.length>0&&e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(n,{type:"secondary",children:"Phone Verification"}),e.jsx("div",{children:e.jsx(n,{strong:!0,style:{color:p?"#52c41a":"#ff4d4f"},children:p?"✓ Verified":"✗ Not Verified"})})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(u,{block:!0,style:{marginBottom:12},icon:e.jsx(Be,{}),onClick:ue,children:"Back to Date & Time"}),e.jsx(u,{type:"primary",block:!0,size:"large",icon:e.jsx(Te,{}),onClick:ye,disabled:!R||f,loading:f,children:g.length>0&&!p?"Verify Phone Number":"Continue to Confirmation"})]}),!R&&e.jsx(_,{message:"Required agreements not accepted",description:"Please accept all required terms and conditions to continue.",type:"warning",showIcon:!0,style:{marginTop:16}}),R&&!p&&g.length>0&&e.jsx(_,{message:"Phone verification required",description:"Please verify your phone number to continue with the booking.",type:"warning",showIcon:!0,style:{marginTop:16}}),R&&p&&e.jsx(_,{message:"All requirements completed",description:"You can now proceed to the confirmation page.",type:"success",showIcon:!0,style:{marginTop:16}})]})})]}),e.jsx(ae,{title:b?.title,open:fe,onCancel:()=>V(!1),footer:[e.jsx(u,{onClick:()=>V(!1),children:"Close"},"close")],width:800,children:b&&e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(A,{color:b.is_required?"red":"blue",children:b.is_required?"Required":"Optional"}),e.jsxs(n,{type:"secondary",style:{marginLeft:8},children:["Version ",b.version]})]}),e.jsx("div",{style:{maxHeight:400,overflowY:"auto",padding:16,border:"1px solid #f0f0f0",borderRadius:8,backgroundColor:"#fafafa"},children:e.jsx(Ie,{style:{whiteSpace:"pre-line",margin:0},children:b.content})})]})}),e.jsx(ae,{title:e.jsxs("div",{style:{textAlign:"center",padding:"8px 0"},children:[e.jsx("div",{style:{width:60,height:60,borderRadius:"50%",backgroundColor:"#f0f8ff",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px",border:"2px solid #e6f7ff"},children:e.jsx(de,{style:{fontSize:28,color:"#1890ff"}})}),e.jsx(C,{level:3,style:{margin:0,color:"#262626"},children:"Phone Verification"})]}),open:me,onCancel:je,footer:null,width:480,closable:!f,centered:!0,style:{top:20},styles:{body:{padding:"32px 24px"}},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(n,{type:"secondary",style:{fontSize:16,lineHeight:1.6,color:"#595959"},children:N?`We've sent a 6-digit code to ${d}`:"Enter your phone number to receive a verification code"}),N&&J&&e.jsx(_,{message:"Testing Mode - OTP Code",description:`Your verification code is: ${J}`,type:"info",showIcon:!0,style:{marginTop:16}})]}),N?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:32},children:[e.jsxs("div",{style:{position:"relative",display:"flex",justifyContent:"center",gap:8,marginBottom:16},children:[e.jsx(le,{size:"large",placeholder:"Enter 6-digit code",value:c,onChange:t=>F(t.target.value),maxLength:6,style:{position:"absolute",opacity:0,zIndex:10,width:"100%",height:"100%"},autoFocus:!0}),[0,1,2,3,4,5].map(t=>e.jsx("div",{style:{width:48,height:56,border:"2px solid #d9d9d9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:20,fontWeight:600,backgroundColor:c[t]?"#f6ffed":"#fafafa",borderColor:c[t]?"#52c41a":"#d9d9d9",transition:"all 0.2s ease",cursor:"text"},children:c[t]||""},t))]}),e.jsx(n,{type:"secondary",style:{fontSize:14},children:"Enter the 6-digit verification code"})]}),e.jsxs("div",{style:{display:"flex",gap:12,justifyContent:"center"},children:[e.jsx(u,{onClick:()=>{M(!1),F("")},disabled:f,style:{height:44,borderRadius:8,border:"1px solid #d9d9d9",color:"#595959"},children:"Change Number"}),e.jsx(u,{type:"primary",icon:e.jsx(Pe,{}),onClick:xe,loading:f,disabled:!c||c.length!==6,style:{height:44,borderRadius:8,background:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",boxShadow:"0 4px 12px rgba(82, 196, 26, 0.3)"},children:f?"Verifying...":"Verify Code"})]}),e.jsx("div",{style:{marginTop:24},children:e.jsxs(n,{type:"secondary",style:{fontSize:12},children:["Didn't receive the code?"," ",e.jsx(u,{type:"link",size:"small",style:{padding:0,height:"auto"},onClick:X,disabled:f,children:"Resend"})]})})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{position:"relative",marginBottom:8},children:e.jsx(le,{size:"large",placeholder:"+91 98765 43210",prefix:e.jsx(de,{style:{color:"#bfbfbf"}}),value:d,onChange:t=>T(t.target.value),style:{height:48,fontSize:16,borderRadius:8,border:"1px solid #d9d9d9"}})}),e.jsx(n,{type:"secondary",style:{fontSize:12},children:"We'll send you a verification code via SMS"})]}),e.jsx(u,{type:"primary",size:"large",icon:e.jsx(qe,{}),onClick:X,loading:f,disabled:!d||d.length<10,style:{height:48,fontSize:16,fontWeight:500,borderRadius:8,width:"100%",background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",border:"none",boxShadow:"0 4px 12px rgba(24, 144, 255, 0.3)"},children:f?"Sending...":"Send Verification Code"})]})]})})]})})]})}export{bt as default};
