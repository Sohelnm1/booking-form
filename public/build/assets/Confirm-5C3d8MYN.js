import{r as v,R as ge,j as e,H as fe,a as be}from"./app-CADLw3G9.js";import{d as ne}from"./dayjs.min-DKN-ELA8.js";import{B as _e}from"./BookingHeader-eDzihycA.js";import{I as ve,a9 as Re,T as Ce,C as q,B as P}from"./Logo-CLAK33tc.js";import{F as j}from"./index-er7eshNq.js";import{P as we}from"./progress-SnWWg880.js";import{R as U,C as B}from"./row-Dom2nqZh.js";import{R as oe}from"./CheckCircleOutlined-BmTk6eY4.js";import{D as b}from"./index-k65_VsaF.js";import{T as W}from"./index-CKLq3zDx.js";import{R as ze}from"./CalendarOutlined-Cm65HkJR.js";import{R as Se}from"./ClockCircleOutlined-BiPqo-PL.js";import{R as ae}from"./DollarOutlined-dEwdo4p7.js";import{R as Ie}from"./GiftOutlined-DD_DTpKe.js";import{I as u}from"./index-SwRbmmP5.js";import{A as G}from"./index-CfCHoYee.js";import{R as ie}from"./UserOutlined-JTobUxAg.js";import{S as N}from"./index-8xFw_M6G.js";import{R as le}from"./MailOutlined-CZfj0z2_.js";import{R as ke}from"./ArrowLeftOutlined-Br1CB3En.js";import{D as T}from"./index-B12X-zrZ.js";import{s as D}from"./index-2mpHb7UY.js";import{D as ce}from"./index-C6chyWhf.js";import{T as Be}from"./index-Bz7BEpp-.js";import{C as me}from"./index-DnbYL6Tl.js";import{R as de}from"./index-CA6uoqpu.js";import{T as De}from"./index-B59RCmvW.js";import{R as Ae}from"./PhoneOutlined-gkVsPP0b.js";/* empty css            */import"./CustomerLoginModal-D-DurPKh.js";import"./index-C6Y6ZG1D.js";import"./CheckCircleFilled-CHwNSVBx.js";import"./InfoCircleFilled-DJey1gcQ.js";import"./pickAttrs-9MlZ-O9_.js";import"./useClosable-CSbyRlS0.js";import"./extendsObject-78o_rR5W.js";import"./PurePanel-DvLIh7gb.js";import"./LockOutlined-COLUNfIz.js";import"./index-C06X103F.js";import"./index-nwNNYHB9.js";import"./LogoutOutlined-D2_QBXct.js";import"./BookOutlined-0oTi6rVr.js";import"./useForm-2v7yEcOp.js";import"./Input-DEZKARtK.js";import"./EyeOutlined-DLLudd9l.js";import"./EyeOutlined-Bmd706kk.js";import"./index-DDNcFxHa.js";import"./move-JM2Y3ogW.js";import"./DownOutlined-iF-x33Tt.js";var Fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};function J(){return J=Object.assign?Object.assign.bind():function(o){for(var m=1;m<arguments.length;m++){var g=arguments[m];for(var f in g)Object.prototype.hasOwnProperty.call(g,f)&&(o[f]=g[f])}return o},J.apply(this,arguments)}const $e=(o,m)=>v.createElement(ve,J({},o,{ref:m,icon:Fe})),R=v.forwardRef($e),{Title:A,Text:s,Paragraph:Pt}=Ce,{Option:_}=N;function Tt({service:o,selectedExtras:m,date:g,time:f,consentSettings:O,form:qe,formFields:x,paymentSettings:E,totalPrice:C,verifiedPhone:a,selectedPricingTier:i,selectedDuration:Pe,selectedPrice:Te,auth:pe}){const[w]=j.useForm(),[ue,K]=v.useState(!1),[Ne,Oe]=v.useState(0),[V,X]=v.useState(""),[he,Q]=v.useState(!1),[h,F]=v.useState(null),[H,S]=v.useState(""),[I,$]=v.useState(C),Z=(i?i.duration_minutes:o.duration)+m.reduce((t,r)=>{const n=r.quantity||1;if(r.durationRelation){const d=r.durationRelation.hours*60+r.durationRelation.minutes;return t+d*n}return t+(r.total_duration||0)*n},0);ge.useEffect(()=>{if(console.log("Confirm page - verifiedPhone received:",a),console.log("Confirm page - formInstance available:",!!w),console.log("Confirm page - formFields:",x),a&&x){const t=x.find(r=>r.is_primary&&(r.name==="customer_phone"||r.name==="phone_number"));t?(console.log("Found phone field:",t.name,"Setting value:",a),w.setFieldsValue({[t.name]:a}),setTimeout(()=>{const r=w.getFieldsValue();console.log("Form values after setting phone:",r)},100)):console.log("No phone field found in form fields")}else console.log("No verified phone number available or no form fields")},[a,w,x]);const ye=()=>{const t=m.map(n=>n.id),r=O.map(n=>n.id);be.visit(route("booking.consent"),{data:{service_id:o.id,extras:t,date:g,time:f,consents:r}})},ee=async()=>{if(!V.trim()){S("Please enter a coupon code");return}Q(!0),S("");try{const t=m.map(l=>l.id),r=w.getFieldValue("customer_phone")||a,d=await(await fetch(route("booking.validate-coupon"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({code:V,service_id:o.id,extras:t,phone_number:r})})).json();d.valid?(F(d.coupon),$(d.coupon.final_amount),S(""),D.success(d.message)):(S(d.message),F(null),$(C))}catch(t){console.error("Coupon validation error:",t),S("Failed to validate coupon. Please try again."),F(null),$(C)}finally{Q(!1)}},xe=()=>{F(null),X(""),$(C),S("")},je=async t=>{K(!0);try{const r=m.map(c=>c.id),n=m.map(c=>({id:c.id,quantity:c.quantity||1})),d=O.map(c=>c.id),l={service_id:o.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||o.duration,selected_price:i?.price||o.price,extras:r,extra_quantities:n,date:g,time:f,consents:d,verified_phone:a,payment_method:t.payment_method,special_requests:t.special_requests||"",coupon_code:h?h.code:null};x&&x.forEach(c=>{t[c.name]!==void 0&&(l[c.name]=t[c.name])}),console.log("Form data being sent to backend:",l),console.log("Pricing tier debug:",{selectedPricingTier:i,pricing_tier_id:l.pricing_tier_id,selected_duration:l.selected_duration,selected_price:l.selected_price,service_price:o.price,service_duration:o.duration}),console.log("Form values from Ant Design:",t),console.log("Applied coupon:",h),console.log("Coupon code being sent:",l.coupon_code),console.log("Phone number debug:",{verifiedPhone:a,formValues:t,finalFormData:l});const z=await fetch(route("booking.process"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(l)});let p;try{p=await z.json()}catch(c){console.error("Failed to parse response:",c),D.error("Server returned an invalid response. Please try again.");return}if(p.success){console.log("Razorpay order data:",p.order_data),console.log("Frontend final price:",I),console.log("Frontend total price:",C),console.log("Amount being sent to Razorpay:",p.order_data.amount),console.log("Amount in rupees:",p.order_data.amount/100),console.log("Expected discounted amount in paise:",I*100),console.log("Expected discounted amount in rupees:",I);const c={key:p.order_data.key_id,amount:p.order_data.amount,currency:p.order_data.currency,name:"HospiPal",description:`${o.name} - Booking`,order_id:p.order_data.order_id,handler:function(Y){window.location.href=route("booking.payment-success")+`?razorpay_payment_id=${Y.razorpay_payment_id}&razorpay_order_id=${Y.razorpay_order_id}&razorpay_signature=${Y.razorpay_signature}`},prefill:{name:t.customer_name,email:t.customer_email,contact:a||t.customer_phone},theme:{color:"#1890ff"},modal:{ondismiss:function(){window.location.href=route("booking.payment-cancelled")}},notes:{"Booking Details":`${o.name} - ${L(g)} at ${M(f)}`}};new window.Razorpay(c).open()}else p.errors?Object.keys(p.errors).forEach(c=>{p.errors[c].forEach(se=>{D.error(se)})}):D.error(p.error||"Failed to create booking")}catch(r){console.error("Booking error:",r),D.error("An error occurred. Please try again.")}finally{K(!1)}},y=t=>`â‚¹${parseFloat(t).toFixed(2)}`,k=t=>{if(t<60)return`${t} min`;{const r=Math.floor(t/60),n=t%60;return n>0?`${r}h ${n}m`:`${r}h`}},M=t=>ne(t,"HH:mm").format("h:mm A"),L=t=>ne(t).format("dddd, MMMM D, YYYY"),te=t=>{const r=[];switch(t.is_required?r.push({required:!0,message:`Please enter your ${t.label.toLowerCase()}`}):r.push({required:!1}),t.type){case"email":r.push({type:"email",message:"Please enter a valid email address"});break;case"phone":r.push({pattern:/^[0-9+\-\s()]+$/,message:"Please enter a valid phone number"});break;case"number":r.push({type:"number",message:"Please enter a valid number"});break;case"url":r.push({type:"url",message:"Please enter a valid URL"});break}return r},re=t=>{const r={placeholder:t.placeholder,size:"large"};switch(t.type){case"text":return e.jsx(u,{...r});case"email":return e.jsx(u,{...r,prefix:e.jsx(le,{})});case"phone":return e.jsx(u,{...r,prefix:e.jsx(Ae,{})});case"number":return e.jsx(De,{...r,style:{width:"100%"}});case"textarea":return e.jsx(u.TextArea,{...r,rows:3});case"select":return e.jsx(N,{...r,children:t.options?.map((n,d)=>{const l=typeof n=="object"?n.value:n,z=typeof n=="object"?n.label:n;return e.jsx(_,{value:l,children:z},d)})});case"radio":return e.jsx(de.Group,{children:t.options?.map((n,d)=>{const l=typeof n=="object"?n.value:n,z=typeof n=="object"?n.label:n;return e.jsx(de,{value:l,children:z},d)})});case"checkbox":return e.jsx(me.Group,{children:t.options?.map((n,d)=>{const l=typeof n=="object"?n.value:n,z=typeof n=="object"?n.label:n;return e.jsx(me,{value:l,children:z},d)})});case"date":return e.jsx(ce,{...r,style:{width:"100%"}});case"time":return e.jsx(Be,{...r,style:{width:"100%"}});case"datetime":return e.jsx(ce,{...r,showTime:!0,style:{width:"100%"}});case"url":return e.jsx(u,{...r});case"password":return e.jsx(u.Password,{...r});default:return e.jsx(u,{...r})}};return e.jsxs("div",{children:[e.jsx(fe,{title:"Confirm & Pay - Book Appointment"}),e.jsx(_e,{auth:pe}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"16px",overflow:"hidden"},children:[e.jsx("div",{className:"mobile-top-spacing"}),e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(Re,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(A,{level:2,style:{marginTop:24,marginBottom:8},children:"Confirm & Pay"}),e.jsx(s,{type:"secondary",style:{fontSize:16},children:"Review your booking and complete payment"})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(we,{percent:100,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(s,{type:"secondary",children:"Step 5 of 5"})})]}),e.jsxs(U,{gutter:[16,16],children:[e.jsxs(B,{xs:24,lg:16,children:[e.jsxs(q,{style:{marginBottom:24},children:[e.jsxs(A,{level:4,style:{marginBottom:16},children:[e.jsx(oe,{style:{marginRight:8,color:"#52c41a"}}),"Booking Summary"]}),e.jsxs(b,{bordered:!0,column:1,size:"small",children:[e.jsx(b.Item,{label:"Service",children:e.jsxs("div",{children:[e.jsxs(s,{strong:!0,children:[o.name,i&&e.jsx(W,{color:"blue",style:{marginLeft:8,fontSize:10},children:i.name})]}),e.jsx("br",{}),e.jsx(s,{type:"secondary",children:k(i?i.duration_minutes:o.duration)})]})}),m.length>0&&e.jsx(b.Item,{label:"Extras",children:m.map(t=>{const r=t.quantity||1;return e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(s,{children:["+ ",t.name,r>1&&e.jsxs(s,{type:"secondary",style:{fontSize:12},children:[" ","Ã— ",r]})]}),e.jsx("br",{}),e.jsx(s,{type:"secondary",children:y(parseFloat(t.price)*r)}),e.jsx("br",{}),e.jsxs(s,{type:"secondary",style:{fontSize:12},children:[t.duration_relation?t.duration_relation.label:"No additional time",r>1&&e.jsxs(s,{type:"secondary",style:{fontSize:12},children:[" ","Ã— ",r]})]})]},t.id)})}),e.jsxs(b.Item,{label:"Appointment Date",children:[e.jsx(ze,{style:{marginRight:8}}),L(g)]}),e.jsxs(b.Item,{label:"Appointment Time",children:[e.jsx(Se,{style:{marginRight:8}}),M(f)]}),e.jsx(b.Item,{label:"Total Duration",children:k(Z)}),h&&e.jsx(b.Item,{label:"Original Price",children:e.jsxs(s,{delete:!0,style:{fontSize:16},children:[e.jsx(ae,{style:{marginRight:8}}),y(C)]})}),h&&e.jsx(b.Item,{label:"Discount",children:e.jsxs(s,{style:{fontSize:16,color:"#52c41a"},children:["-"," ",y(h.discount_amount)]})}),e.jsx(b.Item,{label:"Total Price",children:e.jsxs(s,{strong:!0,style:{fontSize:18,color:"#52c41a"},children:[e.jsx(ae,{style:{marginRight:8}}),y(I)]})})]})]}),e.jsxs(q,{style:{marginBottom:24},children:[e.jsxs(A,{level:4,style:{marginBottom:16},children:[e.jsx(Ie,{style:{marginRight:8}}),"Apply Coupon"]}),h?e.jsx("div",{children:e.jsx(G,{message:"Coupon Applied Successfully!",description:e.jsxs("div",{children:[e.jsx(s,{strong:!0,children:h.name}),e.jsx("br",{}),e.jsxs(s,{type:"secondary",children:["You saved Rs."," ",h.discount_amount]})]}),type:"success",showIcon:!0,action:e.jsx(P,{size:"small",onClick:xe,children:"Remove"})})}):e.jsxs(U,{gutter:16,children:[e.jsxs(B,{flex:"auto",children:[e.jsx(u,{placeholder:"Enter coupon code",value:V,onChange:t=>X(t.target.value),onPressEnter:ee,status:H?"error":""}),H&&e.jsx(s,{type:"danger",style:{fontSize:12},children:H})]}),e.jsx(B,{children:e.jsx(P,{type:"primary",onClick:ee,loading:he,children:"Apply"})})]})]}),e.jsxs(q,{children:[e.jsxs(A,{level:4,style:{marginBottom:16},children:[e.jsx(ie,{style:{marginRight:8}}),"Customer Information"]}),e.jsxs(j,{form:w,layout:"vertical",onFinish:je,initialValues:{payment_method:"card"},children:[x&&x.length>0?e.jsxs(e.Fragment,{children:[x.filter(t=>t.is_primary).map(t=>e.jsx(j.Item,{name:t.name,label:t.label,rules:te(t),help:t.help_text,children:re(t)},t.id)),x.filter(t=>!t.is_primary).map(t=>e.jsx(j.Item,{name:t.name,label:t.label,rules:te(t),help:t.help_text,children:re(t)},t.id)),e.jsx(j.Item,{name:"payment_method",label:"Payment Method",rules:[{required:!0,message:"Please select a payment method"}],children:e.jsxs(N,{size:"large",placeholder:"Select payment method",children:[e.jsxs(_,{value:"card",children:[e.jsx(R,{style:{marginRight:8}}),"Credit/Debit Card"]}),e.jsxs(_,{value:"upi",children:[e.jsx(R,{style:{marginRight:8}}),"UPI Payment"]}),e.jsxs(_,{value:"netbanking",children:[e.jsx(R,{style:{marginRight:8}}),"Net Banking"]}),e.jsxs(_,{value:"wallet",children:[e.jsx(R,{style:{marginRight:8}}),"Digital Wallet"]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(U,{gutter:16,children:[e.jsx(B,{xs:24,sm:12,children:e.jsx(j.Item,{name:"customer_name",label:"Full Name",rules:[{required:!0,message:"Please enter your full name"}],children:e.jsx(u,{prefix:e.jsx(ie,{}),placeholder:"Enter your full name",size:"large"})})}),e.jsxs(B,{xs:24,sm:12,children:[e.jsx(j.Item,{name:"customer_phone",label:"Phone Number",rules:[{required:!0,message:"Please enter your phone number"},{pattern:/^[0-9+\-\s()]+$/,message:"Please enter a valid phone number"}],children:e.jsx(u,{placeholder:"Enter your phone number",disabled:!!a,addonBefore:e.jsx("span",{style:{color:a?"#52c41a":"inherit"},children:a?"âœ“ Verified":"ðŸ“±"})})}),a&&e.jsx(s,{type:"success",style:{fontSize:"12px"},children:"Phone number verified in previous step"}),a&&a!==w.getFieldValue("customer_phone")&&e.jsxs(s,{type:"warning",style:{fontSize:"12px"},children:["Note: Using verified phone number (",a,") for booking"]})]})]}),e.jsx(j.Item,{name:"customer_email",label:"Email Address",rules:[{required:!0,message:"Please enter your email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(u,{prefix:e.jsx(le,{}),placeholder:"Enter your email address",size:"large"})}),e.jsx(j.Item,{name:"payment_method",label:"Payment Method",rules:[{required:!0,message:"Please select a payment method"}],children:e.jsxs(N,{size:"large",placeholder:"Select payment method",children:[e.jsxs(_,{value:"card",children:[e.jsx(R,{style:{marginRight:8}}),"Credit/Debit Card"]}),e.jsxs(_,{value:"upi",children:[e.jsx(R,{style:{marginRight:8}}),"UPI Payment"]}),e.jsxs(_,{value:"netbanking",children:[e.jsx(R,{style:{marginRight:8}}),"Net Banking"]}),e.jsxs(_,{value:"wallet",children:[e.jsx(R,{style:{marginRight:8}}),"Digital Wallet"]})]})}),e.jsx(j.Item,{name:"special_requests",label:"Special Requests (Optional)",children:e.jsx(u.TextArea,{rows:3,placeholder:"Any special requests or notes for your appointment..."})})]}),e.jsx(G,{message:"Booking Confirmation",description:"By clicking 'Confirm & Pay', you agree to our terms and conditions and confirm your appointment booking.",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs("div",{style:{display:"flex",gap:16,flexDirection:"column",width:"100%"},children:[e.jsx(P,{size:"large",icon:e.jsx(ke,{}),onClick:ye,style:{width:"100%"},children:"Back to Terms"}),e.jsxs(P,{type:"primary",size:"large",htmlType:"submit",loading:ue,icon:e.jsx(oe,{}),style:{width:"100%"},children:[e.jsx("span",{className:"hidden-xs",children:"Confirm & Pay"}),e.jsx("span",{className:"visible-xs",children:"Pay"})," ",y(I)]})]})]})]})]}),e.jsx(B,{xs:24,lg:8,children:e.jsxs(q,{style:{position:"sticky",top:24},children:[e.jsx(A,{level:4,style:{marginBottom:16},children:"Final Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsxs(s,{strong:!0,children:[o.name,i&&e.jsx(W,{color:"blue",style:{marginLeft:8,fontSize:10},children:i.name})]}),e.jsx(s,{children:y(i?i.price:o.price)})]}),e.jsx(s,{type:"secondary",style:{fontSize:12},children:k(i?i.duration_minutes:o.duration)})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(s,{type:"secondary",style:{fontSize:12},children:"Employee will be automatically assigned based on availability"})}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(T,{style:{margin:"12px 0"}}),m.map(t=>{const r=t.quantity||1,n=parseFloat(t.price)*r;return e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(s,{children:["+ ",t.name,r>1&&e.jsxs(s,{type:"secondary",style:{fontSize:12,marginLeft:4},children:["Ã— ",r]})]}),e.jsx(s,{children:y(n)})]})},t.id)})]}),e.jsx(T,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(s,{type:"secondary",children:"Appointment Date"}),e.jsx("div",{children:e.jsx(s,{strong:!0,children:L(g)})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(s,{type:"secondary",children:"Appointment Time"}),e.jsx("div",{children:e.jsx(s,{strong:!0,children:M(f)})})]}),e.jsx(T,{style:{margin:"16px 0"}}),h&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(s,{children:"Original Price"}),e.jsx(s,{delete:!0,style:{fontSize:14},children:y(C)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(s,{children:"Discount"}),e.jsxs(s,{style:{fontSize:14,color:"#52c41a"},children:["-"," ",y(h.discount_amount)]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(s,{strong:!0,children:"Total Price"}),e.jsx(s,{strong:!0,style:{fontSize:18,color:"#52c41a"},children:y(I)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(s,{type:"secondary",children:"Total Duration"}),e.jsx(s,{type:"secondary",children:k(Z)})]}),e.jsx(T,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(s,{type:"secondary",children:"Accepted Agreements"}),e.jsx("div",{children:O.map(t=>e.jsx(W,{color:"green",style:{marginTop:4},children:t.title},t.id))})]}),e.jsx(G,{message:"Secure Payment",description:`Your payment information is encrypted and secure. ${E?.razorpay_key?"Powered by Razorpay.":""}`,type:"success",showIcon:!0,style:{marginTop:16}}),E?.currency&&e.jsxs(s,{type:"secondary",style:{fontSize:12,display:"block",marginTop:8},children:["Currency: ",E.currency]})]})})]})]})]})}export{Tt as default};
