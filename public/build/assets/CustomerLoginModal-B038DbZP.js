import{r as n,j as e}from"./app-CjLSFTvF.js";import{M as O}from"./index-BFDovZzk.js";import{R as x}from"./PhoneOutlined-DCAGKc-b.js";import{R as T}from"./LockOutlined-DR4CBdjC.js";import{I as b}from"./index-D0ij-sgg.js";import{B as u}from"./Logo-DLy9Pi-u.js";import{s as r}from"./index-BdNhniXG.js";function B({isVisible:S,onClose:p,onSuccess:y}){const[s,h]=n.useState(""),[i,a]=n.useState(""),[d,f]=n.useState(!1),[c,l]=n.useState(!1),[m,j]=n.useState(""),g=n.useRef(null),v=async()=>{if(!s||s.length<10){r.error("Please enter a valid phone number");return}try{l(!0);const t=await fetch(route("booking.send-otp"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({phone_number:s})}),o=await t.json();t.ok?(r.success("OTP sent successfully to your phone number"),f(!0),o.otp&&j(o.otp)):r.error(o.error||"Failed to send OTP")}catch(t){console.error("Error sending OTP:",t),r.error("Failed to send OTP")}finally{l(!1)}},z=async()=>{if(!i||i.length!==6){r.error("Please enter a valid 6-digit OTP");return}try{l(!0);const t=await fetch(route("customer.login"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({phone_number:s,otp:i})}),o=await t.json();t.ok?(r.success("Login successful!"),f(!1),a(""),h(""),y&&y(o.user),p(),window.location.reload()):r.error(o.error||"Invalid OTP")}catch(t){console.error("Error verifying OTP:",t),r.error("Failed to verify OTP")}finally{l(!1)}},C=()=>{f(!1),a(""),h(""),l(!1),p()};return n.useEffect(()=>{d&&g.current&&setTimeout(()=>{g.current.focus()},100)},[d]),e.jsx(O,{title:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 0"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:18,fontWeight:"bold"},children:"🔐"}),e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:18,fontWeight:600,color:"#1f1f1f"},children:"Customer Login"}),e.jsx("div",{style:{fontSize:12,color:"#999",marginTop:2},children:"Secure OTP Verification"})]})]}),open:S,onCancel:C,footer:null,width:520,centered:!0,styles:{header:{borderBottom:"1px solid #f0f0f0",padding:"16px 20px 12px 20px"},body:{padding:"20px"}},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("div",{style:{width:60,height:60,borderRadius:"50%",background:"linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 12px auto",border:"2px solid #bae7ff"},children:d?e.jsx(T,{style:{fontSize:24,color:"#1890ff"}}):e.jsx(x,{style:{fontSize:24,color:"#1890ff"}})}),e.jsx("h3",{style:{fontSize:18,fontWeight:600,color:"#1f1f1f",marginBottom:6},children:d?"Enter Verification Code":"Enter Your Phone Number"}),e.jsx("p",{style:{fontSize:13,color:"#666",lineHeight:1.4,margin:0},children:d?`We've sent a 6-digit code to ${s}`:"We'll send you a secure verification code via SMS"})]}),d?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"center",gap:6,marginBottom:12,position:"relative"},children:[[0,1,2,3,4,5].map(t=>e.jsx("div",{onClick:()=>g.current?.focus(),style:{width:42,height:42,border:"2px solid #d9d9d9",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",fontSize:18,fontWeight:"bold",background:"#fff",color:i[t]?"#1890ff":"#d9d9d9",borderColor:i[t]?"#1890ff":"#d9d9d9",transition:"all 0.3s ease",cursor:"text",userSelect:"none"},children:i[t]||""},t)),e.jsx(b,{ref:g,size:"large",placeholder:"Enter 6-digit code",value:i,onChange:t=>{const o=t.target.value.replace(/\D/g,"").slice(0,6);a(o)},style:{position:"absolute",opacity:0,zIndex:-1,width:"100%",height:"100%"},maxLength:6,autoComplete:"one-time-code"})]}),e.jsx("div",{style:{fontSize:11,color:"#999"},children:"Enter the 6-digit code sent to your phone"})]}),e.jsxs("div",{style:{marginBottom:12},children:[e.jsx(u,{type:"default",size:"large",onClick:()=>{f(!1),a("")},style:{marginRight:10,height:40,borderRadius:8,border:"1px solid #d9d9d9",fontWeight:500,fontSize:14},children:"← Back"}),e.jsx(u,{type:"primary",size:"large",onClick:z,loading:c,style:{height:40,borderRadius:8,background:"linear-gradient(135deg, #52c41a 0%, #389e0d 100%)",border:"none",boxShadow:"0 4px 12px rgba(82, 196, 26, 0.3)",fontWeight:500,fontSize:14},children:c?"Verifying...":"Verify & Login"})]}),m&&e.jsxs("div",{style:{background:"linear-gradient(135deg, #f0f8ff 0%, #e6f7ff 100%)",border:"1px solid #bae7ff",borderRadius:8,padding:10,marginTop:12},children:[e.jsx("div",{style:{fontSize:11,color:"#1890ff",fontWeight:500},children:"🧪 Testing Mode - OTP Code"}),e.jsx("div",{style:{fontSize:13,color:"#1890ff",fontWeight:600,marginTop:3},children:m})]})]}):e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(b,{size:"large",placeholder:"+91 98765 43210",value:s,onChange:t=>h(t.target.value),style:{height:44,fontSize:15,borderRadius:8,border:"1px solid #d9d9d9"},maxLength:10,prefix:e.jsx(x,{style:{color:"#1890ff",fontSize:16}})}),e.jsx("div",{style:{marginTop:6,fontSize:11,color:"#999",textAlign:"left"},children:"We'll send you a verification code via SMS"})]}),e.jsx(u,{type:"primary",size:"large",onClick:v,loading:c,style:{width:"100%",height:44,fontSize:15,fontWeight:500,borderRadius:8,background:"linear-gradient(135deg, #1890ff 0%, #096dd9 100%)",border:"none",boxShadow:"0 4px 12px rgba(24, 144, 255, 0.3)"},children:c?"Sending...":"Send Verification Code"})]})]})})}export{B as C};
