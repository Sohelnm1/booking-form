import{r as v,R as ye,j as e,H as xe,a as ge}from"./app-C-_7uao2.js";import{d as re}from"./dayjs.min-J00tXd4b.js";import{B as je}from"./BookingHeader-BCf0B0cj.js";import{I as fe,ad as be,T as ve,C as A,B as $}from"./Logo-B1o7Ze6Y.js";import{F as y}from"./index-x_x3JvBM.js";import{P as _e}from"./progress-CsQPCzSU.js";import{R as L,C as k}from"./row-rnKDuNpk.js";import{R as se}from"./CheckCircleOutlined-BUJLvDPU.js";import{D as f}from"./index-BBYCSfDN.js";import{R as Ce}from"./CalendarOutlined-DsF39C_E.js";import{R as Re}from"./ClockCircleOutlined-jcAVxpt2.js";import{R as te}from"./DollarOutlined-D8qmbk19.js";import{R as Ie}from"./GiftOutlined-Br1G8Ob1.js";import{I as d}from"./index-CCvGSMQk.js";import{A as Y}from"./index-BPhEJg7g.js";import{R as ne}from"./UserOutlined-C42i8Wv9.js";import{S as D}from"./index-BVNlpN7p.js";import{R as oe}from"./MailOutlined-BHsaoJTV.js";import{R as we}from"./ArrowLeftOutlined-J1EZFMt9.js";import{D as F}from"./index-DVbAbT5o.js";import{T as ke}from"./index-BUzv-12u.js";import{s as z}from"./index-D87hQRyl.js";import{D as ae}from"./index-DmgcQrGo.js";import{T as ze}from"./index-BumUVHGY.js";import{C as ie}from"./index-CG49bUy4.js";import{R as le}from"./index-C--QZ_X-.js";import{T as Se}from"./index-BM0WmZK4.js";import{R as Be}from"./PhoneOutlined-DPXHLBve.js";/* empty css            */import"./LogoutOutlined-CcOqAjwU.js";import"./BookOutlined-83y4ltn8.js";import"./useForm-BUI5eqGG.js";import"./CheckCircleFilled-b2Lbp7ff.js";import"./InfoCircleFilled-BXOvrJG9.js";import"./Input-1CS9RFTb.js";import"./pickAttrs-CYwhknCO.js";import"./EyeOutlined-4E9-30tx.js";import"./PurePanel-CyGAA7Fx.js";import"./index-PTmwT_P4.js";import"./move-C4_sGVzz.js";import"./useClosable-DAJgbKkF.js";var Te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};function U(){return U=Object.assign?Object.assign.bind():function(i){for(var c=1;c<arguments.length;c++){var x=arguments[c];for(var g in x)Object.prototype.hasOwnProperty.call(x,g)&&(i[g]=x[g])}return i},U.apply(this,arguments)}const Pe=(i,c)=>v.createElement(fe,U({},i,{ref:c,icon:Te})),_=v.forwardRef(Pe),{Title:S,Text:t,Paragraph:Cr}=ve,{Option:b}=D;function Rr({service:i,selectedExtras:c,date:x,time:g,consentSettings:O,form:Ae,formFields:u,paymentSettings:q,totalPrice:C,verifiedPhone:l,auth:ce}){const[R]=y.useForm(),[me,W]=v.useState(!1),[$e,Fe]=v.useState(0),[E,G]=v.useState(""),[de,J]=v.useState(!1),[p,B]=v.useState(null),[N,I]=v.useState(""),[w,T]=v.useState(C),K=i.duration+c.reduce((r,s)=>r+(s.duration||0),0);ye.useEffect(()=>{if(console.log("Confirm page - verifiedPhone received:",l),console.log("Confirm page - formInstance available:",!!R),console.log("Confirm page - formFields:",u),l&&u){const r=u.find(s=>s.is_primary&&(s.name==="customer_phone"||s.name==="phone_number"));r?(console.log("Found phone field:",r.name,"Setting value:",l),R.setFieldsValue({[r.name]:l}),setTimeout(()=>{const s=R.getFieldsValue();console.log("Form values after setting phone:",s)},100)):console.log("No phone field found in form fields")}else console.log("No verified phone number available or no form fields")},[l,R,u]);const pe=()=>{const r=c.map(n=>n.id),s=O.map(n=>n.id);ge.visit(route("booking.consent"),{data:{service_id:i.id,extras:r,date:x,time:g,consents:s}})},X=async()=>{if(!E.trim()){I("Please enter a coupon code");return}J(!0),I("");try{const r=c.map(j=>j.id),s=R.getFieldValue("customer_phone")||l,a=await(await fetch(route("booking.validate-coupon"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({code:E,service_id:i.id,extras:r,phone_number:s})})).json();a.valid?(B(a.coupon),T(a.coupon.final_amount),I(""),z.success(a.message)):(I(a.message),B(null),T(C))}catch(r){console.error("Coupon validation error:",r),I("Failed to validate coupon. Please try again."),B(null),T(C)}finally{J(!1)}},ue=()=>{B(null),G(""),T(C),I("")},he=async r=>{W(!0);try{const s=c.map(m=>m.id),n=O.map(m=>m.id),a={service_id:i.id,extras:s,date:x,time:g,consents:n,verified_phone:l,payment_method:r.payment_method,special_requests:r.special_requests||"",coupon_code:p?p.code:null};u&&u.forEach(m=>{r[m.name]!==void 0&&(a[m.name]=r[m.name])}),console.log("Form data being sent to backend:",a),console.log("Form values from Ant Design:",r),console.log("Applied coupon:",p),console.log("Coupon code being sent:",a.coupon_code),console.log("Phone number debug:",{verifiedPhone:l,formValues:r,finalFormData:a});const j=await fetch(route("booking.process"),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify(a)});let o;try{o=await j.json()}catch(m){console.error("Failed to parse response:",m),z.error("Server returned an invalid response. Please try again.");return}if(o.success){console.log("Razorpay order data:",o.order_data),console.log("Frontend final price:",w),console.log("Frontend total price:",C),console.log("Amount being sent to Razorpay:",o.order_data.amount),console.log("Amount in rupees:",o.order_data.amount/100),console.log("Expected discounted amount in paise:",w*100),console.log("Expected discounted amount in rupees:",w);const m={key:o.order_data.key_id,amount:o.order_data.amount,currency:o.order_data.currency,name:"HospiPal",description:`${i.name} - Booking`,order_id:o.order_data.order_id,handler:function(M){window.location.href=route("booking.payment-success")+`?razorpay_payment_id=${M.razorpay_payment_id}&razorpay_order_id=${M.razorpay_order_id}&razorpay_signature=${M.razorpay_signature}`},prefill:{name:r.customer_name,email:r.customer_email,contact:l||r.customer_phone},theme:{color:"#1890ff"},modal:{ondismiss:function(){window.location.href=route("booking.payment-cancelled")}},notes:{"Booking Details":`${i.name} - ${H(x)} at ${V(g)}`}};new window.Razorpay(m).open()}else o.errors?Object.keys(o.errors).forEach(m=>{o.errors[m].forEach(ee=>{z.error(ee)})}):z.error(o.error||"Failed to create booking")}catch(s){console.error("Booking error:",s),z.error("An error occurred. Please try again.")}finally{W(!1)}},h=r=>`â‚¹${parseFloat(r).toFixed(2)}`,P=r=>{if(r<60)return`${r} min`;{const s=Math.floor(r/60),n=r%60;return n>0?`${s}h ${n}m`:`${s}h`}},V=r=>re(r,"HH:mm").format("h:mm A"),H=r=>re(r).format("dddd, MMMM D, YYYY"),Q=r=>{const s=[];switch(r.is_required?s.push({required:!0,message:`Please enter your ${r.label.toLowerCase()}`}):s.push({required:!1}),r.type){case"email":s.push({type:"email",message:"Please enter a valid email address"});break;case"phone":s.push({pattern:/^[0-9+\-\s()]+$/,message:"Please enter a valid phone number"});break;case"number":s.push({type:"number",message:"Please enter a valid number"});break;case"url":s.push({type:"url",message:"Please enter a valid URL"});break}return s},Z=r=>{const s={placeholder:r.placeholder,size:"large"};switch(r.type){case"text":return e.jsx(d,{...s});case"email":return e.jsx(d,{...s,prefix:e.jsx(oe,{})});case"phone":return e.jsx(d,{...s,prefix:e.jsx(Be,{})});case"number":return e.jsx(Se,{...s,style:{width:"100%"}});case"textarea":return e.jsx(d.TextArea,{...s,rows:3});case"select":return e.jsx(D,{...s,children:r.options?.map((n,a)=>{const j=typeof n=="object"?n.value:n,o=typeof n=="object"?n.label:n;return e.jsx(b,{value:j,children:o},a)})});case"radio":return e.jsx(le.Group,{children:r.options?.map((n,a)=>{const j=typeof n=="object"?n.value:n,o=typeof n=="object"?n.label:n;return e.jsx(le,{value:j,children:o},a)})});case"checkbox":return e.jsx(ie.Group,{children:r.options?.map((n,a)=>{const j=typeof n=="object"?n.value:n,o=typeof n=="object"?n.label:n;return e.jsx(ie,{value:j,children:o},a)})});case"date":return e.jsx(ae,{...s,style:{width:"100%"}});case"time":return e.jsx(ze,{...s,style:{width:"100%"}});case"datetime":return e.jsx(ae,{...s,showTime:!0,style:{width:"100%"}});case"url":return e.jsx(d,{...s});case"password":return e.jsx(d.Password,{...s});default:return e.jsx(d,{...s})}};return e.jsxs("div",{children:[e.jsx(xe,{title:"Confirm & Pay - Book Appointment"}),e.jsx(je,{auth:ce}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(be,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(S,{level:2,style:{marginTop:24,marginBottom:8},children:"Confirm & Pay"}),e.jsx(t,{type:"secondary",style:{fontSize:16},children:"Review your booking and complete payment"})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(_e,{percent:100,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(t,{type:"secondary",children:"Step 5 of 5"})})]}),e.jsxs(L,{gutter:[32,32],children:[e.jsxs(k,{xs:24,lg:16,children:[e.jsxs(A,{style:{marginBottom:24},children:[e.jsxs(S,{level:4,style:{marginBottom:16},children:[e.jsx(se,{style:{marginRight:8,color:"#52c41a"}}),"Booking Summary"]}),e.jsxs(f,{bordered:!0,column:1,size:"small",children:[e.jsx(f.Item,{label:"Service",children:e.jsxs("div",{children:[e.jsx(t,{strong:!0,children:i.name}),e.jsx("br",{}),e.jsx(t,{type:"secondary",children:P(i.duration)})]})}),c.length>0&&e.jsx(f.Item,{label:"Extras",children:c.map(r=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsxs(t,{children:["+ ",r.name]}),e.jsx("br",{}),e.jsx(t,{type:"secondary",children:h(r.price)})]},r.id))}),e.jsxs(f.Item,{label:"Appointment Date",children:[e.jsx(Ce,{style:{marginRight:8}}),H(x)]}),e.jsxs(f.Item,{label:"Appointment Time",children:[e.jsx(Re,{style:{marginRight:8}}),V(g)]}),e.jsx(f.Item,{label:"Total Duration",children:P(K)}),p&&e.jsx(f.Item,{label:"Original Price",children:e.jsxs(t,{delete:!0,style:{fontSize:16},children:[e.jsx(te,{style:{marginRight:8}}),h(C)]})}),p&&e.jsx(f.Item,{label:"Discount",children:e.jsxs(t,{style:{fontSize:16,color:"#52c41a"},children:["-"," ",h(p.discount_amount)]})}),e.jsx(f.Item,{label:"Total Price",children:e.jsxs(t,{strong:!0,style:{fontSize:18,color:"#52c41a"},children:[e.jsx(te,{style:{marginRight:8}}),h(w)]})})]})]}),e.jsxs(A,{style:{marginBottom:24},children:[e.jsxs(S,{level:4,style:{marginBottom:16},children:[e.jsx(Ie,{style:{marginRight:8}}),"Apply Coupon"]}),p?e.jsx("div",{children:e.jsx(Y,{message:"Coupon Applied Successfully!",description:e.jsxs("div",{children:[e.jsx(t,{strong:!0,children:p.name}),e.jsx("br",{}),e.jsxs(t,{type:"secondary",children:["You saved Rs."," ",p.discount_amount]})]}),type:"success",showIcon:!0,action:e.jsx($,{size:"small",onClick:ue,children:"Remove"})})}):e.jsxs(L,{gutter:16,children:[e.jsxs(k,{flex:"auto",children:[e.jsx(d,{placeholder:"Enter coupon code",value:E,onChange:r=>G(r.target.value),onPressEnter:X,status:N?"error":""}),N&&e.jsx(t,{type:"danger",style:{fontSize:12},children:N})]}),e.jsx(k,{children:e.jsx($,{type:"primary",onClick:X,loading:de,children:"Apply"})})]})]}),e.jsxs(A,{children:[e.jsxs(S,{level:4,style:{marginBottom:16},children:[e.jsx(ne,{style:{marginRight:8}}),"Customer Information"]}),e.jsxs(y,{form:R,layout:"vertical",onFinish:he,initialValues:{payment_method:"card"},children:[u&&u.length>0?e.jsxs(e.Fragment,{children:[u.filter(r=>r.is_primary).map(r=>e.jsx(y.Item,{name:r.name,label:r.label,rules:Q(r),help:r.help_text,children:Z(r)},r.id)),u.filter(r=>!r.is_primary).map(r=>e.jsx(y.Item,{name:r.name,label:r.label,rules:Q(r),help:r.help_text,children:Z(r)},r.id)),e.jsx(y.Item,{name:"payment_method",label:"Payment Method",rules:[{required:!0,message:"Please select a payment method"}],children:e.jsxs(D,{size:"large",placeholder:"Select payment method",children:[e.jsxs(b,{value:"card",children:[e.jsx(_,{style:{marginRight:8}}),"Credit/Debit Card"]}),e.jsxs(b,{value:"upi",children:[e.jsx(_,{style:{marginRight:8}}),"UPI Payment"]}),e.jsxs(b,{value:"netbanking",children:[e.jsx(_,{style:{marginRight:8}}),"Net Banking"]}),e.jsxs(b,{value:"wallet",children:[e.jsx(_,{style:{marginRight:8}}),"Digital Wallet"]})]})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{gutter:16,children:[e.jsx(k,{xs:24,sm:12,children:e.jsx(y.Item,{name:"customer_name",label:"Full Name",rules:[{required:!0,message:"Please enter your full name"}],children:e.jsx(d,{prefix:e.jsx(ne,{}),placeholder:"Enter your full name",size:"large"})})}),e.jsxs(k,{xs:24,sm:12,children:[e.jsx(y.Item,{name:"customer_phone",label:"Phone Number",rules:[{required:!0,message:"Please enter your phone number"},{pattern:/^[0-9+\-\s()]+$/,message:"Please enter a valid phone number"}],children:e.jsx(d,{placeholder:"Enter your phone number",disabled:!!l,addonBefore:e.jsx("span",{style:{color:l?"#52c41a":"inherit"},children:l?"âœ“ Verified":"ðŸ“±"})})}),l&&e.jsx(t,{type:"success",style:{fontSize:"12px"},children:"Phone number verified in previous step"}),l&&l!==R.getFieldValue("customer_phone")&&e.jsxs(t,{type:"warning",style:{fontSize:"12px"},children:["Note: Using verified phone number (",l,") for booking"]})]})]}),e.jsx(y.Item,{name:"customer_email",label:"Email Address",rules:[{required:!0,message:"Please enter your email address"},{type:"email",message:"Please enter a valid email address"}],children:e.jsx(d,{prefix:e.jsx(oe,{}),placeholder:"Enter your email address",size:"large"})}),e.jsx(y.Item,{name:"payment_method",label:"Payment Method",rules:[{required:!0,message:"Please select a payment method"}],children:e.jsxs(D,{size:"large",placeholder:"Select payment method",children:[e.jsxs(b,{value:"card",children:[e.jsx(_,{style:{marginRight:8}}),"Credit/Debit Card"]}),e.jsxs(b,{value:"upi",children:[e.jsx(_,{style:{marginRight:8}}),"UPI Payment"]}),e.jsxs(b,{value:"netbanking",children:[e.jsx(_,{style:{marginRight:8}}),"Net Banking"]}),e.jsxs(b,{value:"wallet",children:[e.jsx(_,{style:{marginRight:8}}),"Digital Wallet"]})]})}),e.jsx(y.Item,{name:"special_requests",label:"Special Requests (Optional)",children:e.jsx(d.TextArea,{rows:3,placeholder:"Any special requests or notes for your appointment..."})})]}),e.jsx(Y,{message:"Booking Confirmation",description:"By clicking 'Confirm & Pay', you agree to our terms and conditions and confirm your appointment booking.",type:"info",showIcon:!0,style:{marginBottom:24}}),e.jsxs("div",{style:{display:"flex",gap:16},children:[e.jsx($,{size:"large",icon:e.jsx(we,{}),onClick:pe,style:{flex:1},children:"Back to Terms"}),e.jsxs($,{type:"primary",size:"large",htmlType:"submit",loading:me,icon:e.jsx(se,{}),style:{flex:2},children:["Confirm & Pay ",h(w)]})]})]})]})]}),e.jsx(k,{xs:24,lg:8,children:e.jsxs(A,{style:{position:"sticky",top:24},children:[e.jsx(S,{level:4,style:{marginBottom:16},children:"Final Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(t,{strong:!0,children:i.name}),e.jsx(t,{children:h(i.price)})]}),e.jsx(t,{type:"secondary",style:{fontSize:12},children:P(i.duration)})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(t,{type:"secondary",style:{fontSize:12},children:"Employee will be automatically assigned based on availability"})}),c.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(F,{style:{margin:"12px 0"}}),c.map(r=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(t,{children:["+ ",r.name]}),e.jsx(t,{children:h(r.price)})]})},r.id))]}),e.jsx(F,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(t,{type:"secondary",children:"Appointment Date"}),e.jsx("div",{children:e.jsx(t,{strong:!0,children:H(x)})})]}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(t,{type:"secondary",children:"Appointment Time"}),e.jsx("div",{children:e.jsx(t,{strong:!0,children:V(g)})})]}),e.jsx(F,{style:{margin:"16px 0"}}),p&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(t,{children:"Original Price"}),e.jsx(t,{delete:!0,style:{fontSize:14},children:h(C)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(t,{children:"Discount"}),e.jsxs(t,{style:{fontSize:14,color:"#52c41a"},children:["-"," ",h(p.discount_amount)]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(t,{strong:!0,children:"Total Price"}),e.jsx(t,{strong:!0,style:{fontSize:18,color:"#52c41a"},children:h(w)})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(t,{type:"secondary",children:"Total Duration"}),e.jsx(t,{type:"secondary",children:P(K)})]}),e.jsx(F,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(t,{type:"secondary",children:"Accepted Agreements"}),e.jsx("div",{children:O.map(r=>e.jsx(ke,{color:"green",style:{marginTop:4},children:r.title},r.id))})]}),e.jsx(Y,{message:"Secure Payment",description:`Your payment information is encrypted and secure. ${q?.razorpay_key?"Powered by Razorpay.":""}`,type:"success",showIcon:!0,style:{marginTop:16}}),q?.currency&&e.jsxs(t,{type:"secondary",style:{fontSize:12,display:"block",marginTop:8},children:["Currency: ",q.currency]})]})})]})]})]})}export{Rr as default};
