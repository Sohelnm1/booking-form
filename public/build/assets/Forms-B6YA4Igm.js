import{r as P,j as e,H,a as v}from"./app-DccK8efl.js";import{A as K}from"./AdminLayout-BJ4VBIJU.js";import{F as t}from"./index-D9q-J8M6.js";import{C as V,T as J,B as x,S as k}from"./Logo-ub9X9d0l.js";import{F as Q}from"./Table-CQlr-Ic6.js";import{R as T}from"./PlusOutlined-DidUtnjV.js";import{M as Y}from"./index-bfPtHJwm.js";import{I as _}from"./index-S02B5qT8.js";import{S as y}from"./index-BWUGkIzU.js";import{R as F}from"./DeleteOutlined-DA8n6rD5.js";import{S as g}from"./index-PQ-bc3hq.js";import{T as w}from"./index-BayV2hdf.js";import{T as a}from"./index-D3Gguz71.js";import{R as A}from"./EditOutlined-BL2xHf0g.js";import{P as G}from"./index-DEFqQC_P.js";import{s as z}from"./index-CkVjnjCw.js";/* empty css            */import"./index-DdDu3-JN.js";import"./GiftOutlined-D-QWBpKW.js";import"./index-DVZnAPrw.js";import"./move-DZqJAvRQ.js";import"./CalendarOutlined--2l74uO5.js";import"./CalendarOutlined-DKq2sctu.js";import"./FileTextOutlined-BMDZMGAS.js";import"./UserOutlined-DOS_i_-f.js";import"./ClockCircleOutlined-D9Z_Cn1n.js";import"./ClockCircleOutlined-CELcQ7Uv.js";import"./useForm-C12MtuFa.js";import"./row-Bl1wK90m.js";import"./CheckCircleFilled-DwraH081.js";import"./InfoCircleFilled-0DGW2B6l.js";import"./addEventListener-DTs0XzGm.js";import"./DownOutlined-DRXmUP6-.js";import"./index-D-7HaqrF.js";import"./Pagination-D2hY4P1C.js";import"./index-W1ad0Z7-.js";import"./extendsObject-78o_rR5W.js";import"./index-BMIPjQbL.js";import"./Input-Bq4r8eWT.js";import"./useClosable-DkerPH5O.js";import"./EyeOutlined-BfFfpEKZ.js";import"./EyeOutlined-Bmd706kk.js";const{Title:W,Text:E}=J,{TextArea:X}=_;function Ue({auth:Z,forms:I,services:O,extras:C,fieldTypes:S}){const[L,j]=P.useState(!1),[p,f]=P.useState(null),[h]=t.useForm(),b=I.find(r=>r.name==="Default Booking Form")||I[0],q=()=>{f(null),h.resetFields(),h.setFieldsValue({form_id:b?.id,type:"text",is_required:!1,is_primary:!1,sort_order:0,rendering_control:"services"}),j(!0)},D=r=>{const s=r.target.value.toLowerCase().replace(/[^a-z0-9\s]/g,"").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");h.setFieldsValue({name:s})},N=r=>{if(r.is_primary){z.error("Primary fields (Name, Phone, Email) cannot be edited as they are required for all bookings.");return}f(r);let l=[];r.options&&Array.isArray(r.options)&&(l=r.options.map((s,i)=>({key:i,label:s.label||s,value:s.value||s}))),h.setFieldsValue({form_id:r.form_id,label:r.label,name:r.name,type:r.type,placeholder:r.placeholder,help_text:r.help_text,is_required:r.is_required,is_primary:r.is_primary,sort_order:r.sort_order,options:l,validation_rules:r.validation_rules||[],services:r.services?.map(s=>s.id)||[],extras:r.extras?.map(s=>s.id)||[],rendering_control:r.rendering_control||"services",has_distance_calculation:r.has_distance_calculation||!1,distance_calculation_type:r.distance_calculation_type||null,linked_extra_id:r.linked_extra_id||null,covered_distance_km:r.covered_distance_km||10,price_per_extra_km:r.price_per_extra_km||10,settings:{allowCurrentLocation:r.settings?.allowCurrentLocation||!1}}),j(!0)},R=r=>{D(r)},B=()=>{h.validateFields().then(r=>{let l=[];r.options&&Array.isArray(r.options)&&(l=r.options.map(i=>({label:i.label,value:i.value})));const s={form_id:r.form_id,label:r.label,name:r.name,type:r.type,placeholder:r.placeholder||"",help_text:r.help_text||"",is_required:r.is_required||!1,is_primary:r.is_primary||!1,sort_order:r.sort_order||0,options:l,validation_rules:r.validation_rules||[],services:r.services||[],extras:r.extras||[],rendering_control:r.rendering_control||"services",has_distance_calculation:r.has_distance_calculation||!1,distance_calculation_type:r.distance_calculation_type||null,linked_extra_id:r.linked_extra_id||null,covered_distance_km:r.covered_distance_km||10,price_per_extra_km:r.price_per_extra_km||10,settings:{allowCurrentLocation:r.settings?.allowCurrentLocation||!1}};p?v.put(route("admin.form-fields.update",p.id),s):v.post(route("admin.form-fields.store"),s),j(!1)})},M=()=>{j(!1),f(null),h.resetFields()},U=r=>{if(b?.fields?.find(s=>s.id===r)?.is_primary){z.error("Primary fields (Name, Phone, Email) cannot be deleted as they are required for all bookings.");return}v.post(route("admin.form-fields.delete",r))},$=[{title:"Label",dataIndex:"label",key:"label"},{title:"Type",dataIndex:"type",key:"type",render:r=>e.jsx(a,{color:"blue",children:S[r]||r})},{title:"Required",dataIndex:"is_required",key:"is_required",render:r=>e.jsx(a,{color:r?"red":"default",children:r?"Required":"Optional"})},{title:"Primary",dataIndex:"is_primary",key:"is_primary",render:r=>e.jsx(a,{color:r?"green":"default",children:r?"Primary":"Custom"})},{title:"Rendering Control",key:"rendering_control",render:(r,l)=>{const{rendering_control:s,services:i,extras:n,is_primary:o}=l;if(o)return e.jsx(a,{color:"green",size:"small",children:"All services"});switch(s){case"services":return!i||i.length===0?e.jsx(a,{color:"green",size:"small",children:"All services"}):e.jsxs("div",{children:[e.jsx(a,{color:"blue",size:"small",style:{marginBottom:4},children:"Services"}),i.slice(0,2).map((c,u)=>e.jsx(a,{color:"purple",size:"small",children:c.name},u)),i.length>2&&e.jsxs(a,{size:"small",children:["+",i.length-2," more"]})]});case"extras":return!n||n.length===0?e.jsx(a,{color:"orange",size:"small",children:"All extras"}):e.jsxs("div",{children:[e.jsx(a,{color:"orange",size:"small",style:{marginBottom:4},children:"Extras"}),n.slice(0,2).map((c,u)=>e.jsx(a,{color:"orange",size:"small",children:c.name},u)),n.length>2&&e.jsxs(a,{size:"small",children:["+",n.length-2," more"]})]});case"both":const d=[],m=[];return!i||i.length===0?d.push(e.jsx(a,{color:"green",size:"small",children:"All services"},"all-services")):(d.push(e.jsx(a,{color:"blue",size:"small",children:"Services"},"services-label")),i.slice(0,1).forEach((c,u)=>{d.push(e.jsx(a,{color:"purple",size:"small",children:c.name},`service-${u}`))}),i.length>1&&d.push(e.jsxs(a,{size:"small",children:["+",i.length-1," more"]},"services-more"))),!n||n.length===0?m.push(e.jsx(a,{color:"orange",size:"small",children:"All extras"},"all-extras")):(m.push(e.jsx(a,{color:"orange",size:"small",children:"Extras"},"extras-label")),n.slice(0,1).forEach((c,u)=>{m.push(e.jsx(a,{color:"orange",size:"small",children:c.name},`extra-${u}`))}),n.length>1&&m.push(e.jsxs(a,{size:"small",children:["+",n.length-1," more"]},"extras-more"))),e.jsxs("div",{children:[e.jsx("div",{style:{marginBottom:4},children:d}),e.jsx("div",{children:m})]});default:return e.jsx(a,{color:"default",size:"small",children:"All services"})}}},{title:"Distance Calculation",key:"distance_calculation",render:(r,l)=>l.has_distance_calculation?e.jsxs("div",{children:[e.jsx(a,{color:"blue",size:"small",children:l.distance_calculation_type==="origin"?"Origin":"Destination"}),l.linked_extra&&e.jsx(a,{color:"green",size:"small",children:l.linked_extra.name}),l.distance_calculation_type==="origin"&&e.jsx("div",{style:{marginTop:4},children:e.jsxs(E,{type:"secondary",style:{fontSize:11},children:[l.covered_distance_km,"km covered, â‚¹",l.price_per_extra_km,"/km"]})})]}):e.jsx(a,{size:"small",children:"-"})},{title:"Actions",key:"actions",render:(r,l)=>l.is_primary?e.jsxs(k,{children:[e.jsx(x,{type:"text",icon:e.jsx(A,{}),disabled:!0,title:"Primary fields cannot be edited"}),e.jsx(x,{type:"text",danger:!0,icon:e.jsx(F,{}),disabled:!0,title:"Primary fields cannot be deleted"})]}):e.jsxs(k,{children:[e.jsx(x,{type:"text",icon:e.jsx(A,{}),onClick:()=>N(l),title:"Edit Field"}),e.jsx(G,{title:"Are you sure you want to delete this field?",onConfirm:()=>U(l.id),okText:"Yes",cancelText:"No",children:e.jsx(x,{type:"text",danger:!0,icon:e.jsx(F,{}),title:"Delete Field"})})]})}];return e.jsxs(K,{children:[e.jsx(H,{title:"Booking Form Fields"}),e.jsxs("div",{children:[e.jsxs(V,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(W,{level:3,style:{margin:0},children:"Booking Form Fields"}),e.jsx(x,{type:"primary",icon:e.jsx(T,{}),onClick:q,children:"Add Field"})]}),children:[e.jsx("div",{style:{marginBottom:16},children:e.jsx(E,{type:"secondary",children:"Manage the fields for the booking form. Primary fields (Name, Phone, Email) are shown for all services. Custom fields can be assigned to specific services."})}),e.jsx(Q,{columns:$,dataSource:b?.fields||[],rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0}})]}),e.jsx(Y,{title:p?"Edit Field":"Add Field",open:L,onOk:B,onCancel:M,width:600,okText:p?"Update":"Create",cancelText:"Cancel",children:e.jsxs(t,{form:h,layout:"vertical",children:[e.jsx(t.Item,{name:"form_id",hidden:!0,children:e.jsx(_,{})}),e.jsx(t.Item,{name:"label",label:"Field Label",rules:[{required:!0,message:"Please enter field label"}],children:e.jsx(_,{placeholder:"Enter field label",onChange:R})}),e.jsx(t.Item,{name:"name",label:p?"Field Name":"Field Name (Auto-generated)",rules:[{required:!0,message:"Please enter field name"}],children:e.jsx(_,{placeholder:p?"Field name":"Field name will be auto-generated",disabled:!p})}),e.jsx(t.Item,{name:"type",label:"Field Type",rules:[{required:!0,message:"Please select field type"}],children:e.jsx(y,{placeholder:"Select field type",options:Object.entries(S).map(([r,l])=>({label:l,value:r}))})}),e.jsx(t.Item,{name:"placeholder",label:"Placeholder",children:e.jsx(_,{placeholder:"Enter placeholder text"})}),e.jsx(t.Item,{name:"help_text",label:"Help Text",children:e.jsx(X,{rows:2,placeholder:"Enter help text"})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.type!==l.type,children:({getFieldValue:r})=>{const l=r("type");return["select","radio","checkbox"].includes(l)?e.jsx(t.Item,{name:"options",label:"Field Options",rules:[{required:!0,message:"Please add at least one option"}],children:e.jsx(t.List,{name:"options",children:(i,{add:n,remove:o})=>e.jsxs(e.Fragment,{children:[i.map(({key:d,name:m,...c})=>e.jsxs(k,{style:{display:"flex",marginBottom:8},align:"baseline",children:[e.jsx(t.Item,{...c,name:[m,"label"],rules:[{required:!0,message:"Please enter option label"}],children:e.jsx(_,{placeholder:"Option label",style:{width:200}})}),e.jsx(t.Item,{...c,name:[m,"value"],rules:[{required:!0,message:"Please enter option value"}],children:e.jsx(_,{placeholder:"Option value",style:{width:150}})}),e.jsx(x,{type:"text",danger:!0,onClick:()=>o(m),icon:e.jsx(F,{})})]},d)),e.jsx(t.Item,{children:e.jsx(x,{type:"dashed",onClick:()=>n(),block:!0,icon:e.jsx(T,{}),children:"Add Option"})})]})})}):null}}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.type!==l.type,children:({getFieldValue:r})=>r("type")==="location"?e.jsx(t.Item,{name:["settings","allowCurrentLocation"],label:"Allow Current Location",valuePropName:"checked",initialValue:!0,children:e.jsx(g,{})}):null}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.type!==l.type,children:({getFieldValue:r})=>r("type")==="location"?e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{name:"has_distance_calculation",label:"Enable Distance Calculation",valuePropName:"checked",children:e.jsx(g,{})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(i,n)=>i.has_distance_calculation!==n.has_distance_calculation,children:({getFieldValue:i})=>i("has_distance_calculation")?e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{name:"distance_calculation_type",label:"Distance Calculation Type",rules:[{required:!0,message:"Please select distance calculation type"}],children:e.jsxs(y,{placeholder:"Select type",children:[e.jsx(Option,{value:"origin",children:"Origin (Hospital Location)"}),e.jsx(Option,{value:"destination",children:"Destination (Customer Location)"})]})}),e.jsx(t.Item,{name:"linked_extra_id",label:"Linked Extra (for distance calculation)",children:e.jsx(y,{placeholder:"Select extra for distance calculation",allowClear:!0,showSearch:!0,optionFilterProp:"children",children:C.map(o=>e.jsx(Option,{value:o.id,children:o.name},o.id))})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(o,d)=>o.distance_calculation_type!==d.distance_calculation_type,children:({getFieldValue:o})=>o("distance_calculation_type")==="origin"?e.jsxs(e.Fragment,{children:[e.jsx(t.Item,{name:"covered_distance_km",label:"Covered Distance (km)",rules:[{required:!0,message:"Please enter covered distance"}],children:e.jsx(w,{placeholder:"e.g., 10",min:0,step:.1,style:{width:"100%"}})}),e.jsx(t.Item,{name:"price_per_extra_km",label:"Price per Extra KM (â‚¹)",rules:[{required:!0,message:"Please enter price per extra km"}],children:e.jsx(w,{placeholder:"e.g., 10",min:0,step:.01,style:{width:"100%"}})})]}):null})]}):null})]}):null}),e.jsx(t.Item,{name:"is_required",label:"Required",valuePropName:"checked",children:e.jsx(g,{})}),e.jsx(t.Item,{name:"is_primary",label:"Primary Field (Phone, Name, Email)",valuePropName:"checked",children:e.jsx(g,{})}),e.jsx(t.Item,{name:"sort_order",label:"Sort Order",children:e.jsx(w,{min:0,placeholder:"Enter sort order",style:{width:"100%"}})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.is_primary!==l.is_primary,children:({getFieldValue:r})=>r("is_primary")?null:e.jsx(t.Item,{name:"rendering_control",label:"Field Rendering Control",children:e.jsxs(y,{placeholder:"Select rendering control",style:{width:"100%"},children:[e.jsx(Option,{value:"services",children:"Show based on Services"}),e.jsx(Option,{value:"extras",children:"Show based on Extras"}),e.jsx(Option,{value:"both",children:"Show based on Services AND Extras"})]})})}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.is_primary!==l.is_primary||r.rendering_control!==l.rendering_control,children:({getFieldValue:r})=>{const l=r("is_primary"),s=r("rendering_control");return!l&&(s==="services"||s==="both")?e.jsx(t.Item,{name:"services",label:"Available for Services",children:e.jsx(y,{mode:"multiple",placeholder:"Select specific services (leave empty to show for ALL services)",allowClear:!0,style:{width:"100%"},children:O.map(i=>e.jsx(Option,{value:i.id,children:i.name},i.id))})}):null}}),e.jsx(t.Item,{noStyle:!0,shouldUpdate:(r,l)=>r.is_primary!==l.is_primary||r.rendering_control!==l.rendering_control,children:({getFieldValue:r})=>{const l=r("is_primary"),s=r("rendering_control");return!l&&(s==="extras"||s==="both")?e.jsx(t.Item,{name:"extras",label:"Available for Extras",children:e.jsx(y,{mode:"multiple",placeholder:"Select specific extras (leave empty to show for ALL extras)",allowClear:!0,style:{width:"100%"},children:C.map(i=>e.jsx(Option,{value:i.id,children:i.name},i.id))})}):null}})]})})]})]})}export{Ue as default};
