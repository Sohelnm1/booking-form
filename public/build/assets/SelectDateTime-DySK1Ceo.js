import{r as k,j as e,H as Z,a as $}from"./app-E_GzTHcR.js";import{d as b}from"./dayjs.min-BzUltZyp.js";import{A as ee}from"./AppLayout-B-AbHmXv.js";import{ak as ae,T as te,C as M,B as D}from"./Logo-BbcbfkWA.js";import{P as se}from"./progress-DjAy78e_.js";import{R as P,C}from"./row-4H0Py2rk.js";import{R as oe}from"./CalendarOutlined-hgDl-fOt.js";import{R as le}from"./ClockCircleOutlined-D2Mtn5GK.js";import{S as ne}from"./index-BYBA1TCE.js";import{E as F}from"./index-DA4OSIrD.js";import{R as ie}from"./CheckOutlined-BuLzEZK3.js";import{D as B}from"./index-3ErC97rj.js";import{R as re}from"./ArrowLeftOutlined--z1qTDDt.js";import{R as de}from"./ArrowRightOutlined-BMZSoiyF.js";/* empty css            */import"./CheckCircleFilled-EwXFzcgk.js";import"./useBreakpoint-DjHX8iz2.js";const{Title:_,Text:l}=te;function Ce({service:d,selectedExtras:m,scheduleSettings:p}){const[c,L]=k.useState(null),[h,Y]=k.useState(null),[R,T]=k.useState([]),[N,I]=k.useState(!1),[j,A]=k.useState(b()),W=d.duration+m.reduce((a,t)=>a+(t.duration||0),0),E=()=>{const a=m.map(t=>t.id);$.visit(route("booking.select-extras"),{data:{service_id:d.id,extras:a}})},O=()=>{if(c&&h){const a=m.map(t=>t.id);$.visit(route("booking.consent"),{data:{service_id:d.id,extras:a,date:c.format("YYYY-MM-DD"),time:h.format("HH:mm")}})}},G=async a=>{I(!0);try{console.log("Fetching slots for date:",a.format("YYYY-MM-DD")),console.log("Service ID:",d.id),console.log("Service duration:",d.duration),console.log("Selected extras:",m),console.log("Total duration:",W);const t=new URLSearchParams({date:a.format("YYYY-MM-DD"),service_id:d.id});m.length>0&&m.forEach(i=>{t.append("extras[]",i.id)});const o=await(await fetch(`${route("booking.available-slots")}?${t.toString()}`)).json();console.log("Available slots response:",o),o.slots&&o.slots.length>0?T(o.slots):(console.log("No slots returned from backend, using fallback"),T([{start:"09:00",end:"09:30",available:!1,available_employees:0},{start:"09:30",end:"10:00",available:!1,available_employees:0},{start:"10:00",end:"10:30",available:!1,available_employees:0},{start:"10:30",end:"11:00",available:!1,available_employees:0},{start:"11:00",end:"11:30",available:!1,available_employees:0},{start:"11:30",end:"12:00",available:!1,available_employees:0},{start:"14:00",end:"14:30",available:!1,available_employees:0},{start:"14:30",end:"15:00",available:!1,available_employees:0},{start:"15:00",end:"15:30",available:!1,available_employees:0},{start:"15:30",end:"16:00",available:!1,available_employees:0},{start:"16:00",end:"16:30",available:!1,available_employees:0},{start:"16:30",end:"17:00",available:!1,available_employees:0}]))}catch(t){console.error("Error fetching slots:",t),T([{start:"09:00",end:"09:30",available:!1,available_employees:0},{start:"09:30",end:"10:00",available:!1,available_employees:0},{start:"10:00",end:"10:30",available:!1,available_employees:0},{start:"10:30",end:"11:00",available:!1,available_employees:0},{start:"11:00",end:"11:30",available:!1,available_employees:0},{start:"11:30",end:"12:00",available:!1,available_employees:0},{start:"14:00",end:"14:30",available:!1,available_employees:0},{start:"14:30",end:"15:00",available:!1,available_employees:0},{start:"15:00",end:"15:30",available:!1,available_employees:0},{start:"15:30",end:"16:00",available:!1,available_employees:0},{start:"16:00",end:"16:30",available:!1,available_employees:0},{start:"16:30",end:"17:00",available:!1,available_employees:0}])}finally{I(!1)}},U=a=>{L(a),Y(null),G(a)},V=a=>{Y(a)},w=a=>`₹${parseFloat(a).toFixed(2)}`,z=a=>{if(a<60)return`${a} min`;{const t=Math.floor(a/60),s=a%60;return s>0?`${t}h ${s}m`:`${t}h`}},H=a=>{console.log("formatTime called with:",a,typeof a);try{let t=a;if(a&&typeof a=="object"&&a.format?t=a.format("HH:mm"):typeof a=="object"&&a.start&&(t=a.start),!t||typeof t!="string")return console.error("Invalid time format:",a),"Invalid Time";const s=b(t,"HH:mm");return s.isValid()?s.format("h:mm A"):(console.error("Invalid time string:",t),"Invalid Time")}catch(t){return console.error("Error formatting time:",t,a),"Invalid Time"}},q=a=>{const t=a.year(),s=a.month(),o=b(new Date(t,s,1)),i=b(new Date(t,s+1,0)),n=o.startOf("week"),v=i.endOf("week"),r=[];let f=n;for(;f.isBefore(v)||f.isSame(v,"day");)r.push(f),f=f.add(1,"day");return r},J=()=>{A(j.subtract(1,"month"))},K=()=>{A(j.add(1,"month"))},Q=a=>{const t=b(),s=p?.[0];if(!s)return a.isAfter(t.subtract(1,"day"))&&a.isBefore(t.add(31,"day"));const o=s.min_advance_hours||2,i=s.max_advance_days||30,n=s.working_days||[1,2,3,4,5],v=t.add(o,"hour"),r=t.add(i,"day"),f=a.isSame(t,"day"),u=f||a.isAfter(v)&&a.isBefore(r),y=a.day(),S=y===0?7:y,g=n.includes(S),x=u&&g;return a.isSame(t,"day")&&console.log("Today date check:",{date:a.format("YYYY-MM-DD"),isToday:f,isWithinRange:u,isWorkingDay:g,isSelectable:x,minAdvanceHours:o,workingDays:n}),x};return e.jsxs(ee,{children:[e.jsx(Z,{title:"Select Date & Time - Book Appointment"}),e.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[e.jsx(ae,{variant:"primary",color:"color",background:"white",size:"large"}),e.jsx(_,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),e.jsx(l,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),p&&p.length>0&&e.jsx("div",{style:{marginTop:8},children:e.jsxs(l,{type:"secondary",style:{fontSize:"12px"},children:["📅 Booking window:"," ",p[0].booking_window_days," days ahead • ⏰ Min advance:"," ",p[0].min_advance_hours," hours • 🕐 Working hours:"," ",p[0].start_time," -"," ",p[0].end_time," • 📆 Working days: ",p[0].working_days_text]})})]}),e.jsxs("div",{style:{marginBottom:32},children:[e.jsx(se,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),e.jsx("div",{style:{textAlign:"center",marginTop:8},children:e.jsx(l,{type:"secondary",children:"Step 3 of 5"})})]}),e.jsxs(P,{gutter:[32,32],children:[e.jsxs(C,{xs:24,lg:16,children:[e.jsxs(M,{style:{marginBottom:24},children:[e.jsxs(_,{level:4,style:{marginBottom:16},children:[e.jsx(oe,{style:{marginRight:8}}),"Select Date"]}),e.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[e.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(D,{size:"small",onClick:J,style:{border:"none",boxShadow:"none"},children:"‹"}),e.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:j.format("MMMM YYYY")}),e.jsx(D,{size:"small",onClick:K,style:{border:"none",boxShadow:"none"},children:"›"})]}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(a=>e.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:a},a))}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:q(j).map((a,t)=>{const s=b(),o=a.isBefore(s,"day"),i=a.isSame(s,"day"),n=c&&c.isSame(a,"day"),v=a.month()===j.month(),r=Q(a),f={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:r&&!o?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:v?1:.3};let u="transparent",y="#333",S="1px solid transparent";o?y="#999":n?(u="#e6f7ff",y="#1890ff",S="2px solid #1890ff"):i&&!c?(u="#1890ff",y="white",S="none"):r?y="#333":y="#999";let g="";if(o)g="Past date - cannot be selected";else if(r)g=`Available for booking on ${a.format("dddd, MMMM D")}`;else{const x=a.day(),X=x===0?7:x;(p?.[0]?.working_days||[1,2,3,4,5]).includes(X)?g="Date not available for booking":g=`${a.format("dddd")} - Not a working day`}return e.jsxs("div",{style:{...f,backgroundColor:u,color:y,border:S},title:g,onMouseEnter:x=>{r&&!o&&!n&&(x.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:x=>{r&&!o&&!n&&(x.currentTarget.style.backgroundColor="transparent")},onClick:()=>{r&&!o&&U(a)},children:[a.date(),i&&e.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},t)})})]})]})]}),c&&e.jsxs(M,{children:[e.jsxs(_,{level:4,style:{marginBottom:16},children:[e.jsx(le,{style:{marginRight:8}}),"Available Time Slots"]}),N?e.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[e.jsx(ne,{size:"large"}),e.jsx("div",{style:{marginTop:16},children:e.jsx(l,{type:"secondary",children:"Loading available slots..."})})]}):R.length===0?e.jsx(F,{description:"No available slots for this date",image:F.PRESENTED_IMAGE_SIMPLE}):e.jsx(P,{gutter:[12,12],children:R.map((a,t)=>{const s=typeof a=="object"?a.start:a;console.log("Rendering slot:",{slot:a,slotStart:s,index:t});const o=b(s,"HH:mm"),i=h&&h.format("HH:mm")===s,n=typeof a=="object"?a.available!==!1:!0;return e.jsx(C,{xs:12,sm:8,md:6,children:e.jsx(D,{size:"large",disabled:!n,style:{width:"100%",height:48,border:i?"2px solid #1890ff":n?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:i?"#e6f7ff":n?"white":"#fff2f0",opacity:n?1:.6},onClick:()=>n&&V(o),children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[i&&e.jsx(ie,{style:{marginRight:8,color:"#1890ff"}}),H(s)]}),!n&&e.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},t)})})]})]}),e.jsx(C,{xs:24,lg:8,children:e.jsxs(M,{style:{position:"sticky",top:24},children:[e.jsx(_,{level:4,style:{marginBottom:16},children:"Booking Summary"}),e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(l,{strong:!0,children:d.name}),e.jsx(l,{children:w(d.price)})]}),e.jsx(l,{type:"secondary",style:{fontSize:12},children:z(d.duration)})]}),m.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{margin:"12px 0"}}),m.map(a=>e.jsx("div",{style:{marginBottom:8},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(l,{children:["+ ",a.name]}),e.jsx(l,{children:w(a.price)})]})},a.id))]}),e.jsx(B,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[e.jsx(l,{strong:!0,children:"Total Price"}),e.jsx(l,{strong:!0,style:{fontSize:16},children:w(parseFloat(d.price)+m.reduce((a,t)=>a+parseFloat(t.price),0))})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(l,{type:"secondary",children:"Total Duration"}),e.jsx(l,{type:"secondary",children:z(W)})]}),(c||h)&&e.jsxs(e.Fragment,{children:[e.jsx(B,{style:{margin:"16px 0"}}),e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(l,{type:"secondary",children:"Selected Date"}),e.jsx("div",{children:e.jsx(l,{strong:!0,children:c?c.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),e.jsxs("div",{children:[e.jsx(l,{type:"secondary",children:"Selected Time"}),e.jsx("div",{children:e.jsx(l,{strong:!0,children:h?H(h):"Not selected"})})]})]}),e.jsxs("div",{style:{marginTop:24},children:[e.jsx(D,{block:!0,style:{marginBottom:12},icon:e.jsx(re,{}),onClick:E,children:"Back to Extras"}),e.jsx(D,{type:"primary",block:!0,size:"large",icon:e.jsx(de,{}),onClick:O,disabled:!c||!h,children:"Continue to Consent"})]})]})})]})]})]})}export{Ce as default};
