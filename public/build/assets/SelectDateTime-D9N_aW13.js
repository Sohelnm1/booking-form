import{r as k,j as t,H as ot,a as H}from"./app-CADLw3G9.js";import{d as b}from"./dayjs.min-DKN-ELA8.js";import{B as nt}from"./BookingHeader-eDzihycA.js";import{a9 as st,T as it,C as I,B as M}from"./Logo-CLAK33tc.js";import{P as rt}from"./progress-SnWWg880.js";import{R as F,C as B}from"./row-Dom2nqZh.js";import{R as at}from"./CalendarOutlined-Cm65HkJR.js";import{R as lt}from"./ClockCircleOutlined-BiPqo-PL.js";import{S as dt}from"./index-0L_wmmjA.js";import{E as L}from"./index-DDNcFxHa.js";import{R as ct}from"./CheckOutlined-CB16nTDZ.js";import{T as mt}from"./index-CKLq3zDx.js";import{D as R}from"./index-B12X-zrZ.js";import{R as pt}from"./ArrowLeftOutlined-Br1CB3En.js";import{R as ft}from"./ArrowRightOutlined-BJ7EAVJj.js";/* empty css            */import"./CustomerLoginModal-D-DurPKh.js";import"./index-C6Y6ZG1D.js";import"./CheckCircleFilled-CHwNSVBx.js";import"./InfoCircleFilled-DJey1gcQ.js";import"./pickAttrs-9MlZ-O9_.js";import"./useClosable-CSbyRlS0.js";import"./extendsObject-78o_rR5W.js";import"./PurePanel-DvLIh7gb.js";import"./PhoneOutlined-gkVsPP0b.js";import"./LockOutlined-COLUNfIz.js";import"./index-SwRbmmP5.js";import"./Input-DEZKARtK.js";import"./EyeOutlined-DLLudd9l.js";import"./EyeOutlined-Bmd706kk.js";import"./index-2mpHb7UY.js";import"./index-C06X103F.js";import"./index-nwNNYHB9.js";import"./LogoutOutlined-D2_QBXct.js";import"./BookOutlined-0oTi6rVr.js";const{Title:Y,Text:a}=it;function Pt({service:m,selectedExtras:f,scheduleSettings:p,selectedPricingTier:i,selectedDuration:yt,selectedPrice:ut,auth:O}){const[u,J]=k.useState(null),[h,T]=k.useState(null),[z,w]=k.useState([]),[Q,A]=k.useState(!1),[D,N]=k.useState(b());console.log("SelectDateTime component - Schedule settings:",{scheduleSettings:p,scheduleSettingsLength:p?.length,firstSchedule:p?.[0]});const $=(i?i.duration_minutes:m.duration)+f.reduce((e,o)=>{const s=o.quantity||1;if(o.durationRelation){const n=o.durationRelation.hours*60+o.durationRelation.minutes;return e+n*s}return e+(o.total_duration||0)*s},0),E=()=>{const e=f.map(n=>n.id),o=f.map(n=>({id:n.id,quantity:n.quantity||1})),s=encodeURIComponent(JSON.stringify(o));H.visit(route("booking.select-extras"),{data:{service_id:m.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||m.duration,selected_price:i?.price||m.price,extras:e,extra_quantities_json:s}})},U=()=>{if(u&&h){const e=f.map(n=>n.id),o=f.map(n=>({id:n.id,quantity:n.quantity||1})),s=encodeURIComponent(JSON.stringify(o));H.visit(route("booking.consent"),{data:{service_id:m.id,pricing_tier_id:i?.id,selected_duration:i?.duration_minutes||m.duration,selected_price:i?.price||m.price,extras:e,extra_quantities_json:s,date:u.format("YYYY-MM-DD"),time:h.format("HH:mm")}})}},G=async e=>{A(!0);try{console.log("Fetching slots for date:",e.format("YYYY-MM-DD")),console.log("Service ID:",m.id),console.log("Service duration:",m.duration),console.log("Selected extras:",f),console.log("Total duration:",$);const o=new URLSearchParams({date:e.format("YYYY-MM-DD"),service_id:m.id});i&&(o.append("pricing_tier_id",i.id),o.append("selected_duration",i.duration_minutes),o.append("selected_price",i.price)),f.length>0&&f.forEach(r=>{o.append("extras[]",r.id)}),console.log("Normal booking - Request params:",o.toString()),console.log("Normal booking - Selected extras:",f);const n=await(await fetch(`${route("booking.available-slots")}?${o.toString()}`)).json();console.log("Available slots response:",n),n.slots&&n.slots.length>0?w(n.slots):(console.log("No slots returned from backend"),w([]))}catch(o){console.error("Error fetching slots:",o),w([])}finally{A(!1)}},V=e=>{J(e),T(null),G(e)},K=e=>{T(e)},_=e=>`₹${parseFloat(e).toFixed(2)}`,C=e=>{if(e<60)return`${e} min`;{const o=Math.floor(e/60),s=e%60;return s>0?`${o}h ${s}m`:`${o}h`}},W=e=>{try{if(!e)return console.error("Time is null or undefined"),"Invalid Time";let o=e;if(e&&typeof e=="object"&&e.format?o=e.format("HH:mm"):typeof e=="object"&&e.start&&(o=e.start),!o||typeof o!="string")return console.error("Invalid time format:",e),"Invalid Time";const s=o.match(/^(\d{1,2}):(\d{2})$/);if(!s)return console.error("Invalid time string format:",o),"Invalid Time";const n=parseInt(s[1],10),r=parseInt(s[2],10);if(n<0||n>23||r<0||r>59)return console.error("Invalid time values:",n,r),"Invalid Time";const c=n>=12?"PM":"AM",y=n===0?12:n>12?n-12:n,l=r.toString().padStart(2,"0");return`${y}:${l} ${c}`}catch(o){return console.error("Error formatting time:",o,e),"Invalid Time"}},X=e=>{const o=e.year(),s=e.month(),n=b(new Date(o,s,1)),r=b(new Date(o,s+1,0)),c=n.startOf("week"),y=r.endOf("week"),l=[];let d=c;for(;d.isBefore(y)||d.isSame(y,"day");)l.push(d),d=d.add(1,"day");return l},Z=()=>{N(D.subtract(1,"month"))},P=()=>{N(D.add(1,"month"))},tt=e=>{const o=b(),s=p?.[0];if(!s)return!1;const n=s.min_advance_hours,r=s.max_advance_days,c=s.working_days,y=o.add(n,"hour"),l=o.add(r,"day"),d=e.isSame(o,"day"),v=d||e.isAfter(y)&&(e.isBefore(l)||e.isSame(l,"day")),x=e.day(),S=x===0?7:x,j=c.includes(S),g=v&&j;return(e.isSame(o,"day")||e.format("YYYY-MM-DD")==="2025-08-18")&&console.log("Date selectability check:",{date:e.format("YYYY-MM-DD"),isToday:d,isWithinRange:v,isWorkingDay:j,isSelectable:g,minAdvanceHours:n,maxAdvanceDays:r,workingDays:c,adjustedDayOfWeek:S,minDate:y.format("YYYY-MM-DD"),maxDate:l.format("YYYY-MM-DD"),scheduleSettings:p,defaultSchedule:s}),g};return t.jsxs("div",{children:[t.jsx(ot,{title:"Select Date & Time - Book Appointment"}),t.jsx(nt,{auth:O}),t.jsxs("div",{style:{maxWidth:1200,margin:"0 auto",padding:"24px"},children:[t.jsx("div",{className:"mobile-top-spacing"}),t.jsxs("div",{style:{textAlign:"center",marginBottom:48},children:[t.jsx(st,{variant:"primary",color:"color",background:"white",size:"large"}),t.jsx(Y,{level:2,style:{marginTop:24,marginBottom:8},children:"Choose Date & Time"}),t.jsx(a,{type:"secondary",style:{fontSize:16},children:"Select your preferred appointment date and time"}),p&&p.length>0&&t.jsx("div",{style:{marginTop:8},children:t.jsxs(a,{type:"secondary",style:{fontSize:"12px"},children:["📅 Booking window:"," ",p[0].booking_window_days," days ahead • ⏰ Min advance:"," ",p[0].min_advance_hours," hours • 🕐 Working hours:"," ",p[0].start_time," -"," ",p[0].end_time," • 📆 Working days: ",p[0].working_days_text]})})]}),t.jsxs("div",{style:{marginBottom:32},children:[t.jsx(rt,{percent:60,showInfo:!1,strokeColor:"#1890ff",trailColor:"#f0f0f0"}),t.jsx("div",{style:{textAlign:"center",marginTop:8},children:t.jsx(a,{type:"secondary",children:"Step 3 of 5"})})]}),t.jsxs(F,{gutter:[32,32],children:[t.jsxs(B,{xs:24,lg:16,children:[t.jsxs(I,{style:{marginBottom:24},children:[t.jsxs(Y,{level:4,style:{marginBottom:16},children:[t.jsx(at,{style:{marginRight:8}}),"Select Date"]}),t.jsxs("div",{style:{border:"1px solid #f0f0f0",borderRadius:"12px",overflow:"hidden",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.06)",background:"white"},children:[t.jsxs("div",{style:{padding:"16px 20px",borderBottom:"1px solid #f0f0f0",background:"#fafafa",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx(M,{size:"small",onClick:Z,style:{border:"none",boxShadow:"none"},children:"‹"}),t.jsx("span",{style:{fontSize:"16px",fontWeight:"600",minWidth:"120px",textAlign:"center"},children:D.format("MMMM YYYY")}),t.jsx(M,{size:"small",onClick:P,style:{border:"none",boxShadow:"none"},children:"›"})]}),t.jsxs("div",{style:{padding:"16px"},children:[t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px",marginBottom:"8px"},children:["Su","Mo","Tu","We","Th","Fr","Sa"].map(e=>t.jsx("div",{style:{textAlign:"center",fontWeight:"600",color:"#666",padding:"8px 4px",fontSize:"12px",textTransform:"uppercase",letterSpacing:"0.5px"},children:e},e))}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(7, 1fr)",gap:"4px"},children:X(D).map((e,o)=>{const s=b(),n=e.isBefore(s,"day"),r=e.isSame(s,"day"),c=u&&u.isSame(e,"day"),y=e.month()===D.month(),l=tt(e),d={height:"48px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",cursor:l&&!n?"pointer":"default",transition:"all 0.2s ease",fontSize:"14px",fontWeight:"500",opacity:y?1:.3};let v="transparent",x="#333",S="1px solid transparent";n?x="#999":c?(v="#e6f7ff",x="#1890ff",S="2px solid #1890ff"):r&&!u?(v="#1890ff",x="white",S="none"):l?x="#333":x="#999";let j="";if(n)j="Past date - cannot be selected";else if(l)j=`Available for booking on ${e.format("dddd, MMMM D")}`;else{const g=e.day(),et=g===0?7:g,q=p?.[0]?.working_days;q&&!q.includes(et)?j=`${e.format("dddd")} - Not a working day`:j="Date not available for booking"}return t.jsxs("div",{style:{...d,backgroundColor:v,color:x,border:S},title:j,onMouseEnter:g=>{l&&!n&&!c&&(g.currentTarget.style.backgroundColor="#f5f5f5")},onMouseLeave:g=>{l&&!n&&!c&&(g.currentTarget.style.backgroundColor="transparent")},onClick:()=>{l&&!n&&V(e)},children:[e.date(),r&&t.jsx("div",{style:{fontSize:"8px",lineHeight:"1",marginTop:"2px",fontWeight:"normal"},children:"Today"})]},o)})})]})]})]}),u&&t.jsxs(I,{children:[t.jsxs(Y,{level:4,style:{marginBottom:16},children:[t.jsx(lt,{style:{marginRight:8}}),"Available Time Slots"]}),Q?t.jsxs("div",{style:{textAlign:"center",padding:"40px"},children:[t.jsx(dt,{size:"large"}),t.jsx("div",{style:{marginTop:16},children:t.jsx(a,{type:"secondary",children:"Loading available slots..."})})]}):z.length===0?t.jsx(L,{description:"No available slots for this date",image:L.PRESENTED_IMAGE_SIMPLE}):t.jsx(F,{gutter:[12,12],children:z.map((e,o)=>{const s=typeof e=="object"?e.start:e;if(!s||typeof s!="string")return console.error("Invalid slot start time:",s,"for slot:",e),null;const n=s.split(":");if(n.length!==2)return console.error("Invalid time format:",s),null;const r=parseInt(n[0],10),c=parseInt(n[1],10);if(isNaN(r)||isNaN(c)||r<0||r>23||c<0||c>59)return console.error("Invalid time values:",r,c,"for slot:",s),null;const y=b().hour(r).minute(c).second(0).millisecond(0),l=h&&h.format("HH:mm")===s,d=typeof e=="object"?e.available!==!1:!0;return t.jsx(B,{xs:12,sm:8,md:6,children:t.jsx(M,{size:"large",disabled:!d,style:{width:"100%",height:48,border:l?"2px solid #1890ff":d?"1px solid #d9d9d9":"1px solid #ffccc7",backgroundColor:l?"#e6f7ff":d?"white":"#fff2f0",opacity:d?1:.6},onClick:()=>d&&K(y),children:t.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[l&&t.jsx(ct,{style:{marginRight:8,color:"#1890ff"}}),W(s)]}),!d&&t.jsx("div",{style:{fontSize:"10px",marginTop:"2px",color:"#ff4d4f",fontWeight:"normal"},children:"Booked"})]})})},o)}).filter(Boolean)})]})]}),t.jsx(B,{xs:24,lg:8,children:t.jsxs(I,{style:{position:"sticky",top:24},children:[t.jsx(Y,{level:4,style:{marginBottom:16},children:"Booking Summary"}),t.jsxs("div",{style:{marginBottom:16},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsxs(a,{strong:!0,children:[m.name,i&&t.jsx(mt,{color:"blue",style:{marginLeft:8,fontSize:10},children:i.name})]}),t.jsx(a,{children:_(i?i.price:m.price)})]}),t.jsx(a,{type:"secondary",style:{fontSize:12},children:C(i?i.duration_minutes:m.duration)})]}),f.length>0&&t.jsxs(t.Fragment,{children:[t.jsx(R,{style:{margin:"12px 0"}}),f.map(e=>{const o=e.quantity||1;return t.jsxs("div",{style:{marginBottom:8},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsxs(a,{children:["+ ",e.name,o>1&&t.jsxs(a,{type:"secondary",style:{fontSize:12},children:[" ","× ",o]})]}),t.jsx(a,{children:_(parseFloat(e.price)*o)})]}),t.jsxs(a,{type:"secondary",style:{fontSize:12},children:[e.duration_relation?e.duration_relation.label:"No additional time",o>1&&t.jsxs(a,{type:"secondary",style:{fontSize:12},children:[" ","× ",o]})]})]},e.id)})]}),t.jsx(R,{style:{margin:"16px 0"}}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[t.jsx(a,{strong:!0,children:"Total Price"}),t.jsx(a,{strong:!0,style:{fontSize:16},children:_(parseFloat(i?i.price:m.price)+f.reduce((e,o)=>{const s=o.quantity||1;return e+parseFloat(o.price)*s},0))})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[t.jsx(a,{type:"secondary",children:"Total Duration"}),t.jsx(a,{type:"secondary",children:C($)})]}),(u||h)&&t.jsxs(t.Fragment,{children:[t.jsx(R,{style:{margin:"16px 0"}}),t.jsxs("div",{style:{marginBottom:8},children:[t.jsx(a,{type:"secondary",children:"Selected Date"}),t.jsx("div",{children:t.jsx(a,{strong:!0,children:u?u.format("dddd, MMMM D, YYYY"):"Not selected"})})]}),t.jsxs("div",{children:[t.jsx(a,{type:"secondary",children:"Selected Time"}),t.jsx("div",{children:t.jsx(a,{strong:!0,children:h&&h.isValid()?W(h):"Not selected"})})]})]}),t.jsxs("div",{style:{marginTop:24},children:[t.jsx(M,{block:!0,style:{marginBottom:12},icon:t.jsx(pt,{}),onClick:E,children:"Back to Extras"}),t.jsx(M,{type:"primary",block:!0,size:"large",icon:t.jsx(ft,{}),onClick:U,disabled:!u||!h,children:"Continue to Consent"})]})]})})]})]})]})}export{Pt as default};
